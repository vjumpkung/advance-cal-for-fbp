var Q=Object.defineProperty;var Y=(t,s,e)=>s in t?Q(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var E=(t,s,e)=>Y(t,typeof s!="symbol"?s+"":s,e);import{j as p,M as $,B as P,T as R,a as q,b as tt,d as et,S as ot}from"./@mui/material-BQdAtyIz.js";import{c as it,r as I}from"./vendor-DM_OWPAt.js";import{B as G,Q as st}from"./react-toastify-6PrFfkGr.js";import{F as nt}from"./file-saver-B2VyKP5u.js";import{H as rt}from"./react-helmet-D1WOPrvJ.js";import{a as H}from"./axios-DXsv3KKR.js";import{v as at}from"./uuid-Ch9TGLTe.js";import{l as f}from"./litegraph.js-CpwqBUsj.js";import{z as l}from"./zod-DXqQCM1T.js";import"./@emotion/react-6hH5lGvJ.js";import"./@emotion/styled-BTak2TOH.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();var U,V=it;U=V.createRoot,V.hydrateRoot;async function lt(t){const s=t.serialize(),e={};for(const o of t.computeExecutionOrder(!1,0)){const n=s.nodes.find(d=>d.id===o.id);if(o.isVirtualNode){o.applyToGraph&&o.applyToGraph(s);continue}if(o.mode===2||o.mode===4)continue;const a={},r=o.widgets;if(r)for(const d in r){const i=r[d];(!i.options||i.options.serialize!==!1)&&(a[i.name]=i.serializeValue?await i.serializeValue(n,d):i.value)}for(let d in o.inputs){let i=o.getInputNode(d);if(i){let c=o.getInputLink(d);for(;i.mode===4||i.isVirtualNode;){let u=!1;if(i.isVirtualNode)c=i.getInputLink(c.origin_slot),c&&(i=i.getInputNode(c.target_slot),i&&(u=!0));else if(c&&i.mode===4){let y=[c.origin_slot];if(i.inputs){y=y.concat(Object.keys(i.inputs));for(let h in y)if(h=y[h],i.inputs[h].type===o.inputs[d].type){c=i.getInputLink(h),c&&(i=i.getInputNode(h)),u=!0;break}}}if(!u)break}c&&(a[o.inputs[d].name]=[String(c.origin_id),parseInt(c.origin_slot)])}}e[String(o.id)]={inputs:a,class_type:o.comfyClass}}for(const o in e)for(const n in e[o].inputs)Array.isArray(e[o].inputs[n])&&e[o].inputs[n].length===2&&!e[e[o].inputs[n][0]]&&delete e[o].inputs[n];return{workflow:s,output:e}}const Z=at().toString().replace(/-/gi,"");class ut{constructor(){E(this,"currentExecutingNode",null);E(this,"lastErrorNode",null);E(this,"errorNode",null)}}const L=new ut;function ct(){const t=f.LGraphCanvas.prototype.drawNode,s=f.LGraphCanvas.prototype.drawNodeShape;f.LGraphCanvas.prototype.drawNodeShape=function(e,o,n,a,r,d,i){var _;const c=s.apply(this,arguments),u=(_=L.errorNode)==null?void 0:_[e.id.toString()];let y=null,h=1;if(e.id===+L.currentExecutingNode?y="#0f0":u!=null&&u.errors?(y="red",h=2):L.lastErrorNode&&+L.lastErrorNode.node_id===e.id&&(y="#f0f",h=2),y){const g=e._shape||e.shape||f.LiteGraph.ROUND_SHAPE;o.lineWidth=h,o.globalAlpha=.8,o.beginPath(),g==f.LiteGraph.BOX_SHAPE?o.rect(-6,-6-f.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+f.LiteGraph.NODE_TITLE_HEIGHT):g==f.LiteGraph.ROUND_SHAPE||g==f.LiteGraph.CARD_SHAPE&&e.flags.collapsed?o.roundRect(-6,-6-f.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+f.LiteGraph.NODE_TITLE_HEIGHT,this.round_radius*2):g==f.LiteGraph.CARD_SHAPE?o.roundRect(-6,-6-f.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+f.LiteGraph.NODE_TITLE_HEIGHT,[this.round_radius*2,this.round_radius*2,2,2]):g==f.LiteGraph.CIRCLE_SHAPE&&o.arc(n[0]*.5,n[1]*.5,n[0]*.5+6,0,Math.PI*2),o.strokeStyle=y,o.stroke(),o.strokeStyle=a,o.globalAlpha=1}if(u){o.lineWidth=2,o.strokeStyle="red";for(const g of u.errors)if(g.extra_info&&g.extra_info.input_name){const w=e.findInputSlot(g.extra_info.input_name);if(w!==-1){let x=e.getConnectionPos(!0,w);o.beginPath(),o.arc(x[0]-e.pos[0],x[1]-e.pos[1],12,0,2*Math.PI,!1),o.stroke()}}}return c},f.LGraphCanvas.prototype.drawNode=function(e,o){var n=this.editor_alpha,a=e.bgcolor;e.mode===2&&(this.editor_alpha=.4),e.mode===4&&(e.bgcolor="#FF00FF",this.editor_alpha=.2);const r=t.apply(this,arguments);return this.editor_alpha=n,e.bgcolor=a,r}}async function dt(){const t=await H.get("/api/object_info");if(t.status===200)return t.data}async function pt(t){L.errorNode=null;const s=await lt(t),e=await H.post("/api/workflow",{workflow:s.output,client_id:Z});if(e.status===200)return await e.data;throw{response:await e.data}}async function ft(t){const s=new WebSocket(`/ws?clientId=${Z}`);return s.binaryType="arraybuffer",s.addEventListener("open",()=>{console.log("WebSocket Open")}),s.addEventListener("error",()=>{console.log("WebSocket Error")}),s.addEventListener("close",()=>{console.log("Reconnect!")}),s.addEventListener("message",e=>{try{const o=JSON.parse(e.data);switch(o.type){case"status":dispatchEvent(new CustomEvent("status",{detail:o.data.status}));break;case"progress":dispatchEvent(new CustomEvent("progress",{detail:o.data}));break;case"executing":dispatchEvent(new CustomEvent("executing",{detail:o.data.node}));break;case"progress":case"executed":case"execution_start":case"execution_success":case"execution_error":case"execution_cached":case"logs":dispatchEvent(new CustomEvent(o.type,{detail:o.data}));break}}catch(o){console.warn("Unhandled message:",e.data,o)}}),s}const A=l.union([l.number().int(),l.string()]),B=l.union([l.object({0:l.number(),1:l.number()}).passthrough().transform(t=>[t[0],t[1]]),l.tuple([l.number(),l.number()])]),ht=l.object({collapsed:l.boolean().optional(),pinned:l.boolean().optional(),allow_interaction:l.boolean().optional(),horizontal:l.boolean().optional(),skip_repeated_outputs:l.boolean().optional()}).passthrough(),F=l.union([l.string(),l.array(l.string()),l.number()]),D=l.union([l.number().int(),l.string().transform(t=>parseInt(t)).refine(t=>!isNaN(t),{message:"Invalid number"})]),gt=l.object({name:l.string(),type:F,link:l.number().nullable().optional(),slot_index:D.optional()}).passthrough(),mt=l.object({name:l.string(),type:F,links:l.array(l.number()).nullable().optional(),slot_index:D.optional()}).passthrough(),yt=l.object({"Node name for S&R":l.string().optional()}).passthrough(),_t=l.union([l.array(l.any()),l.record(l.any())]),wt=l.object({id:A,type:l.string(),pos:B,size:B,flags:ht,order:l.number(),mode:l.number(),inputs:l.array(gt).optional(),outputs:l.array(mt).optional(),properties:yt,widgets_values:_t.optional(),color:l.string().optional(),bgcolor:l.string().optional()}).passthrough(),bt=l.tuple([l.number(),A,D,A,D,F]),Et=l.object({title:l.string(),bounding:l.tuple([l.number(),l.number(),l.number(),l.number()]),color:l.string().optional(),font_size:l.number().optional(),locked:l.boolean().optional()}).passthrough(),xt=l.object({links_ontop:l.boolean().optional(),align_to_grid:l.boolean().optional()}).passthrough(),vt=l.object({last_node_id:l.number(),last_link_id:l.number(),nodes:l.array(wt),links:l.array(bt),groups:l.array(Et).optional(),config:xt.optional().nullable(),version:l.number()});function Nt(t){try{const s=JSON.parse(t);return vt.parse(s)}catch(s){throw s instanceof l.ZodError?console.error("Validation error:",s.errors):console.error("Parsing error:",s),Error(s)}}const Lt=(t,s,e,o)=>{var a;const n=(a=o.target.files)==null?void 0:a[0];if(n&&s){L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null;const r=new FileReader;return r.onload=d=>{var i;try{const c=(i=d.target)==null?void 0:i.result,u=Nt(c);s.clear(),s.configure(u),t&&(t.value=""),e.ds.offset=[0,0],e.setZoom(1,[0,0]),e.setDirty(!0,!0),G.success("Loading Workflow Success")}catch{G.error("Error loading workflow file. Please ensure it is a valid workflow.")}},r.onerror=()=>{G.error("Error reading file")},r.readAsText(n),n.name}},kt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function St(){const[t,s]=I.useState(!1),e=()=>s(!0),o=()=>s(!1),[n,a]=I.useState({traceback:[],node_id:"",node_type:"",exception_type:"",exception_message:""});return window.addEventListener("execution_error",({detail:r})=>{a(r),e()}),p.jsx("div",{children:p.jsx($,{open:t,onClose:o,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:p.jsxs(P,{sx:kt,children:[p.jsxs(R,{id:"modal-modal-title",variant:"h5",component:"h2",children:[p.jsx("i",{className:"pi pi-exclamation-triangle",style:{color:"#ff4545"}})," ","Error Workflow Execution"]}),p.jsxs(R,{id:"modal-modal-title",fontFamily:"monospace",children:[n.exception_type," ",p.jsx("br",{})," ",n.exception_message," "]}),p.jsx(R,{id:"modal-modal-description",sx:{mt:2},fontFamily:"monospace",variant:"caption",color:"#828282",children:n.traceback}),p.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:p.jsx(q,{onClick:o,children:"Close"})})]})})})}const It={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function Ot({handleOpen:t,handleClose:s,open:e,invaliddetail:o}){return p.jsx("div",{children:p.jsx($,{open:e,onClose:s,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:p.jsxs(P,{sx:It,children:[p.jsxs(R,{id:"modal-modal-title",variant:"h5",component:"h2",children:[p.jsx("i",{className:"pi pi-exclamation-circle",style:{color:"#ffc400"}})," ","Invalid Workflow"]}),p.jsx(R,{id:"modal-modal-description",sx:{mt:2},fontFamily:"monospace",variant:"caption",children:Object.keys(o.node_errors).map(n=>p.jsxs("p",{style:{fontSize:"110%"},children:[p.jsxs("span",{style:{fontWeight:"bold"},children:["#",n," ",o.node_errors[n].class_type," :"]}),p.jsx("br",{}),o.node_errors[n].errors.map(a=>p.jsxs("span",{children:[`${a.details} - ${a.message}`,p.jsx("br",{})]}))]}))}),p.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:p.jsx(q,{onClick:s,children:"Close"})})]})})})}function Tt({graph:t,canvas:s}){const e=I.useRef(null),[o,n]=I.useState(!1),[a,r]=I.useState(!0),[d,i]=I.useState(null),[c,u]=I.useState("untitled"),[y,h]=I.useState({error:{},node_errors:{}}),[_,g]=I.useState(!1),w=()=>{var b;(b=e.current)==null||b.click()},x=()=>{if(t){const b=JSON.stringify(t.serialize()),O=new Blob([b],{type:"text/plain;charset=utf-8"}),S=prompt("Enter Filename : ",`workflow-${Date.now()}`);if(S===null)return;nt.saveAs(O,`${S}.json`),i(t.serialize()),u(S)}},T=()=>g(!0),C=()=>g(!1),v=()=>{t&&confirm("Clear workflow?")&&(L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null,t.clear(),G.info("Workflow Cleared"),u("untitled"),s.ds.offset=[0,0],s.setZoom(1,[0,0]),s.setDirty(!0,!0))},k=async()=>{try{L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null;const b=await pt(t);t.start(),n(!0)}catch(b){L.errorNode=b.response.data.node_errors,h(b.response.data),g(!0),n(!1)}},m=async()=>{try{await H.post("/api/interrupt",null),await G.warning("Workflow Interrupt")}catch(b){console.error(b)}finally{n(!1)}};window.addEventListener("execution_success",({detail:b})=>{n(!1)}),window.addEventListener("execution_error",({detail:b})=>{n(!1)});const N=tt({palette:{mode:"dark"}});return p.jsxs(p.Fragment,{children:[p.jsx(rt,{children:p.jsxs("title",{children:[a?"":"*",c+" ","- AdvFBP"]})}),p.jsx(et,{theme:N,children:p.jsxs(ot,{enableColorScheme:!0,children:[p.jsx(St,{}),p.jsx(Ot,{handleOpen:T,handleClose:C,open:_,invaliddetail:y})]})}),p.jsxs("div",{className:"topbar",children:[p.jsxs("div",{className:"leftmenu",children:[p.jsxs("button",{className:"buttonmenu",onClick:x,children:[p.jsx("i",{className:"pi pi-save"})," Save"]}),p.jsxs("button",{className:"buttonmenu",onClick:w,children:[p.jsx("i",{className:"pi pi-upload"})," Load"]}),p.jsx("input",{type:"file",ref:e,onChange:b=>{const O=Lt(e.current,t,s,b);O&&u(O.split(".")[0])},accept:".json",style:{display:"none"}}),p.jsxs("button",{className:"buttonmenu",onClick:v,children:[p.jsx("i",{className:"pi pi-eraser"})," Clear"]})]}),p.jsx("div",{className:"rightmenu",children:p.jsx("button",{className:"buttonmenuright",onClick:async()=>{o?await m():await k()},children:o?p.jsxs("span",{children:[p.jsx("i",{className:"pi pi-stop"})," Interrupt Workflow"]}):p.jsxs("span",{children:[p.jsx("i",{className:"pi pi-play"})," Run Workflow"]})})})]})]})}const z=Symbol(),W=Symbol();function jt(t,s,e,o,n){function r(i){var _,g;if(t.widgets[0].last_y==null)return;let c=t.widgets[0].last_y,u=i[1]-c,y=0;const h=[];for(let w=0;w<t.widgets.length;w++){const x=t.widgets[w];x.type==="customtext"?h.push(x):x.computeSize?y+=x.computeSize(null)[1]+4:y+=f.LiteGraph.NODE_WIDGET_HEIGHT+4}u-=y,u/=h.length+(((_=t.imgs)==null?void 0:_.length)||0),u<50&&(u=50,t.size[1]=c+y+u*(h.length+(((g=t.imgs)==null?void 0:g.length)||0)),t.graph.setDirtyCanvas(!0));for(const w of t.widgets)w.y=c,w.type==="customtext"?(c+=u,w.computedHeight=u-h.length*4):w.computeSize?c+=w.computeSize()[1]+4:c+=f.LiteGraph.NODE_WIDGET_HEIGHT+4;t.inputHeight=u}const d={type:"customtext",name:s,get value(){return this.inputEl.value},set value(i){this.inputEl.value=i},draw:function(i,c,u,y,h){this.parent.inputHeight||r(t.size);const _=n.ds.scale>.5&&this.type==="customtext",g=10,w=i.canvas.getBoundingClientRect(),x=new DOMMatrix().scaleSelf(w.width/i.canvas.width,w.height/i.canvas.height).multiplySelf(i.getTransform()).translateSelf(g,g+y),T=new DOMMatrix().scaleSelf(x.a,x.d);Object.assign(this.inputEl.style,{transformOrigin:"0 0",transform:T,left:`${x.a+x.e}px`,top:`${x.d+x.f}px`,width:`${u-g*2}px`,height:`${this.parent.inputHeight-g*2}px`,position:"absolute",background:t.color?t.color:"",color:t.color?"white":"",zIndex:o._nodes.indexOf(t)}),this.inputEl.hidden=!_}};if(d.inputEl=document.createElement("textarea"),d.inputEl.className="comfy-multiline-input",d.inputEl.value=e.defaultVal,d.inputEl.placeholder=e.placeholder||"",document.addEventListener("mousedown",function(i){d.inputEl.contains(i.target)||d.inputEl.blur()}),d.parent=t,document.body.appendChild(d.inputEl),t.addCustomWidget(d),n.onDrawBackground=function(){for(let i in o._nodes){const c=o._nodes[i];for(let u in c.widgets){let y=c.widgets[u];Object.hasOwn(y,"inputEl")&&(y.inputEl.style.left="-8000px",y.inputEl.style.position="absolute")}}},t.onRemoved=function(){for(let i in this.widgets)this.widgets[i].inputEl&&this.widgets[i].inputEl.remove()},d.onRemove=()=>{var i;(i=d.inputEl)==null||i.remove(),--t[z]||(t.onResize=t[W],delete t[z],delete t[W])},t[z])t[z]++;else{t[z]=1;const i=t[W]=t.onResize;t.onResize=function(c){r(c),i&&i.apply(this,arguments)}}return{minWidth:400,minHeight:200,widget:d}}function K(t,s){let e=t[1].default,{min:o,max:n,step:a}=t[1];return e==null&&(e=0),o==null&&(o=Number.MIN_SAFE_INTEGER),n==null&&(n=Number.MAX_SAFE_INTEGER),a==null&&(a=s),t[1].min=o,t[1].max=n,t[1].step=1*a,{val:e,config:{...t[1]}}}function J(t){return t==="slider"?"slider":"number"}function Ct(t,s,e){let o=J(e[1].display);const{val:n,config:a}=K(e,1);return Object.assign(a,{precision:0}),{widget:t.addWidget(o,s,n,function(r){const d=this.options.step/10;let i=this.options.min%d;isNaN(i)&&(i=0),this.value=Math.round((r-i)/d)*d+i},a)}}const j={FLOAT(t,s,e){let o=J(e[1].display),{val:n,config:a}=K(e,.5);return{widget:t.addWidget(o,s,n,()=>{},a)}},INT(t,s,e){return Ct(t,s,e)},BOOLEAN(t,s,e){let o=e[1].default;return{widget:t.addWidget("toggle",s,o,()=>{},{on:e[1].label_on,off:e[1].label_off})}},STRING(t,s,e,o,n){const a=e[1].defaultVal?e[1].defaultVal:"",r=!!e[1].multiline;let d;return r?d=jt(t,s,e[1],o,n):d={widget:t.addWidget("text",s,a,()=>{},{})},e[1].dynamicPrompts!=null&&(d.widget.dynamicPrompts=e[1].dynamicPrompts),d},COMBO(t,s,e){const o=e[0];let n=o[0];return e[1]&&e[1].default&&(n=e[1].default),{widget:t.addWidget("combo",s,n,()=>{},{values:o})}},SELECTFILE(t,s,e,o,n){let a;const r=document.createElement("input");return Object.assign(r,{type:"file",style:"display: none",onchange:async()=>{if(r.files.length){const d=r.files[0],i=new FormData;i.append("file",d);const c=await H.post("/api/upload/file",i);t.widgets[0].value=c.data.path}}}),document.body.append(r),a=t.addWidget("button","Select File","file",()=>{r.click()}),t.onRemoved=function(){r.remove()},a.serialize=!1,{widget:a}}};async function Gt(t,s){class e{constructor(){E(this,"properties");E(this,"serialize_widgets");E(this,"isVirtualNode");E(this,"color",f.LGraphCanvas.node_colors.yellow.color);E(this,"bgcolor",f.LGraphCanvas.node_colors.yellow.bgcolor);E(this,"groupcolor",f.LGraphCanvas.node_colors.yellow.groupcolor);this.properties||(this.properties={},this.properties.text=""),j.STRING(this,"",["",{defaultVal:this.properties.text,multiline:!0}],t,s),this.serialize_widgets=!0,this.isVirtualNode=!0}}E(e,"category"),f.LiteGraph.registerNodeType("Note",Object.assign(e,{title_mode:f.LiteGraph.NORMAL_TITLE,title:"Note",collapsable:!0})),e.category="utils"}async function zt(t,s){const o=class o{constructor(){E(this,"size");E(this,"__outputType");E(this,"inputs");E(this,"outputs");E(this,"isVirtualNode");E(this,"horizontal");E(this,"properties");this.properties||(this.properties={}),this.properties.showOutputText=o.defaultVisibility,this.properties.horizontal=!1;const a=this;a.addInput("","*"),a.addOutput(this.properties.showOutputText?"*":"","*"),a.onConnectionsChange=function(r,d,i,c){var C;if(this.applyOrientation(),i&&r===f.LiteGraph.OUTPUT&&new Set(this.outputs[0].links.map(k=>t.links[k].type).filter(k=>k!=="*")).size>1){const k=[];for(let m=0;m<this.outputs[0].links.length-1;m++){const N=this.outputs[0].links[m],b=t.links[N];k.push(b)}for(const m of k)t.getNodeById(m.target_id).disconnectInput(m.target_slot)}let u=this,y=[],h=null,_=null;for(;u;){y.unshift(u);const v=u.inputs[0].link;if(v!==null){const k=t.links[v],m=t.getNodeById(k.origin_id);if(m.constructor.type==="Reroute")m===this?(u.disconnectInput(k.target_slot),u=null):u=m;else{_=u,h=((C=m.outputs[k.origin_slot])==null?void 0:C.type)??null;break}}else{u=null;break}}const g=[this];let w=null;for(;g.length;){u=g.pop();const v=(u.outputs?u.outputs[0].links:[])||[];if(v.length)for(const k of v){const m=t.links[k];if(!m)continue;const N=t.getNodeById(m.target_id);if(N.constructor.type==="Reroute")g.push(N),y.push(N);else{const O=N.inputs&&N.inputs[m==null?void 0:m.target_slot]&&N.inputs[m.target_slot].type?N.inputs[m.target_slot].type:null;h&&O!==h?N.disconnectInput(m.target_slot):w=O}}}const x=h||w||"*",T=f.LGraphCanvas.link_type_colors[x];for(const v of y){v.outputs[0].type=h||"*",v.__outputType=x,v.outputs[0].name=v.properties.showOutputText?x:"",v.size=v.computeSize(),v.applyOrientation();for(const k of v.outputs[0].links||[]){const m=t.links[k];m&&(m.color=T)}}if(_){const v=t.links[_.inputs[0].link];v&&(v.color=T)}},this.clone=function(){const r=o.prototype.clone.apply(this);return r.removeOutput(0),r.addOutput(this.properties.showOutputText?"*":"","*"),r.size=r.computeSize(),r},this.isVirtualNode=!0}getExtraMenuOptions(a,r){r.unshift({content:(this.properties.showOutputText?"Hide":"Show")+" Type",callback:()=>{this.properties.showOutputText=!this.properties.showOutputText,this.properties.showOutputText?this.outputs[0].name=this.__outputType||this.outputs[0].type:this.outputs[0].name="",this.size=this.computeSize(),this.applyOrientation(),t.setDirtyCanvas(!0,!0)}},{content:(o.defaultVisibility?"Hide":"Show")+" Type By Default",callback:()=>{o.setDefaultTextVisibility(!o.defaultVisibility)}},{content:"Set "+(this.properties.horizontal?"Horizontal":"Vertical"),callback:()=>{this.properties.horizontal=!this.properties.horizontal,this.applyOrientation()}})}applyOrientation(){this.horizontal=this.properties.horizontal,this.horizontal?this.inputs[0].pos=[this.size[0]/2,0]:delete this.inputs[0].pos,t.setDirtyCanvas(!0,!0)}computeSize(){return[this.properties.showOutputText&&this.outputs&&this.outputs.length?Math.max(75,f.LiteGraph.NODE_TEXT_SIZE*this.outputs[0].name.length*.6+40):75,26]}clone(){}static setDefaultTextVisibility(a){o.defaultVisibility=a,a?localStorage["Comfy.RerouteNode.DefaultVisibility"]="true":delete localStorage["Comfy.RerouteNode.DefaultVisibility"]}};E(o,"category"),E(o,"defaultVisibility");let e=o;e.setDefaultTextVisibility(!!localStorage["Comfy.RerouteNode.DefaultVisibility"]),f.LiteGraph.registerNodeType("Reroute",Object.assign(e,{title_mode:f.LiteGraph.NO_TITLE,title:"Reroute",collapsable:!1})),e.category="utils"}const Rt={dark:{id:"dark",name:"Dark (Default)",colors:{node_slot:{INT:"#FFD500",FLOAT:"#A8DADC",STRING:"#ad7452",COMBO:"#FFA931",NDARRAY:"#6EE7B7"}}}};async function Dt(t,s,e){const o=i=>Object.keys(i).sort().reduce((c,u)=>(c[u]=i[u],c),{});function n(){var i=[];const c=t;for(const y in c){const h=c[y];var u=h.input.required;h.input.optional!==void 0&&(u=Object.assign({},h.input.required,h.input.optional));for(const _ in u){const w=u[_][0];Array.isArray(w)||i.push(w)}for(const _ in h.output){const g=h.output[_];i.push(g)}}return i}function a(i){var c=n();for(const u of c)i.colors.node_slot[u]||(i.colors.node_slot[u]="");return i.colors.node_slot=o(i.colors.node_slot),i}const r=async i=>{if(i=await a(i),i.colors){if(i.colors.node_slot&&(Object.assign(e.default_connection_color_byType,i.colors.node_slot),Object.assign(f.LGraphCanvas.link_type_colors,i.colors.node_slot)),i.colors.litegraph_base){e.node_title_color=i.colors.litegraph_base.NODE_TITLE_COLOR,e.default_link_color=i.colors.litegraph_base.LINK_COLOR;for(const c in i.colors.litegraph_base)i.colors.litegraph_base.hasOwnProperty(c)&&f.LiteGraph.hasOwnProperty(c)&&(f.LiteGraph[c]=i.colors.litegraph_base[c])}e.draw(!0,!0)}};let d=Rt.dark;await r(d)}function Ht(){f.LiteGraph.search_filter_enabled=!1,f.LiteGraph.middle_click_slot_add_default_node=!0}async function Wt(t,s,e){var c;var o=s.name;const n=(c=s.input)==null?void 0:c.required;for(const u in n){var a=n[u];if(typeof a[0]!="string")continue;var r=a[0];if(r in j){var d=a[1];if(!(d!=null&&d.forceInput))continue}if(r in e.slot_types_default_out||(e.slot_types_default_out[r]=["Reroute"]),e.slot_types_default_out[r].includes(o))continue;e.slot_types_default_out[r].push(o);const y=r.toLocaleLowerCase();y in f.LiteGraph.registered_slot_in_types||(f.LiteGraph.registered_slot_in_types[y]={nodes:[]}),f.LiteGraph.registered_slot_in_types[y].nodes.push(t.comfyClass)}var i=s.output;for(const u in i){var r=i[u];r in e.slot_types_default_in||(e.slot_types_default_in[r]=["Reroute"]),e.slot_types_default_in[r].push(o),r in f.LiteGraph.registered_slot_out_types||(f.LiteGraph.registered_slot_out_types[r]={nodes:[]}),f.LiteGraph.registered_slot_out_types[r].nodes.push(t.comfyClass),f.LiteGraph.slot_types_out.includes(r)||f.LiteGraph.slot_types_out.push(r)}f.LiteGraph.slot_types_default_out={},f.LiteGraph.slot_types_default_in={};for(const u in e.slot_types_default_out)f.LiteGraph.slot_types_default_out[u]=e.slot_types_default_out[u].slice(0,5);for(const u in e.slot_types_default_in)f.LiteGraph.slot_types_default_in[u]=e.slot_types_default_in[u].slice(0,5)}async function At(t,s,e){await Gt(s,e),await zt(s),await Dt(t,s,e)}async function Ft(t,s,e){await Ht()}function Mt(t){if(t==null)return"(unknown error)";const s=t.traceback.join("");return t.node_id,`Error occurred when executing ${t.node_type}:

${t.exception_message}

${s}`}function Vt(t,s){window.addEventListener("status",({detail:e})=>{console.log("status",e)}),window.addEventListener("reconnecting",()=>{console.log("Reconnecting...")}),window.addEventListener("progress",({detail:e})=>{s.setDirtyCanvas(!0,!1)}),window.addEventListener("executing",({detail:e})=>{L.currentExecutingNode=e,s.setDirtyCanvas(!0,!1)}),window.addEventListener("executed",({detail:e})=>{L.currentExecutingNode=null;const o=s.getNodeById(e.node);o&&o.onExecuted&&o.onExecuted(e.output)}),window.addEventListener("execution_start",({detail:e})=>{L.lastErrorNode=null,G.info("Workflow Start")}),window.addEventListener("execution_success",({detail:e})=>{G.info("Workflow Execution Success"),s.stop()}),window.addEventListener("execution_error",({detail:e})=>{const o=Mt(e);L.lastErrorNode=e,L.currentExecutingNode=null,s.stop(),console.error(o)})}async function Bt(t){var s,e,o,n;((n=(o=(e=(s=t==null?void 0:t.input)==null?void 0:s.required)==null?void 0:e.path)==null?void 0:o[1])==null?void 0:n.select_file_path)===!0&&(t.input.required.selectfile=["SELECTFILE"])}async function $t(t,s,e,o){if(s.name==="ShowText"){let n=function(a){var r,d;if(this.widgets){const i=this.widgets.findIndex(c=>c.name==="text");if(i!==-1){for(let c=i;c<this.widgets.length;c++)(d=(r=this.widgets[c]).onRemove)==null||d.call(r);this.widgets.length=i}}for(const i of a){const c=j.STRING(this,"text",["STRING",{multiline:!0}],e,o).widget;c.inputEl.readOnly=!0,c.inputEl.style.opacity=1,c.value=i}requestAnimationFrame(()=>{var c;const i=this.computeSize();i[0]<this.size[0]&&(i[0]=this.size[0]),i[1]<this.size[1]&&(i[1]=this.size[1]),(c=this.onResize)==null||c.call(this,i),e.setDirtyCanvas(!0,!1)})};t.onExecuted,t.prototype.onExecuted=function(a){n.call(this,a.text)}}}async function Pt(t,s,e){var n;const o={slot_types_default_out:{},slot_types_default_in:{}};for(const a in t){const r=t[a];await Bt(r);const d=(n=class extends f.LGraphNode{constructor(u){var w,x,T,C,v,k;super(u);E(this,"comfyClass",r.name);E(this,"graph",s);E(this,"canvas",e);const y=r.input.required;var h=r.input.required;r.input.optional!=null&&(h=Object.assign({},r.input.required,r.input.optional));const _={minWidth:1,minHeight:1};for(const m in h){const N=h[m],b=N[0],O=N[1]??{},S=[b,O],X=y&&m in y;let M=!0;(w=S[1])!=null&&w.forceInput?this.addInput(m,b):Array.isArray(b)?Object.assign(_,j.COMBO(this,m,S)||{}):`${b}:${m}`in j?Object.assign(_,j[`${b}:${m}`](this,m,S,this.graph,this.canvas)||{}):b in j?Object.assign(_,j[b](this,m,S,this.graph,this.canvas)||{}):(this.addInput(m,b),M=!1),M&&(_!=null&&_.widget)&&((x=_.widget).options??(x.options={}),X||(_.widget.options.inputIsOptional=!0),(T=S[1])!=null&&T.forceInput&&(_.widget.options.forceInput=!0),(C=S[1])!=null&&C.defaultInput&&(_.widget.options.defaultInput=!0),(v=S[1])!=null&&v.advanced&&(_.widget.advanced=!0),(k=S[1])!=null&&k.hidden&&(_.widget.hidden=!0))}for(const m in r.output){let N=r.output[m];N instanceof Array&&(N="COMBO");const b=r.output_name[m]||N,S={shape:r.output_is_list[m]?f.LiteGraph.GRID_SHAPE:f.LiteGraph.CIRCLE_SHAPE};this.addOutput(b,N,S)}const g=this.computeSize();g[0]=Math.max(_.minWidth,g[0]*1.5),g[1]=Math.max(_.minHeight,g[1]),this.size=g,this.serialize_widgets=!0}configure(u){const y=(h,_)=>{const g={..._};if(h.widget===void 0&&_.widget!==void 0)return this.inputs.push(h),_;for(const w of["name","type","shape"])h[w]!==void 0&&(g[w]=h[w]);return g};for(const h of["inputs","outputs"]){const _=u[h]??[];u[h]=_.map((g,w)=>y(this[h][w]??{},g))}super.configure(u)}},E(n,"title",r.display_name||r.name),E(n,"nodeData",r),E(n,"category"),n);await $t(d,r,s,e),await Wt(d,r,o),f.LiteGraph.registerNodeType(a,d),d.category=r.category}}async function qt(t,s,e){const o=new f.LGraph,n=new f.LGraphCanvas(t,o);function a(){const d=Math.max(window.devicePixelRatio,1),{width:i,height:c}=t.getBoundingClientRect();t.width=Math.round(i*d),t.height=Math.round(c*d),t.getContext("2d").scale(d,d),n.draw(!0,!0)}a(),window.addEventListener("resize",a),f.LiteGraph.release_link_on_empty_shows_menu=!0,f.LiteGraph.alt_drag_do_clone_nodes=!0,f.LiteGraph.clearRegisteredTypes();const r=await dt();await Ft(),await Pt(r,o,n),await At(r,o,n),await ft(),Vt(n,o),ct(),s(o),e(n)}function Ut({setGraph:t,setCanvas:s,canvasRef:e}){I.useEffect(()=>{e.current&&qt(e.current,t,s)},[])}function Zt(){const t=I.useRef(null),[s,e]=I.useState(void 0),[o,n]=I.useState(void 0);return Ut({setGraph:e,setCanvas:n,canvasRef:t}),p.jsxs(p.Fragment,{children:[p.jsx(Tt,{graph:s,canvas:o}),p.jsx("canvas",{style:{position:"absolute",zIndex:0,touchAction:"none"},ref:t,id:"graph-canvas"})]})}U(document.getElementById("root")).render(p.jsxs(p.Fragment,{children:[p.jsx(Zt,{}),p.jsx(st,{style:{marginTop:"1.25em"},position:"top-right",autoClose:5e3,pauseOnHover:!1,draggable:!1,hideProgressBar:!0,theme:"colored"})]}));
