var ee=Object.defineProperty;var te=(e,s,t)=>s in e?ee(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var E=(e,s,t)=>te(e,typeof s!="symbol"?s+"":s,t);import{j as p,M as P,B as q,T as W,a as U,b as oe,d as ie,S as se}from"./@mui/material-BQdAtyIz.js";import{c as ne,r as S}from"./vendor-DM_OWPAt.js";import{B as C,Q as re}from"./react-toastify-6PrFfkGr.js";import{a as H}from"./axios-DXsv3KKR.js";import{F as ae}from"./file-saver-B2VyKP5u.js";import{H as le}from"./react-helmet-D1WOPrvJ.js";import{v as ue}from"./uuid-Ch9TGLTe.js";import{l as f}from"./litegraph.js-CpwqBUsj.js";import{z as l}from"./zod-DXqQCM1T.js";import"./@emotion/react-6hH5lGvJ.js";import"./@emotion/styled-BTak2TOH.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();var Z,B=ne;Z=B.createRoot,B.hydrateRoot;async function ce(e){const s=e.serialize(),t={};for(const o of e.computeExecutionOrder(!1,0)){const n=s.nodes.find(d=>d.id===o.id);if(o.isVirtualNode){o.applyToGraph&&o.applyToGraph(s);continue}if(o.mode===2||o.mode===4)continue;const a={},r=o.widgets;if(r)for(const d in r){const i=r[d];(!i.options||i.options.serialize!==!1)&&(a[i.name]=i.serializeValue?await i.serializeValue(n,d):i.value)}for(let d in o.inputs){let i=o.getInputNode(d);if(i){let u=o.getInputLink(d);for(;i.mode===4||i.isVirtualNode;){let c=!1;if(i.isVirtualNode)u=i.getInputLink(u.origin_slot),u&&(i=i.getInputNode(u.target_slot),i&&(c=!0));else if(u&&i.mode===4){let y=[u.origin_slot];if(i.inputs){y=y.concat(Object.keys(i.inputs));for(let h in y)if(h=y[h],i.inputs[h].type===o.inputs[d].type){u=i.getInputLink(h),u&&(i=i.getInputNode(h)),c=!0;break}}}if(!c)break}u&&(a[o.inputs[d].name]=[String(u.origin_id),parseInt(u.origin_slot)])}}t[String(o.id)]={inputs:a,class_type:o.comfyClass}}for(const o in t)for(const n in t[o].inputs)Array.isArray(t[o].inputs[n])&&t[o].inputs[n].length===2&&!t[t[o].inputs[n][0]]&&delete t[o].inputs[n];return{workflow:s,output:t}}const K=ue().toString().replace(/-/gi,"");class de{constructor(){E(this,"currentExecutingNode",null);E(this,"lastErrorNode",null);E(this,"errorNode",null)}}const L=new de;function pe(){const e=f.LGraphCanvas.prototype.drawNode,s=f.LGraphCanvas.prototype.drawNodeShape;f.LGraphCanvas.prototype.drawNodeShape=function(t,o,n,a,r,d,i){var _;const u=s.apply(this,arguments),c=(_=L.errorNode)==null?void 0:_[t.id.toString()];let y=null,h=1;if(t.id===+L.currentExecutingNode?y="#0f0":c!=null&&c.errors?(y="red",h=2):L.lastErrorNode&&+L.lastErrorNode.node_id===t.id&&(y="#f0f",h=2),y){const g=t._shape||t.shape||f.LiteGraph.ROUND_SHAPE;o.lineWidth=h,o.globalAlpha=.8,o.beginPath(),g==f.LiteGraph.BOX_SHAPE?o.rect(-6,-6-f.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+f.LiteGraph.NODE_TITLE_HEIGHT):g==f.LiteGraph.ROUND_SHAPE||g==f.LiteGraph.CARD_SHAPE&&t.flags.collapsed?o.roundRect(-6,-6-f.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+f.LiteGraph.NODE_TITLE_HEIGHT,this.round_radius*2):g==f.LiteGraph.CARD_SHAPE?o.roundRect(-6,-6-f.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+f.LiteGraph.NODE_TITLE_HEIGHT,[this.round_radius*2,this.round_radius*2,2,2]):g==f.LiteGraph.CIRCLE_SHAPE&&o.arc(n[0]*.5,n[1]*.5,n[0]*.5+6,0,Math.PI*2),o.strokeStyle=y,o.stroke(),o.strokeStyle=a,o.globalAlpha=1}if(c){o.lineWidth=2,o.strokeStyle="red";for(const g of c.errors)if(g.extra_info&&g.extra_info.input_name){const w=t.findInputSlot(g.extra_info.input_name);if(w!==-1){let x=t.getConnectionPos(!0,w);o.beginPath(),o.arc(x[0]-t.pos[0],x[1]-t.pos[1],12,0,2*Math.PI,!1),o.stroke()}}}return u},f.LGraphCanvas.prototype.drawNode=function(t,o){var n=this.editor_alpha,a=t.bgcolor;t.mode===2&&(this.editor_alpha=.4),t.mode===4&&(t.bgcolor="#FF00FF",this.editor_alpha=.2);const r=e.apply(this,arguments);return this.editor_alpha=n,t.bgcolor=a,r}}let O=null;async function fe(){const e=await H.get("/api/object_info");if(e.status===200)return e.data}async function he(e){L.errorNode=null;const s=await ce(e),t=await H.post("/api/workflow",{workflow:s.output,client_id:K});if(t.status===200)return await t.data;throw{response:await t.data}}function J(e){if(!O)return O=new WebSocket(`/ws?clientId=${K}`),O.binaryType="arraybuffer",O.addEventListener("open",()=>{e?(console.log("WebSocket Reconnected"),dispatchEvent(new CustomEvent("reconnected"))):console.log("WebSocket Open")}),O.addEventListener("error",()=>{O&&O.close(),console.log("WebSocket Error")}),O.addEventListener("close",()=>{console.log("Reconnecting"),dispatchEvent(new CustomEvent("reconnecting")),setTimeout(()=>{O=null,O=J(!0)},300)}),O.addEventListener("message",s=>{try{const t=JSON.parse(s.data);switch(t.type){case"status":dispatchEvent(new CustomEvent("status",{detail:t.data.status}));break;case"progress":dispatchEvent(new CustomEvent("progress",{detail:t.data}));break;case"executing":dispatchEvent(new CustomEvent("executing",{detail:t.data.node}));break;case"progress":case"executed":case"execution_start":case"execution_success":case"execution_error":case"execution_cached":case"logs":dispatchEvent(new CustomEvent(t.type,{detail:t.data}));break}}catch(t){console.warn("Unhandled message:",s.data,t)}}),O}const F=l.union([l.number().int(),l.string()]),$=l.union([l.object({0:l.number(),1:l.number()}).passthrough().transform(e=>[e[0],e[1]]),l.tuple([l.number(),l.number()])]),ge=l.object({collapsed:l.boolean().optional(),pinned:l.boolean().optional(),allow_interaction:l.boolean().optional(),horizontal:l.boolean().optional(),skip_repeated_outputs:l.boolean().optional()}).passthrough(),M=l.union([l.string(),l.array(l.string()),l.number()]),D=l.union([l.number().int(),l.string().transform(e=>parseInt(e)).refine(e=>!isNaN(e),{message:"Invalid number"})]),me=l.object({name:l.string(),type:M,link:l.number().nullable().optional(),slot_index:D.optional()}).passthrough(),ye=l.object({name:l.string(),type:M,links:l.array(l.number()).nullable().optional(),slot_index:D.optional()}).passthrough(),_e=l.object({"Node name for S&R":l.string().optional()}).passthrough(),we=l.union([l.array(l.any()),l.record(l.any())]),be=l.object({id:F,type:l.string(),pos:$,size:$,flags:ge,order:l.number(),mode:l.number(),inputs:l.array(me).optional(),outputs:l.array(ye).optional(),properties:_e,widgets_values:we.optional(),color:l.string().optional(),bgcolor:l.string().optional()}).passthrough(),Ee=l.tuple([l.number(),F,D,F,D,M]),xe=l.object({title:l.string(),bounding:l.tuple([l.number(),l.number(),l.number(),l.number()]),color:l.string().optional(),font_size:l.number().optional(),locked:l.boolean().optional()}).passthrough(),ve=l.object({links_ontop:l.boolean().optional(),align_to_grid:l.boolean().optional()}).passthrough(),Ne=l.object({last_node_id:l.number(),last_link_id:l.number(),nodes:l.array(be),links:l.array(Ee),groups:l.array(xe).optional(),config:ve.optional().nullable(),version:l.number()});function Le(e){try{const s=JSON.parse(e);return Ne.parse(s)}catch(s){throw s instanceof l.ZodError?console.error("Validation error:",s.errors):console.error("Parsing error:",s),Error(s)}}const ke=(e,s,t,o)=>{var a;const n=(a=o.target.files)==null?void 0:a[0];if(n&&s){L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null;const r=new FileReader;return r.onload=d=>{var i;try{const u=(i=d.target)==null?void 0:i.result,c=Le(u);s.clear(),s.configure(c),e&&(e.value=""),t.ds.offset=[0,0],t.setZoom(1,[0,0]),t.setDirty(!0,!0),C.success("Loading Workflow Success")}catch{C.error("Error loading workflow file. Please ensure it is a valid workflow.")}},r.onerror=()=>{C.error("Error reading file")},r.readAsText(n),n.name}},Se={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",height:"auto",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function Ie(){const[e,s]=S.useState(!1),t=()=>s(!0),o=()=>s(!1),[n,a]=S.useState({traceback:[],node_id:"",node_type:"",exception_type:"",exception_message:""});return window.addEventListener("execution_error",({detail:r})=>{a(r),t()}),p.jsx("div",{children:p.jsx(P,{open:e,onClose:o,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:p.jsxs(q,{sx:Se,children:[p.jsxs(W,{id:"modal-modal-title",variant:"h5",component:"h2",children:[p.jsx("i",{className:"pi pi-exclamation-triangle",style:{color:"#ff4545"}})," ","Error Workflow Execution"]}),p.jsxs(W,{id:"modal-modal-title",fontFamily:"monospace",children:[n.exception_type," ",p.jsx("br",{})," ",n.exception_message," "]}),p.jsx(W,{id:"modal-modal-description",sx:{mt:2},fontFamily:"monospace",variant:"caption",color:"#828282",children:n.traceback}),p.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:p.jsx(U,{onClick:o,children:"Close"})})]})})})}const Oe={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"400px",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function Te({handleOpen:e,handleClose:s,open:t,invaliddetail:o}){return p.jsx("div",{children:p.jsx(P,{open:t,onClose:s,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:p.jsxs(q,{sx:Oe,children:[p.jsxs(W,{id:"modal-modal-title",variant:"h5",component:"h2",children:[p.jsx("i",{className:"pi pi-exclamation-circle",style:{color:"#ffc400"}})," ","Invalid Workflow"]}),p.jsxs(W,{id:"modal-modal-description",sx:{mt:2},fontFamily:"monospace",variant:"caption",children:[p.jsx("p",{style:{fontSize:"120%"},children:o.error.message}),Object.keys(o.node_errors).map(n=>p.jsxs("p",{style:{fontSize:"110%"},children:[p.jsxs("span",{style:{fontWeight:"bold"},children:["#",n," ",o.node_errors[n].class_type," :"]}),p.jsx("br",{}),o.node_errors[n].errors.map(a=>p.jsxs("span",{children:[`${a.details} - ${a.message}`,p.jsx("br",{})]},Date.now()+Math.random()))]},Date.now()+Math.random()))]}),p.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:p.jsx(U,{onClick:s,children:"Close"})})]})})})}function Ce(){const[e,s]=S.useState(!1);S.useEffect(()=>{e?C.error("Reconnecting",{autoClose:!1}):(C.dismiss(),C.success("Connected to Websocket"))},[e]),window.addEventListener("reconnecting",()=>{e||s(!0)}),window.addEventListener("reconnected",()=>{e&&s(!1)})}function je({graph:e,canvas:s}){const t=S.useRef(null),[o,n]=S.useState(!1),[a,r]=S.useState(!0),[d,i]=S.useState(null),[u,c]=S.useState("untitled"),[y,h]=S.useState({error:{},node_errors:{}});Ce();const[_,g]=S.useState(!1),w=()=>{var b;(b=t.current)==null||b.click()},x=()=>{if(e){const b=JSON.stringify(e.serialize()),T=new Blob([b],{type:"text/plain;charset=utf-8"}),I=prompt("Enter Filename : ",`workflow-${Date.now()}`);if(I===null)return;ae.saveAs(T,`${I}.json`),i(e.serialize()),c(I)}},j=()=>g(!0),z=()=>g(!1),v=()=>{e&&confirm("Clear workflow?")&&(L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null,e.clear(),C.info("Workflow Cleared"),c("untitled"),s.ds.offset=[0,0],s.setZoom(1,[0,0]),s.setDirty(!0,!0))},k=async()=>{try{L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null;const b=await he(e);e.start(),n(!0)}catch(b){L.errorNode=b.response.data.node_errors,h(b.response.data),g(!0),n(!1)}},m=async()=>{try{await H.post("/api/interrupt",null),await C.warning("Workflow Interrupt")}catch(b){console.error(b)}finally{n(!1)}};window.addEventListener("execution_success",({detail:b})=>{n(!1)}),window.addEventListener("execution_error",({detail:b})=>{n(!1)});const N=oe({palette:{mode:"dark"}});return p.jsxs(p.Fragment,{children:[p.jsx(le,{children:p.jsxs("title",{children:[a?"":"*",u+" ","- AdvFBP"]})}),p.jsx(ie,{theme:N,children:p.jsxs(se,{enableColorScheme:!0,children:[p.jsx(Ie,{}),p.jsx(Te,{handleOpen:j,handleClose:z,open:_,invaliddetail:y})]})}),p.jsxs("div",{className:"topbar",children:[p.jsxs("div",{className:"leftmenu",children:[p.jsxs("button",{className:"buttonmenu",onClick:x,children:[p.jsx("i",{className:"pi pi-save"})," Save"]}),p.jsxs("button",{className:"buttonmenu",onClick:w,children:[p.jsx("i",{className:"pi pi-upload"})," Load"]}),p.jsx("input",{type:"file",ref:t,onChange:b=>{const T=ke(t.current,e,s,b);T&&c(T.split(".")[0])},accept:".json",style:{display:"none"}}),p.jsxs("button",{className:"buttonmenu",onClick:v,children:[p.jsx("i",{className:"pi pi-eraser"})," Clear"]})]}),p.jsx("div",{className:"rightmenu",children:p.jsx("button",{className:"buttonmenuright",onClick:async()=>{o?await m():await k()},children:o?p.jsxs("span",{children:[p.jsx("i",{className:"pi pi-stop"})," Interrupt Workflow"]}):p.jsxs("span",{children:[p.jsx("i",{className:"pi pi-play"})," Run Workflow"]})})})]})]})}const R=Symbol(),A=Symbol();function Ge(e,s,t,o,n){function r(i){var _,g;if(e.widgets[0].last_y==null)return;let u=e.widgets[0].last_y,c=i[1]-u,y=0;const h=[];for(let w=0;w<e.widgets.length;w++){const x=e.widgets[w];x.type==="customtext"?h.push(x):x.computeSize?y+=x.computeSize(null)[1]+4:y+=f.LiteGraph.NODE_WIDGET_HEIGHT+4}c-=y,c/=h.length+(((_=e.imgs)==null?void 0:_.length)||0),c<50&&(c=50,e.size[1]=u+y+c*(h.length+(((g=e.imgs)==null?void 0:g.length)||0)),e.graph.setDirtyCanvas(!0));for(const w of e.widgets)w.y=u,w.type==="customtext"?(u+=c,w.computedHeight=c-h.length*4):w.computeSize?u+=w.computeSize()[1]+4:u+=f.LiteGraph.NODE_WIDGET_HEIGHT+4;e.inputHeight=c}const d={type:"customtext",name:s,get value(){return this.inputEl.value},set value(i){this.inputEl.value=i},draw:function(i,u,c,y,h){this.parent.inputHeight||r(e.size);const _=n.ds.scale>.5&&this.type==="customtext",g=10,w=i.canvas.getBoundingClientRect(),x=new DOMMatrix().scaleSelf(w.width/i.canvas.width,w.height/i.canvas.height).multiplySelf(i.getTransform()).translateSelf(g,g+y),j=new DOMMatrix().scaleSelf(x.a,x.d);Object.assign(this.inputEl.style,{transformOrigin:"0 0",transform:j,left:`${x.a+x.e}px`,top:`${x.d+x.f}px`,width:`${c-g*2}px`,height:`${this.parent.inputHeight-g*2}px`,position:"absolute",background:e.color?e.color:"",color:e.color?"white":"",zIndex:o._nodes.indexOf(e)}),this.inputEl.hidden=!_}};if(d.inputEl=document.createElement("textarea"),d.inputEl.className="comfy-multiline-input",d.inputEl.value=t.defaultVal,d.inputEl.placeholder=t.placeholder||"",document.addEventListener("mousedown",function(i){d.inputEl.contains(i.target)||d.inputEl.blur()}),d.parent=e,document.body.appendChild(d.inputEl),e.addCustomWidget(d),n.onDrawBackground=function(){for(let i in o._nodes){const u=o._nodes[i];for(let c in u.widgets){let y=u.widgets[c];Object.hasOwn(y,"inputEl")&&(y.inputEl.style.left="-8000px",y.inputEl.style.position="absolute")}}},e.onRemoved=function(){for(let i in this.widgets)this.widgets[i].inputEl&&this.widgets[i].inputEl.remove()},d.onRemove=()=>{var i;(i=d.inputEl)==null||i.remove(),--e[R]||(e.onResize=e[A],delete e[R],delete e[A])},e[R])e[R]++;else{e[R]=1;const i=e[A]=e.onResize;e.onResize=function(u){r(u),i&&i.apply(this,arguments)}}return{minWidth:400,minHeight:200,widget:d}}function X(e,s){let t=e[1].default,{min:o,max:n,step:a}=e[1];return t==null&&(t=0),o==null&&(o=Number.MIN_SAFE_INTEGER),n==null&&(n=Number.MAX_SAFE_INTEGER),a==null&&(a=s),e[1].min=o,e[1].max=n,e[1].step=1*a,{val:t,config:{...e[1]}}}function Q(e){return e==="slider"?"slider":"number"}function ze(e,s,t){let o=Q(t[1].display);const{val:n,config:a}=X(t,1);return Object.assign(a,{precision:0}),{widget:e.addWidget(o,s,n,function(r){const d=this.options.step/10;let i=this.options.min%d;isNaN(i)&&(i=0),this.value=Math.round((r-i)/d)*d+i},a)}}const G={FLOAT(e,s,t){let o=Q(t[1].display),{val:n,config:a}=X(t,.5);return{widget:e.addWidget(o,s,n,()=>{},a)}},INT(e,s,t){return ze(e,s,t)},BOOLEAN(e,s,t){let o=t[1].default;return{widget:e.addWidget("toggle",s,o,()=>{},{on:t[1].label_on,off:t[1].label_off})}},STRING(e,s,t,o,n){const a=t[1].defaultVal?t[1].defaultVal:"",r=!!t[1].multiline;let d;return r?d=Ge(e,s,t[1],o,n):d={widget:e.addWidget("text",s,a,()=>{},{})},t[1].dynamicPrompts!=null&&(d.widget.dynamicPrompts=t[1].dynamicPrompts),d},COMBO(e,s,t){const o=t[0];let n=o[0];return t[1]&&t[1].default&&(n=t[1].default),{widget:e.addWidget("combo",s,n,()=>{},{values:o})}},SELECTFILE(e,s,t,o,n){let a;const r=document.createElement("input");return Object.assign(r,{type:"file",style:"display: none",onchange:async()=>{if(r.files.length){const d=r.files[0],i=new FormData;i.append("file",d);const u=await H.post("/api/upload/file",i);if(u.status!==200){console.error(u.data);return}e.widgets[0].value=u.data.path,r.value=""}}}),document.body.append(r),a=e.addWidget("button","Select File","file",()=>{r.click()}),e.onRemoved=function(){r.remove()},a.serialize=!1,{widget:a}}};async function Re(e,s){class t{constructor(){E(this,"properties");E(this,"serialize_widgets");E(this,"isVirtualNode");E(this,"color",f.LGraphCanvas.node_colors.yellow.color);E(this,"bgcolor",f.LGraphCanvas.node_colors.yellow.bgcolor);E(this,"groupcolor",f.LGraphCanvas.node_colors.yellow.groupcolor);this.properties||(this.properties={},this.properties.text=""),G.STRING(this,"",["",{defaultVal:this.properties.text,multiline:!0}],e,s),this.serialize_widgets=!0,this.isVirtualNode=!0}}E(t,"category"),f.LiteGraph.registerNodeType("Note",Object.assign(t,{title_mode:f.LiteGraph.NORMAL_TITLE,title:"Note",collapsable:!0})),t.category="utils"}async function We(e,s){const o=class o{constructor(){E(this,"size");E(this,"__outputType");E(this,"inputs");E(this,"outputs");E(this,"isVirtualNode");E(this,"horizontal");E(this,"properties");this.properties||(this.properties={}),this.properties.showOutputText=o.defaultVisibility,this.properties.horizontal=!1;const a=this;a.addInput("","*"),a.addOutput(this.properties.showOutputText?"*":"","*"),a.onConnectionsChange=function(r,d,i,u){var z;if(this.applyOrientation(),i&&r===f.LiteGraph.OUTPUT&&new Set(this.outputs[0].links.map(k=>e.links[k].type).filter(k=>k!=="*")).size>1){const k=[];for(let m=0;m<this.outputs[0].links.length-1;m++){const N=this.outputs[0].links[m],b=e.links[N];k.push(b)}for(const m of k)e.getNodeById(m.target_id).disconnectInput(m.target_slot)}let c=this,y=[],h=null,_=null;for(;c;){y.unshift(c);const v=c.inputs[0].link;if(v!==null){const k=e.links[v],m=e.getNodeById(k.origin_id);if(m.constructor.type==="Reroute")m===this?(c.disconnectInput(k.target_slot),c=null):c=m;else{_=c,h=((z=m.outputs[k.origin_slot])==null?void 0:z.type)??null;break}}else{c=null;break}}const g=[this];let w=null;for(;g.length;){c=g.pop();const v=(c.outputs?c.outputs[0].links:[])||[];if(v.length)for(const k of v){const m=e.links[k];if(!m)continue;const N=e.getNodeById(m.target_id);if(N.constructor.type==="Reroute")g.push(N),y.push(N);else{const T=N.inputs&&N.inputs[m==null?void 0:m.target_slot]&&N.inputs[m.target_slot].type?N.inputs[m.target_slot].type:null;h&&T!==h?N.disconnectInput(m.target_slot):w=T}}}const x=h||w||"*",j=f.LGraphCanvas.link_type_colors[x];for(const v of y){v.outputs[0].type=h||"*",v.__outputType=x,v.outputs[0].name=v.properties.showOutputText?x:"",v.size=v.computeSize(),v.applyOrientation();for(const k of v.outputs[0].links||[]){const m=e.links[k];m&&(m.color=j)}}if(_){const v=e.links[_.inputs[0].link];v&&(v.color=j)}},this.clone=function(){const r=o.prototype.clone.apply(this);return r.removeOutput(0),r.addOutput(this.properties.showOutputText?"*":"","*"),r.size=r.computeSize(),r},this.isVirtualNode=!0}getExtraMenuOptions(a,r){r.unshift({content:(this.properties.showOutputText?"Hide":"Show")+" Type",callback:()=>{this.properties.showOutputText=!this.properties.showOutputText,this.properties.showOutputText?this.outputs[0].name=this.__outputType||this.outputs[0].type:this.outputs[0].name="",this.size=this.computeSize(),this.applyOrientation(),e.setDirtyCanvas(!0,!0)}},{content:(o.defaultVisibility?"Hide":"Show")+" Type By Default",callback:()=>{o.setDefaultTextVisibility(!o.defaultVisibility)}},{content:"Set "+(this.properties.horizontal?"Horizontal":"Vertical"),callback:()=>{this.properties.horizontal=!this.properties.horizontal,this.applyOrientation()}})}applyOrientation(){this.horizontal=this.properties.horizontal,this.horizontal?this.inputs[0].pos=[this.size[0]/2,0]:delete this.inputs[0].pos,e.setDirtyCanvas(!0,!0)}computeSize(){return[this.properties.showOutputText&&this.outputs&&this.outputs.length?Math.max(75,f.LiteGraph.NODE_TEXT_SIZE*this.outputs[0].name.length*.6+40):75,26]}clone(){}static setDefaultTextVisibility(a){o.defaultVisibility=a,a?localStorage["Comfy.RerouteNode.DefaultVisibility"]="true":delete localStorage["Comfy.RerouteNode.DefaultVisibility"]}};E(o,"category"),E(o,"defaultVisibility");let t=o;t.setDefaultTextVisibility(!!localStorage["Comfy.RerouteNode.DefaultVisibility"]),f.LiteGraph.registerNodeType("Reroute",Object.assign(t,{title_mode:f.LiteGraph.NO_TITLE,title:"Reroute",collapsable:!1})),t.category="utils"}const De={dark:{id:"dark",name:"Dark (Default)",colors:{node_slot:{INT:"#FFD500",FLOAT:"#A8DADC",STRING:"#ad7452",COMBO:"#FFA931",NDARRAY:"#6EE7B7"}}}};async function He(e,s,t){const o=i=>Object.keys(i).sort().reduce((u,c)=>(u[c]=i[c],u),{});function n(){var i=[];const u=e;for(const y in u){const h=u[y];var c=h.input.required;h.input.optional!==void 0&&(c=Object.assign({},h.input.required,h.input.optional));for(const _ in c){const w=c[_][0];Array.isArray(w)||i.push(w)}for(const _ in h.output){const g=h.output[_];i.push(g)}}return i}function a(i){var u=n();for(const c of u)i.colors.node_slot[c]||(i.colors.node_slot[c]="");return i.colors.node_slot=o(i.colors.node_slot),i}const r=async i=>{if(i=await a(i),i.colors){if(i.colors.node_slot&&(Object.assign(t.default_connection_color_byType,i.colors.node_slot),Object.assign(f.LGraphCanvas.link_type_colors,i.colors.node_slot)),i.colors.litegraph_base){t.node_title_color=i.colors.litegraph_base.NODE_TITLE_COLOR,t.default_link_color=i.colors.litegraph_base.LINK_COLOR;for(const u in i.colors.litegraph_base)i.colors.litegraph_base.hasOwnProperty(u)&&f.LiteGraph.hasOwnProperty(u)&&(f.LiteGraph[u]=i.colors.litegraph_base[u])}t.draw(!0,!0)}};let d=De.dark;await r(d)}function Ae(){f.LiteGraph.search_filter_enabled=!1,f.LiteGraph.middle_click_slot_add_default_node=!0}async function Fe(e,s,t){var u;var o=s.name;const n=(u=s.input)==null?void 0:u.required;for(const c in n){var a=n[c];if(typeof a[0]!="string")continue;var r=a[0];if(r in G){var d=a[1];if(!(d!=null&&d.forceInput))continue}if(r in t.slot_types_default_out||(t.slot_types_default_out[r]=["Reroute"]),t.slot_types_default_out[r].includes(o))continue;t.slot_types_default_out[r].push(o);const y=r.toLocaleLowerCase();y in f.LiteGraph.registered_slot_in_types||(f.LiteGraph.registered_slot_in_types[y]={nodes:[]}),f.LiteGraph.registered_slot_in_types[y].nodes.push(e.comfyClass)}var i=s.output;for(const c in i){var r=i[c];r in t.slot_types_default_in||(t.slot_types_default_in[r]=["Reroute"]),t.slot_types_default_in[r].push(o),r in f.LiteGraph.registered_slot_out_types||(f.LiteGraph.registered_slot_out_types[r]={nodes:[]}),f.LiteGraph.registered_slot_out_types[r].nodes.push(e.comfyClass),f.LiteGraph.slot_types_out.includes(r)||f.LiteGraph.slot_types_out.push(r)}f.LiteGraph.slot_types_default_out={},f.LiteGraph.slot_types_default_in={};for(const c in t.slot_types_default_out)f.LiteGraph.slot_types_default_out[c]=t.slot_types_default_out[c].slice(0,5);for(const c in t.slot_types_default_in)f.LiteGraph.slot_types_default_in[c]=t.slot_types_default_in[c].slice(0,5)}async function Me(e,s,t){await Re(s,t),await We(s),await He(e,s,t)}async function Ve(e,s,t){await Ae()}function Be(e){if(e==null)return"(unknown error)";const s=e.traceback.join("");return e.node_id,`Error occurred when executing ${e.node_type}:

${e.exception_message}

${s}`}function $e(e,s){window.addEventListener("status",({detail:t})=>{console.log("status",t)}),window.addEventListener("reconnecting",()=>{console.log("Reconnecting...")}),window.addEventListener("progress",({detail:t})=>{s.setDirtyCanvas(!0,!1)}),window.addEventListener("executing",({detail:t})=>{L.currentExecutingNode=t,s.setDirtyCanvas(!0,!1)}),window.addEventListener("executed",({detail:t})=>{L.currentExecutingNode=null;const o=s.getNodeById(t.node);o&&o.onExecuted&&o.onExecuted(t.output)}),window.addEventListener("execution_start",({detail:t})=>{L.lastErrorNode=null,C.info("Workflow Start")}),window.addEventListener("execution_success",({detail:t})=>{C.info("Workflow Execution Success"),s.stop()}),window.addEventListener("execution_error",({detail:t})=>{const o=Be(t);L.lastErrorNode=t,L.currentExecutingNode=null,s.stop(),console.error(o)})}async function Pe(e){var s,t,o,n;((n=(o=(t=(s=e==null?void 0:e.input)==null?void 0:s.required)==null?void 0:t.path)==null?void 0:o[1])==null?void 0:n.select_file_path)===!0&&(e.input.required.selectfile=["SELECTFILE"])}async function qe(e,s,t,o){if(s.name==="ShowText"){let n=function(a){var r,d;if(this.widgets){const i=this.widgets.findIndex(u=>u.name==="text");if(i!==-1){for(let u=i;u<this.widgets.length;u++)(d=(r=this.widgets[u]).onRemove)==null||d.call(r);this.widgets.length=i}}for(const i of a){const u=G.STRING(this,"text",["STRING",{multiline:!0}],t,o).widget;u.inputEl.readOnly=!0,u.inputEl.style.opacity=1,u.value=i}requestAnimationFrame(()=>{var u;const i=this.computeSize();i[0]<this.size[0]&&(i[0]=this.size[0]),i[1]<this.size[1]&&(i[1]=this.size[1]),(u=this.onResize)==null||u.call(this,i),t.setDirtyCanvas(!0,!1)})};e.onExecuted,e.prototype.onExecuted=function(a){n.call(this,a.text)}}}async function Ue(e,s,t){var n;const o={slot_types_default_out:{},slot_types_default_in:{}};for(const a in e){const r=e[a];await Pe(r);const d=(n=class extends f.LGraphNode{constructor(c){var w,x,j,z,v,k;super(c);E(this,"comfyClass",r.name);E(this,"graph",s);E(this,"canvas",t);const y=r.input.required;var h=r.input.required;r.input.optional!=null&&(h=Object.assign({},r.input.required,r.input.optional));const _={minWidth:1,minHeight:1};for(const m in h){const N=h[m],b=N[0],T=N[1]??{},I=[b,T],Y=y&&m in y;let V=!0;(w=I[1])!=null&&w.forceInput?this.addInput(m,b):Array.isArray(b)?Object.assign(_,G.COMBO(this,m,I)||{}):`${b}:${m}`in G?Object.assign(_,G[`${b}:${m}`](this,m,I,this.graph,this.canvas)||{}):b in G?Object.assign(_,G[b](this,m,I,this.graph,this.canvas)||{}):(this.addInput(m,b),V=!1),V&&(_!=null&&_.widget)&&((x=_.widget).options??(x.options={}),Y||(_.widget.options.inputIsOptional=!0),(j=I[1])!=null&&j.forceInput&&(_.widget.options.forceInput=!0),(z=I[1])!=null&&z.defaultInput&&(_.widget.options.defaultInput=!0),(v=I[1])!=null&&v.advanced&&(_.widget.advanced=!0),(k=I[1])!=null&&k.hidden&&(_.widget.hidden=!0))}for(const m in r.output){let N=r.output[m];N instanceof Array&&(N="COMBO");const b=r.output_name[m]||N,I={shape:r.output_is_list[m]?f.LiteGraph.GRID_SHAPE:f.LiteGraph.CIRCLE_SHAPE};this.addOutput(b,N,I)}const g=this.computeSize();g[0]=Math.max(_.minWidth,g[0]*1.5),g[1]=Math.max(_.minHeight,g[1]),this.size=g,this.serialize_widgets=!0}configure(c){const y=(h,_)=>{const g={..._};if(h.widget===void 0&&_.widget!==void 0)return this.inputs.push(h),_;for(const w of["name","type","shape"])h[w]!==void 0&&(g[w]=h[w]);return g};for(const h of["inputs","outputs"]){const _=c[h]??[];c[h]=_.map((g,w)=>y(this[h][w]??{},g))}super.configure(c)}},E(n,"title",r.display_name||r.name),E(n,"nodeData",r),E(n,"category"),n);await qe(d,r,s,t),await Fe(d,r,o),f.LiteGraph.registerNodeType(a,d),d.category=r.category}}async function Ze(e,s,t){const o=new f.LGraph,n=new f.LGraphCanvas(e,o);function a(){const d=Math.max(window.devicePixelRatio,1),{width:i,height:u}=e.getBoundingClientRect();e.width=Math.round(i*d),e.height=Math.round(u*d),e.getContext("2d").scale(d,d),n.draw(!0,!0)}a(),window.addEventListener("resize",a),f.LiteGraph.release_link_on_empty_shows_menu=!0,f.LiteGraph.alt_drag_do_clone_nodes=!0,f.LiteGraph.clearRegisteredTypes();const r=await fe();await Ve(),await Ue(r,o,n),await Me(r,o,n),J(!1),$e(n,o),pe(),s(o),t(n)}function Ke({setGraph:e,setCanvas:s,canvasRef:t}){S.useEffect(()=>{t.current&&Ze(t.current,e,s)},[])}function Je(){const e=S.useRef(null),[s,t]=S.useState(void 0),[o,n]=S.useState(void 0);return Ke({setGraph:t,setCanvas:n,canvasRef:e}),p.jsxs(p.Fragment,{children:[p.jsx(je,{graph:s,canvas:o}),p.jsx("canvas",{style:{position:"absolute",zIndex:0,touchAction:"none"},ref:e,id:"graph-canvas"})]})}Z(document.getElementById("root")).render(p.jsxs(p.Fragment,{children:[p.jsx(Je,{}),p.jsx(re,{style:{marginTop:"1.25em"},position:"top-right",autoClose:5e3,pauseOnHover:!1,draggable:!1,hideProgressBar:!0,theme:"colored"})]}));
