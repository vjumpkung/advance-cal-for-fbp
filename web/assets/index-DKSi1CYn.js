var J=Object.defineProperty;var Z=(e,o,t)=>o in e?J(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var v=(e,o,t)=>Z(e,typeof o!="symbol"?o+"":o,t);import{r as E,a as K}from"./vendor-wpXbf5jk.js";import{B as I,Q}from"./react-toastify-Df8KVf6C.js";import{F as X}from"./file-saver-B7T6XPHc.js";import{H as Y}from"./react-helmet-CuerYPg1.js";import{a as B}from"./axios-DXsv3KKR.js";import{z as s}from"./zod-DXqQCM1T.js";import{l as b}from"./litegraph.js-CsUhbCts.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();var V={exports:{}},z={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee=E,te=Symbol.for("react.element"),oe=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,se=ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,re={key:!0,ref:!0,__self:!0,__source:!0};function F(e,o,t){var i,r={},n=null,g=null;t!==void 0&&(n=""+t),o.key!==void 0&&(n=""+o.key),o.ref!==void 0&&(g=o.ref);for(i in o)ie.call(o,i)&&!re.hasOwnProperty(i)&&(r[i]=o[i]);if(e&&e.defaultProps)for(i in o=e.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:te,type:e,key:n,ref:g,props:r,_owner:se.current}}z.Fragment=oe;z.jsx=F;z.jsxs=F;V.exports=z;var f=V.exports,$,M=K;$=M.createRoot,M.hydrateRoot;async function ne(e){const o=e.serialize(),t={};for(const i of e.computeExecutionOrder(!1,0)){const r=o.nodes.find(l=>l.id===i.id);if(i.isVirtualNode){i.applyToGraph&&i.applyToGraph(o);continue}if(i.mode===2||i.mode===4)continue;const n={},g=i.widgets;if(g)for(const l in g){const a=g[l];(!a.options||a.options.serialize!==!1)&&(n[a.name]=a.serializeValue?await a.serializeValue(r,l):a.value)}for(let l in i.inputs){let a=i.getInputNode(l);if(a){let u=i.getInputLink(l);for(;a.mode===4||a.isVirtualNode;){let m=!1;if(a.isVirtualNode)u=a.getInputLink(u.origin_slot),u&&(a=a.getInputNode(u.target_slot),a&&(m=!0));else if(u&&a.mode===4){let p=[u.origin_slot];if(a.inputs){p=p.concat(Object.keys(a.inputs));for(let c in p)if(c=p[c],a.inputs[c].type===i.inputs[l].type){u=a.getInputLink(c),u&&(a=a.getInputNode(c)),m=!0;break}}}if(!m)break}u&&(n[i.inputs[l].name]=[String(u.origin_id),parseInt(u.origin_slot)])}}t[String(i.id)]={inputs:n,class_type:i.comfyClass}}for(const i in t)for(const r in t[i].inputs)Array.isArray(t[i].inputs[r])&&t[i].inputs[r].length===2&&!t[t[i].inputs[r][0]]&&delete t[i].inputs[r];return{workflow:o,output:t}}async function ae(){const e=await B.get("/api/object_info");if(e.status===200)return e.data}async function le(e){const o=await ne(e),t=await B.post("/api/workflow",{workflow:o.output});if(t.status===200)return console.log(t.data),await t.data;throw{response:await t.data}}const G=s.union([s.number().int(),s.string()]),A=s.union([s.object({0:s.number(),1:s.number()}).passthrough().transform(e=>[e[0],e[1]]),s.tuple([s.number(),s.number()])]),ue=s.object({collapsed:s.boolean().optional(),pinned:s.boolean().optional(),allow_interaction:s.boolean().optional(),horizontal:s.boolean().optional(),skip_repeated_outputs:s.boolean().optional()}).passthrough(),R=s.union([s.string(),s.array(s.string()),s.number()]),C=s.union([s.number().int(),s.string().transform(e=>parseInt(e)).refine(e=>!isNaN(e),{message:"Invalid number"})]),ce=s.object({name:s.string(),type:R,link:s.number().nullable().optional(),slot_index:C.optional()}).passthrough(),pe=s.object({name:s.string(),type:R,links:s.array(s.number()).nullable().optional(),slot_index:C.optional()}).passthrough(),de=s.object({"Node name for S&R":s.string().optional()}).passthrough(),fe=s.union([s.array(s.any()),s.record(s.any())]),ge=s.object({id:G,type:s.string(),pos:A,size:A,flags:ue,order:s.number(),mode:s.number(),inputs:s.array(ce).optional(),outputs:s.array(pe).optional(),properties:de,widgets_values:fe.optional(),color:s.string().optional(),bgcolor:s.string().optional()}).passthrough(),me=s.tuple([s.number(),G,C,G,C,R]),he=s.object({title:s.string(),bounding:s.tuple([s.number(),s.number(),s.number(),s.number()]),color:s.string().optional(),font_size:s.number().optional(),locked:s.boolean().optional()}).passthrough(),ye=s.object({links_ontop:s.boolean().optional(),align_to_grid:s.boolean().optional()}).passthrough(),we=s.object({last_node_id:s.number(),last_link_id:s.number(),nodes:s.array(ge),links:s.array(me),groups:s.array(he).optional(),config:ye.optional().nullable(),version:s.number()});function be(e){try{const o=JSON.parse(e),t=we.parse(o);return console.log("Validation successful:",t),t}catch(o){throw o instanceof s.ZodError?console.error("Validation error:",o.errors):console.error("Parsing error:",o),Error(o)}}const ve=(e,o,t)=>{var r;const i=(r=t.target.files)==null?void 0:r[0];if(i&&o){const n=new FileReader;return n.onload=g=>{var l;try{const a=(l=g.target)==null?void 0:l.result,u=be(a);console.log(u),o.clear(),o.configure(u),e&&(e.value=""),I.success("Loading Workflow Success",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}catch{I.error("Error loading workflow file. Please ensure it is a valid workflow.",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}},n.onerror=()=>{I.error("Error reading file",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})},n.readAsText(i),i.name}};function _e({graph:e,canvas:o}){const t=E.useRef(null),[i,r]=E.useState(!1),[n,g]=E.useState(!0),[l,a]=E.useState(null),[u,m]=E.useState("untitled"),p=()=>{var d;(d=t.current)==null||d.click()},c=()=>{if(e){const d=JSON.stringify(e.serialize()),h=new Blob([d],{type:"text/plain;charset=utf-8"}),O=prompt("Enter Filename : ",`workflow-${Date.now()}`);if(O===null)return;X.saveAs(h,`${O}.json`),a(e.serialize()),m(O)}},w=()=>{e&&confirm("Clear workflow?")&&(e.clear(),I.info("Workflow Cleared",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}}),m("untitled"),o.ds.offset=[0,0],o.setZoom(1,[0,0]),o.setDirty(!0,!0))},y=async()=>{try{const d=await le(e);await I.success("Send Workflow Success",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}catch(d){console.error(d),await I.error(d.response.data.error.message,{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}};return f.jsxs(f.Fragment,{children:[f.jsx(Y,{children:f.jsxs("title",{children:[n?"":"*",u+" ","- AdvFBP"]})}),f.jsxs("div",{className:"topbar",children:[f.jsxs("div",{className:"leftmenu",children:[f.jsxs("button",{className:"buttonmenu",onClick:c,children:[f.jsx("i",{className:"pi pi-save"})," Save"]}),f.jsxs("button",{className:"buttonmenu",onClick:p,children:[f.jsx("i",{className:"pi pi-upload"})," Load"]}),f.jsx("input",{type:"file",ref:t,onChange:d=>{const h=ve(t.current,e,d);h&&m(h.split(".")[0])},accept:".json",style:{display:"none"}}),f.jsxs("button",{className:"buttonmenu",onClick:w,children:[f.jsx("i",{className:"pi pi-eraser"})," Clear"]})]}),f.jsx("div",{className:"rightmenu",children:f.jsx("button",{className:"buttonmenuright",onClick:async()=>{await y()},children:i?f.jsxs("span",{children:[f.jsx("i",{className:"pi pi-stop"})," Interrupt Workflow"]}):f.jsxs("span",{children:[f.jsx("i",{className:"pi pi-play"})," Run Workflow"]})})})]})]})}const j=Symbol(),L=Symbol();function xe(e,o,t,i,r){console.log(t);const n=50;function g(a){var w,y;if(e.widgets[0].last_y==null)return;let u=e.widgets[0].last_y,m=a[1]-u,p=0;const c=[];for(let d=0;d<e.widgets.length;d++){const h=e.widgets[d];h.type==="customtext"?c.push(h):h.computeSize?p+=h.computeSize(null)[1]+4:p+=b.LiteGraph.NODE_WIDGET_HEIGHT+4}m-=p,m/=c.length+(((w=e.imgs)==null?void 0:w.length)||0),m<n&&(m=n,e.size[1]=u+p+m*(c.length+(((y=e.imgs)==null?void 0:y.length)||0)),e.graph.setDirtyCanvas(!0));for(const d of e.widgets)d.y=u,d.type==="customtext"?(u+=m,d.computedHeight=m-c.length*4):d.computeSize?u+=d.computeSize()[1]+4:u+=b.LiteGraph.NODE_WIDGET_HEIGHT+4;e.inputHeight=m}const l={type:"customtext",name:o,get value(){return this.inputEl.value},set value(a){this.inputEl.value=a},draw:function(a,u,m,p,c){this.parent.inputHeight||g(e.size);const w=r.ds.scale>.5&&this.type==="customtext",y=10,d=a.canvas.getBoundingClientRect(),h=new DOMMatrix().scaleSelf(d.width/a.canvas.width,d.height/a.canvas.height).multiplySelf(a.getTransform()).translateSelf(y,y+p),O=new DOMMatrix().scaleSelf(h.a,h.d);Object.assign(this.inputEl.style,{transformOrigin:"0 0",transform:O,left:`${h.a+h.e}px`,top:`${h.d+h.f}px`,width:`${m-y*2}px`,height:`${this.parent.inputHeight-y*2}px`,position:"absolute",background:e.color?e.color:"",color:e.color?"white":"",zIndex:i._nodes.indexOf(e)}),this.inputEl.hidden=!w}};if(l.inputEl=document.createElement("textarea"),l.inputEl.className="comfy-multiline-input",l.inputEl.value=t.defaultVal,l.inputEl.placeholder=t.placeholder||"",document.addEventListener("mousedown",function(a){l.inputEl.contains(a.target)||l.inputEl.blur()}),l.parent=e,document.body.appendChild(l.inputEl),e.addCustomWidget(l),r.onDrawBackground=function(){for(let a in i._nodes){const u=i._nodes[a];for(let m in u.widgets){let p=u.widgets[m];Object.hasOwn(p,"inputEl")&&(p.inputEl.style.left="-8000px",p.inputEl.style.position="absolute")}}},e.onRemoved=function(){for(let a in this.widgets)this.widgets[a].inputEl&&this.widgets[a].inputEl.remove()},l.onRemove=()=>{var a;(a=l.inputEl)==null||a.remove(),--e[j]||(e.onResize=e[L],delete e[j],delete e[L])},e[j])e[j]++;else{e[j]=1;const a=e[L]=e.onResize;e.onResize=function(u){g(u),a&&a.apply(this,arguments)}}return{minWidth:400,minHeight:200,widget:l}}function D(e,o){let t=e[1].default,{min:i,max:r,step:n}=e[1];return t==null&&(t=0),i==null&&(i=Number.MIN_SAFE_INTEGER),r==null&&(r=Number.MAX_SAFE_INTEGER),n==null&&(n=o),e[1].min=i,e[1].max=r,e[1].step=1*n,{val:t,config:{...e[1]}}}function q(e){return e==="slider"?"slider":"number"}function Ne(e,o,t){let i=q(t[1].display);const{val:r,config:n}=D(t,1);return Object.assign(n,{precision:0}),{widget:e.addWidget(i,o,r,function(g){const l=this.options.step/10;let a=this.options.min%l;isNaN(a)&&(a=0),this.value=Math.round((g-a)/l)*l+a},n)}}const S={FLOAT(e,o,t){let i=q(t[1].display),{val:r,config:n}=D(t,.5);return{widget:e.addWidget(i,o,r,()=>{},n)}},INT(e,o,t){return Ne(e,o,t)},BOOLEAN(e,o,t){let i=t[1].default;return{widget:e.addWidget("toggle",o,i,()=>{},{on:t[1].label_on,off:t[1].label_off})}},STRING(e,o,t,i,r){const n=t[1].defaultVal?t[1].defaultVal:"",g=!!t[1].multiline;let l;return g?l=xe(e,o,t[1],i,r):l={widget:e.addWidget("text",o,n,()=>{},{})},t[1].dynamicPrompts!=null&&(l.widget.dynamicPrompts=t[1].dynamicPrompts),l},COMBO(e,o,t){const i=t[0];let r=i[0];return t[1]&&t[1].default&&(r=t[1].default),{widget:e.addWidget("combo",o,r,()=>{},{values:i})}}};async function Ee(e,o){class t{constructor(){v(this,"properties");v(this,"serialize_widgets");v(this,"isVirtualNode");v(this,"color",b.LGraphCanvas.node_colors.yellow.color);v(this,"bgcolor",b.LGraphCanvas.node_colors.yellow.bgcolor);v(this,"groupcolor",b.LGraphCanvas.node_colors.yellow.groupcolor);this.properties||(this.properties={},this.properties.text=""),S.STRING(this,"",["",{defaultVal:this.properties.text,multiline:!0}],e,o),this.serialize_widgets=!0,this.isVirtualNode=!0}}v(t,"category"),b.LiteGraph.registerNodeType("Note",Object.assign(t,{title_mode:b.LiteGraph.NORMAL_TITLE,title:"Note",collapsable:!0})),t.category="utils"}async function Oe(e,o){await Ee(e,o)}async function ke(e,o,t){var i;for(const r in e){const n=e[r],g=(i=class extends b.LGraphNode{constructor(u){var y,d,h,O,T,W;super(u);v(this,"comfyClass",n.name);v(this,"graph",o);v(this,"canvas",t);const m=n.input.required;var p=n.input.required;n.input.optional!=null&&(p=Object.assign({},n.input.required,n.input.optional));const c={minWidth:1,minHeight:1};for(const _ in p){const k=p[_],x=k[0],P=k[1]??{},N=[x,P],U=m&&_ in m;let H=!0;(y=N[1])!=null&&y.forceInput?this.addInput(_,x):Array.isArray(x)?Object.assign(c,S.COMBO(this,_,N)||{}):`${x}:${_}`in S?Object.assign(c,S[`${x}:${_}`](this,_,N,this.graph,this.canvas)||{}):x in S?Object.assign(c,S[x](this,_,N,this.graph,this.canvas)||{}):(this.addInput(_,x),H=!1),H&&(c!=null&&c.widget)&&((d=c.widget).options??(d.options={}),U||(c.widget.options.inputIsOptional=!0),(h=N[1])!=null&&h.forceInput&&(c.widget.options.forceInput=!0),(O=N[1])!=null&&O.defaultInput&&(c.widget.options.defaultInput=!0),(T=N[1])!=null&&T.advanced&&(c.widget.advanced=!0),(W=N[1])!=null&&W.hidden&&(c.widget.hidden=!0))}for(const _ in n.output){let k=n.output[_];k instanceof Array&&(k="COMBO");const x=n.output_name[_]||k,N={shape:n.output_is_list[_]?b.LiteGraph.GRID_SHAPE:b.LiteGraph.CIRCLE_SHAPE};this.addOutput(x,k,N)}const w=this.computeSize();w[0]=Math.max(c.minWidth,w[0]*1.5),w[1]=Math.max(c.minHeight,w[1]),this.size=w,this.serialize_widgets=!0}configure(u){const m=(p,c)=>{const w={...c};if(p.widget===void 0&&c.widget!==void 0)return this.inputs.push(p),c;for(const y of["name","type","shape"])p[y]!==void 0&&(w[y]=p[y]);return w};for(const p of["inputs","outputs"]){const c=u[p]??[];u[p]=c.map((w,y)=>m(this[p][y]??{},w))}super.configure(u)}},v(i,"title",n.display_name||n.name),v(i,"nodeData",n),v(i,"category"),i);b.LiteGraph.registerNodeType(r,g),g.category=n.category}}async function Se(e,o,t){const i=new b.LGraph,r=new b.LGraphCanvas(e,i);function n(){const l=Math.max(window.devicePixelRatio,1),{width:a,height:u}=e.getBoundingClientRect();e.width=Math.round(a*l),e.height=Math.round(u*l),e.getContext("2d").scale(l,l),r.draw(!0,!0)}n(),window.addEventListener("resize",n),b.LiteGraph.release_link_on_empty_shows_menu=!0,b.LiteGraph.alt_drag_do_clone_nodes=!0,b.LiteGraph.clearRegisteredTypes();const g=await ae();await ke(g,i,r),await Oe(i,r),o(i),t(r)}function Ie({setGraph:e,setCanvas:o,canvasRef:t}){E.useEffect(()=>{t.current&&Se(t.current,e,o)},[])}function je(){const e=E.useRef(null),[o,t]=E.useState(void 0),[i,r]=E.useState(void 0);return Ie({setGraph:t,setCanvas:r,canvasRef:e}),f.jsxs(f.Fragment,{children:[f.jsx(_e,{graph:o,canvas:i}),f.jsx("canvas",{style:{position:"absolute",zIndex:0,touchAction:"none"},ref:e,id:"graph-canvas"})]})}$(document.getElementById("root")).render(f.jsxs(f.Fragment,{children:[f.jsx(je,{}),f.jsx(Q,{})]}));
