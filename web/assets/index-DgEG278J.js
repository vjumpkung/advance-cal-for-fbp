var X=Object.defineProperty;var Y=(t,i,e)=>i in t?X(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var E=(t,i,e)=>Y(t,typeof i!="symbol"?i+"":i,e);import{r as S,a as Q}from"./vendor-wpXbf5jk.js";import{B as G,Q as tt}from"./react-toastify-Df8KVf6C.js";import{F as et}from"./file-saver-B7T6XPHc.js";import{H as ot}from"./react-helmet-CuerYPg1.js";import{a as W}from"./axios-DXsv3KKR.js";import{v as it}from"./uuid-Ch9TGLTe.js";import{l as d}from"./litegraph.js-D6XMNgl8.js";import{z as l}from"./zod-DXqQCM1T.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();var P={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var st=S,nt=Symbol.for("react.element"),rt=Symbol.for("react.fragment"),at=Object.prototype.hasOwnProperty,lt=st.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ut={key:!0,ref:!0,__self:!0,__source:!0};function $(t,i,e){var o,n={},a=null,r=null;e!==void 0&&(a=""+e),i.key!==void 0&&(a=""+i.key),i.ref!==void 0&&(r=i.ref);for(o in i)at.call(i,o)&&!ut.hasOwnProperty(o)&&(n[o]=i[o]);if(t&&t.defaultProps)for(o in i=t.defaultProps,i)n[o]===void 0&&(n[o]=i[o]);return{$$typeof:nt,type:t,key:a,ref:r,props:n,_owner:lt.current}}D.Fragment=rt;D.jsx=$;D.jsxs=$;P.exports=D;var w=P.exports,q,M=Q;q=M.createRoot,M.hydrateRoot;async function ct(t){const i=t.serialize(),e={};for(const o of t.computeExecutionOrder(!1,0)){const n=i.nodes.find(p=>p.id===o.id);if(o.isVirtualNode){o.applyToGraph&&o.applyToGraph(i);continue}if(o.mode===2||o.mode===4)continue;const a={},r=o.widgets;if(r)for(const p in r){const s=r[p];(!s.options||s.options.serialize!==!1)&&(a[s.name]=s.serializeValue?await s.serializeValue(n,p):s.value)}for(let p in o.inputs){let s=o.getInputNode(p);if(s){let u=o.getInputLink(p);for(;s.mode===4||s.isVirtualNode;){let c=!1;if(s.isVirtualNode)u=s.getInputLink(u.origin_slot),u&&(s=s.getInputNode(u.target_slot),s&&(c=!0));else if(u&&s.mode===4){let g=[u.origin_slot];if(s.inputs){g=g.concat(Object.keys(s.inputs));for(let f in g)if(f=g[f],s.inputs[f].type===o.inputs[p].type){u=s.getInputLink(f),u&&(s=s.getInputNode(f)),c=!0;break}}}if(!c)break}u&&(a[o.inputs[p].name]=[String(u.origin_id),parseInt(u.origin_slot)])}}e[String(o.id)]={inputs:a,class_type:o.comfyClass}}for(const o in e)for(const n in e[o].inputs)Array.isArray(e[o].inputs[n])&&e[o].inputs[n].length===2&&!e[e[o].inputs[n][0]]&&delete e[o].inputs[n];return{workflow:i,output:e}}const U=it().toString().replace(/-/gi,"");class pt{constructor(){E(this,"currentExecutingNode",null);E(this,"lastErrorNode",null);E(this,"errorNode",null)}}const I=new pt;function dt(){const t=d.LGraphCanvas.prototype.drawNode,i=d.LGraphCanvas.prototype.drawNodeShape;d.LGraphCanvas.prototype.drawNodeShape=function(e,o,n,a,r,p,s){var _;const u=i.apply(this,arguments),c=(_=I.errorNode)==null?void 0:_[e.id.toString()];let g=null,f=1;if(e.id===+I.currentExecutingNode?g="#0f0":c!=null&&c.errors?(g="red",f=2):I.lastErrorNode&&+I.lastErrorNode.node_id===e.id&&(g="#f0f",f=2),g){const y=e._shape||e.shape||d.LiteGraph.ROUND_SHAPE;o.lineWidth=f,o.globalAlpha=.8,o.beginPath(),y==d.LiteGraph.BOX_SHAPE?o.rect(-6,-6-d.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+d.LiteGraph.NODE_TITLE_HEIGHT):y==d.LiteGraph.ROUND_SHAPE||y==d.LiteGraph.CARD_SHAPE&&e.flags.collapsed?o.roundRect(-6,-6-d.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+d.LiteGraph.NODE_TITLE_HEIGHT,this.round_radius*2):y==d.LiteGraph.CARD_SHAPE?o.roundRect(-6,-6-d.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+d.LiteGraph.NODE_TITLE_HEIGHT,[this.round_radius*2,this.round_radius*2,2,2]):y==d.LiteGraph.CIRCLE_SHAPE&&o.arc(n[0]*.5,n[1]*.5,n[0]*.5+6,0,Math.PI*2),o.strokeStyle=g,o.stroke(),o.strokeStyle=a,o.globalAlpha=1}if(c){o.lineWidth=2,o.strokeStyle="red";for(const y of c.errors)if(y.extra_info&&y.extra_info.input_name){const h=e.findInputSlot(y.extra_info.input_name);if(h!==-1){let b=e.getConnectionPos(!0,h);o.beginPath(),o.arc(b[0]-e.pos[0],b[1]-e.pos[1],12,0,2*Math.PI,!1),o.stroke()}}}return u},d.LGraphCanvas.prototype.drawNode=function(e,o){var n=this.editor_alpha,a=e.bgcolor;e.mode===2&&(this.editor_alpha=.4),e.mode===4&&(e.bgcolor="#FF00FF",this.editor_alpha=.2);const r=t.apply(this,arguments);return this.editor_alpha=n,e.bgcolor=a,r}}async function ft(){const t=await W.get("/api/object_info");if(t.status===200)return t.data}async function ht(t){I.errorNode=null;const i=await ct(t),e=await W.post("/api/workflow",{workflow:i.output,client_id:U});if(e.status===200)return await e.data;throw{response:await e.data}}async function gt(t){const i=new WebSocket(`/ws?clientId=${U}`);return i.binaryType="arraybuffer",i.addEventListener("open",()=>{console.log("WebSocket Open")}),i.addEventListener("error",()=>{console.log("WebSocket Error")}),i.addEventListener("close",()=>{console.log("Reconnect!")}),i.addEventListener("message",e=>{try{const o=JSON.parse(e.data);switch(o.type){case"status":dispatchEvent(new CustomEvent("status",{detail:o.data.status}));break;case"progress":dispatchEvent(new CustomEvent("progress",{detail:o.data}));break;case"executing":dispatchEvent(new CustomEvent("executing",{detail:o.data.node}));break;case"progress":case"executed":case"execution_start":case"execution_success":case"execution_error":case"execution_cached":case"logs":dispatchEvent(new CustomEvent(o.type,{detail:o.data}));break}}catch(o){console.warn("Unhandled message:",e.data,o)}}),i}const H=l.union([l.number().int(),l.string()]),B=l.union([l.object({0:l.number(),1:l.number()}).passthrough().transform(t=>[t[0],t[1]]),l.tuple([l.number(),l.number()])]),_t=l.object({collapsed:l.boolean().optional(),pinned:l.boolean().optional(),allow_interaction:l.boolean().optional(),horizontal:l.boolean().optional(),skip_repeated_outputs:l.boolean().optional()}).passthrough(),F=l.union([l.string(),l.array(l.string()),l.number()]),j=l.union([l.number().int(),l.string().transform(t=>parseInt(t)).refine(t=>!isNaN(t),{message:"Invalid number"})]),yt=l.object({name:l.string(),type:F,link:l.number().nullable().optional(),slot_index:j.optional()}).passthrough(),mt=l.object({name:l.string(),type:F,links:l.array(l.number()).nullable().optional(),slot_index:j.optional()}).passthrough(),wt=l.object({"Node name for S&R":l.string().optional()}).passthrough(),bt=l.union([l.array(l.any()),l.record(l.any())]),Et=l.object({id:H,type:l.string(),pos:B,size:B,flags:_t,order:l.number(),mode:l.number(),inputs:l.array(yt).optional(),outputs:l.array(mt).optional(),properties:wt,widgets_values:bt.optional(),color:l.string().optional(),bgcolor:l.string().optional()}).passthrough(),vt=l.tuple([l.number(),H,j,H,j,F]),Nt=l.object({title:l.string(),bounding:l.tuple([l.number(),l.number(),l.number(),l.number()]),color:l.string().optional(),font_size:l.number().optional(),locked:l.boolean().optional()}).passthrough(),Lt=l.object({links_ontop:l.boolean().optional(),align_to_grid:l.boolean().optional()}).passthrough(),xt=l.object({last_node_id:l.number(),last_link_id:l.number(),nodes:l.array(Et),links:l.array(vt),groups:l.array(Nt).optional(),config:Lt.optional().nullable(),version:l.number()});function kt(t){try{const i=JSON.parse(t);return xt.parse(i)}catch(i){throw i instanceof l.ZodError?console.error("Validation error:",i.errors):console.error("Parsing error:",i),Error(i)}}const It=(t,i,e)=>{var n;const o=(n=e.target.files)==null?void 0:n[0];if(o&&i){const a=new FileReader;return a.onload=r=>{var p;try{const s=(p=r.target)==null?void 0:p.result,u=kt(s);i.clear(),i.configure(u),t&&(t.value=""),G.success("Loading Workflow Success")}catch{G.error("Error loading workflow file. Please ensure it is a valid workflow.")}},a.onerror=()=>{G.error("Error reading file")},a.readAsText(o),o.name}};function Ot({graph:t,canvas:i}){const e=S.useRef(null),[o,n]=S.useState(!1),[a,r]=S.useState(!0),[p,s]=S.useState(null),[u,c]=S.useState("untitled"),g=()=>{var h;(h=e.current)==null||h.click()},f=()=>{if(t){const h=JSON.stringify(t.serialize()),b=new Blob([h],{type:"text/plain;charset=utf-8"}),k=prompt("Enter Filename : ",`workflow-${Date.now()}`);if(k===null)return;et.saveAs(b,`${k}.json`),s(t.serialize()),c(k)}},_=()=>{t&&confirm("Clear workflow?")&&(t.clear(),G.info("Workflow Cleared"),c("untitled"),i.ds.offset=[0,0],i.setZoom(1,[0,0]),i.setDirty(!0,!0))},y=async()=>{try{const h=await ht(t);t.start()}catch(h){console.error(h),I.errorNode=h.response.data.node_errors,console.log(I.errorNode),await G.error(h.response.data.error.message)}};return w.jsxs(w.Fragment,{children:[w.jsx(ot,{children:w.jsxs("title",{children:[a?"":"*",u+" ","- AdvFBP"]})}),w.jsxs("div",{className:"topbar",children:[w.jsxs("div",{className:"leftmenu",children:[w.jsxs("button",{className:"buttonmenu",onClick:f,children:[w.jsx("i",{className:"pi pi-save"})," Save"]}),w.jsxs("button",{className:"buttonmenu",onClick:g,children:[w.jsx("i",{className:"pi pi-upload"})," Load"]}),w.jsx("input",{type:"file",ref:e,onChange:h=>{const b=It(e.current,t,h);b&&c(b.split(".")[0])},accept:".json",style:{display:"none"}}),w.jsxs("button",{className:"buttonmenu",onClick:_,children:[w.jsx("i",{className:"pi pi-eraser"})," Clear"]})]}),w.jsx("div",{className:"rightmenu",children:w.jsx("button",{className:"buttonmenuright",onClick:async()=>{await y()},children:o?w.jsxs("span",{children:[w.jsx("i",{className:"pi pi-stop"})," Interrupt Workflow"]}):w.jsxs("span",{children:[w.jsx("i",{className:"pi pi-play"})," Run Workflow"]})})})]})]})}const R=Symbol(),A=Symbol();function St(t,i,e,o,n){function r(s){var _,y;if(t.widgets[0].last_y==null)return;let u=t.widgets[0].last_y,c=s[1]-u,g=0;const f=[];for(let h=0;h<t.widgets.length;h++){const b=t.widgets[h];b.type==="customtext"?f.push(b):b.computeSize?g+=b.computeSize(null)[1]+4:g+=d.LiteGraph.NODE_WIDGET_HEIGHT+4}c-=g,c/=f.length+(((_=t.imgs)==null?void 0:_.length)||0),c<50&&(c=50,t.size[1]=u+g+c*(f.length+(((y=t.imgs)==null?void 0:y.length)||0)),t.graph.setDirtyCanvas(!0));for(const h of t.widgets)h.y=u,h.type==="customtext"?(u+=c,h.computedHeight=c-f.length*4):h.computeSize?u+=h.computeSize()[1]+4:u+=d.LiteGraph.NODE_WIDGET_HEIGHT+4;t.inputHeight=c}const p={type:"customtext",name:i,get value(){return this.inputEl.value},set value(s){this.inputEl.value=s},draw:function(s,u,c,g,f){this.parent.inputHeight||r(t.size);const _=n.ds.scale>.5&&this.type==="customtext",y=10,h=s.canvas.getBoundingClientRect(),b=new DOMMatrix().scaleSelf(h.width/s.canvas.width,h.height/s.canvas.height).multiplySelf(s.getTransform()).translateSelf(y,y+g),k=new DOMMatrix().scaleSelf(b.a,b.d);Object.assign(this.inputEl.style,{transformOrigin:"0 0",transform:k,left:`${b.a+b.e}px`,top:`${b.d+b.f}px`,width:`${c-y*2}px`,height:`${this.parent.inputHeight-y*2}px`,position:"absolute",background:t.color?t.color:"",color:t.color?"white":"",zIndex:o._nodes.indexOf(t)}),this.inputEl.hidden=!_}};if(p.inputEl=document.createElement("textarea"),p.inputEl.className="comfy-multiline-input",p.inputEl.value=e.defaultVal,p.inputEl.placeholder=e.placeholder||"",document.addEventListener("mousedown",function(s){p.inputEl.contains(s.target)||p.inputEl.blur()}),p.parent=t,document.body.appendChild(p.inputEl),t.addCustomWidget(p),n.onDrawBackground=function(){for(let s in o._nodes){const u=o._nodes[s];for(let c in u.widgets){let g=u.widgets[c];Object.hasOwn(g,"inputEl")&&(g.inputEl.style.left="-8000px",g.inputEl.style.position="absolute")}}},t.onRemoved=function(){for(let s in this.widgets)this.widgets[s].inputEl&&this.widgets[s].inputEl.remove()},p.onRemove=()=>{var s;(s=p.inputEl)==null||s.remove(),--t[R]||(t.onResize=t[A],delete t[R],delete t[A])},t[R])t[R]++;else{t[R]=1;const s=t[A]=t.onResize;t.onResize=function(u){r(u),s&&s.apply(this,arguments)}}return{minWidth:400,minHeight:200,widget:p}}function Z(t,i){let e=t[1].default,{min:o,max:n,step:a}=t[1];return e==null&&(e=0),o==null&&(o=Number.MIN_SAFE_INTEGER),n==null&&(n=Number.MAX_SAFE_INTEGER),a==null&&(a=i),t[1].min=o,t[1].max=n,t[1].step=1*a,{val:e,config:{...t[1]}}}function J(t){return t==="slider"?"slider":"number"}function Tt(t,i,e){let o=J(e[1].display);const{val:n,config:a}=Z(e,1);return Object.assign(a,{precision:0}),{widget:t.addWidget(o,i,n,function(r){const p=this.options.step/10;let s=this.options.min%p;isNaN(s)&&(s=0),this.value=Math.round((r-s)/p)*p+s},a)}}const T={FLOAT(t,i,e){let o=J(e[1].display),{val:n,config:a}=Z(e,.5);return{widget:t.addWidget(o,i,n,()=>{},a)}},INT(t,i,e){return Tt(t,i,e)},BOOLEAN(t,i,e){let o=e[1].default;return{widget:t.addWidget("toggle",i,o,()=>{},{on:e[1].label_on,off:e[1].label_off})}},STRING(t,i,e,o,n){const a=e[1].defaultVal?e[1].defaultVal:"",r=!!e[1].multiline;let p;return r?p=St(t,i,e[1],o,n):p={widget:t.addWidget("text",i,a,()=>{},{})},e[1].dynamicPrompts!=null&&(p.widget.dynamicPrompts=e[1].dynamicPrompts),p},COMBO(t,i,e){const o=e[0];let n=o[0];return e[1]&&e[1].default&&(n=e[1].default),{widget:t.addWidget("combo",i,n,()=>{},{values:o})}},SELECTFILE(t,i,e,o,n){let a;const r=document.createElement("input");return Object.assign(r,{type:"file",style:"display: none",onchange:async()=>{if(r.files.length){const p=r.files[0],s=new FormData;s.append("file",p);const u=await W.post("/api/upload/file",s);t.widgets[0].value=u.data.path}}}),document.body.append(r),a=t.addWidget("button","Select File","file",()=>{r.click()}),t.onRemoved=function(){r.remove()},a.serialize=!1,{widget:a}}};async function Gt(t,i){class e{constructor(){E(this,"properties");E(this,"serialize_widgets");E(this,"isVirtualNode");E(this,"color",d.LGraphCanvas.node_colors.yellow.color);E(this,"bgcolor",d.LGraphCanvas.node_colors.yellow.bgcolor);E(this,"groupcolor",d.LGraphCanvas.node_colors.yellow.groupcolor);this.properties||(this.properties={},this.properties.text=""),T.STRING(this,"",["",{defaultVal:this.properties.text,multiline:!0}],t,i),this.serialize_widgets=!0,this.isVirtualNode=!0}}E(e,"category"),d.LiteGraph.registerNodeType("Note",Object.assign(e,{title_mode:d.LiteGraph.NORMAL_TITLE,title:"Note",collapsable:!0})),e.category="utils"}async function Ct(t,i){const o=class o{constructor(){E(this,"size");E(this,"__outputType");E(this,"inputs");E(this,"outputs");E(this,"isVirtualNode");E(this,"horizontal");E(this,"properties");this.properties||(this.properties={}),this.properties.showOutputText=o.defaultVisibility,this.properties.horizontal=!1;const a=this;a.addInput("","*"),a.addOutput(this.properties.showOutputText?"*":"","*"),a.onConnectionsChange=function(r,p,s,u){var C;if(this.applyOrientation(),s&&r===d.LiteGraph.OUTPUT&&new Set(this.outputs[0].links.map(L=>t.links[L].type).filter(L=>L!=="*")).size>1){const L=[];for(let m=0;m<this.outputs[0].links.length-1;m++){const N=this.outputs[0].links[m],x=t.links[N];L.push(x)}for(const m of L)t.getNodeById(m.target_id).disconnectInput(m.target_slot)}let c=this,g=[],f=null,_=null;for(;c;){g.unshift(c);const v=c.inputs[0].link;if(v!==null){const L=t.links[v],m=t.getNodeById(L.origin_id);if(m.constructor.type==="Reroute")m===this?(c.disconnectInput(L.target_slot),c=null):c=m;else{_=c,f=((C=m.outputs[L.origin_slot])==null?void 0:C.type)??null;break}}else{c=null;break}}const y=[this];let h=null;for(;y.length;){c=y.pop();const v=(c.outputs?c.outputs[0].links:[])||[];if(v.length)for(const L of v){const m=t.links[L];if(!m)continue;const N=t.getNodeById(m.target_id);if(N.constructor.type==="Reroute")y.push(N),g.push(N);else{const z=N.inputs&&N.inputs[m==null?void 0:m.target_slot]&&N.inputs[m.target_slot].type?N.inputs[m.target_slot].type:null;f&&z!==f?N.disconnectInput(m.target_slot):h=z}}}const b=f||h||"*",k=d.LGraphCanvas.link_type_colors[b];for(const v of g){v.outputs[0].type=f||"*",v.__outputType=b,v.outputs[0].name=v.properties.showOutputText?b:"",v.size=v.computeSize(),v.applyOrientation();for(const L of v.outputs[0].links||[]){const m=t.links[L];m&&(m.color=k)}}if(_){const v=t.links[_.inputs[0].link];v&&(v.color=k)}},this.clone=function(){const r=o.prototype.clone.apply(this);return r.removeOutput(0),r.addOutput(this.properties.showOutputText?"*":"","*"),r.size=r.computeSize(),r},this.isVirtualNode=!0}getExtraMenuOptions(a,r){r.unshift({content:(this.properties.showOutputText?"Hide":"Show")+" Type",callback:()=>{this.properties.showOutputText=!this.properties.showOutputText,this.properties.showOutputText?this.outputs[0].name=this.__outputType||this.outputs[0].type:this.outputs[0].name="",this.size=this.computeSize(),this.applyOrientation(),t.setDirtyCanvas(!0,!0)}},{content:(o.defaultVisibility?"Hide":"Show")+" Type By Default",callback:()=>{o.setDefaultTextVisibility(!o.defaultVisibility)}},{content:"Set "+(this.properties.horizontal?"Horizontal":"Vertical"),callback:()=>{this.properties.horizontal=!this.properties.horizontal,this.applyOrientation()}})}applyOrientation(){this.horizontal=this.properties.horizontal,this.horizontal?this.inputs[0].pos=[this.size[0]/2,0]:delete this.inputs[0].pos,t.setDirtyCanvas(!0,!0)}computeSize(){return[this.properties.showOutputText&&this.outputs&&this.outputs.length?Math.max(75,d.LiteGraph.NODE_TEXT_SIZE*this.outputs[0].name.length*.6+40):75,26]}clone(){}static setDefaultTextVisibility(a){o.defaultVisibility=a,a?localStorage["Comfy.RerouteNode.DefaultVisibility"]="true":delete localStorage["Comfy.RerouteNode.DefaultVisibility"]}};E(o,"category"),E(o,"defaultVisibility");let e=o;e.setDefaultTextVisibility(!!localStorage["Comfy.RerouteNode.DefaultVisibility"]),d.LiteGraph.registerNodeType("Reroute",Object.assign(e,{title_mode:d.LiteGraph.NO_TITLE,title:"Reroute",collapsable:!1})),e.category="utils"}const zt={dark:{id:"dark",name:"Dark (Default)",colors:{node_slot:{INT:"#FFD500",FLOAT:"#A8DADC",STRING:"#ad7452",COMBO:"#FFA931",NDARRAY:"#6EE7B7"}}}};async function Rt(t,i,e){const o=s=>Object.keys(s).sort().reduce((u,c)=>(u[c]=s[c],u),{});function n(){var s=[];const u=t;for(const g in u){const f=u[g];var c=f.input.required;f.input.optional!==void 0&&(c=Object.assign({},f.input.required,f.input.optional));for(const _ in c){const h=c[_][0];Array.isArray(h)||s.push(h)}for(const _ in f.output){const y=f.output[_];s.push(y)}}return s}function a(s){var u=n();for(const c of u)s.colors.node_slot[c]||(s.colors.node_slot[c]="");return s.colors.node_slot=o(s.colors.node_slot),s}const r=async s=>{if(s=await a(s),s.colors){if(s.colors.node_slot&&(Object.assign(e.default_connection_color_byType,s.colors.node_slot),Object.assign(d.LGraphCanvas.link_type_colors,s.colors.node_slot)),s.colors.litegraph_base){e.node_title_color=s.colors.litegraph_base.NODE_TITLE_COLOR,e.default_link_color=s.colors.litegraph_base.LINK_COLOR;for(const u in s.colors.litegraph_base)s.colors.litegraph_base.hasOwnProperty(u)&&d.LiteGraph.hasOwnProperty(u)&&(d.LiteGraph[u]=s.colors.litegraph_base[u])}e.draw(!0,!0)}};let p=zt.dark;await r(p)}function jt(){d.LiteGraph.search_filter_enabled=!0,d.LiteGraph.middle_click_slot_add_default_node=!0}async function Dt(t,i,e){var u;var o=i.name;const n=(u=i.input)==null?void 0:u.required;for(const c in n){var a=n[c];if(typeof a[0]!="string")continue;var r=a[0];if(r in T){var p=a[1];if(!(p!=null&&p.forceInput))continue}if(r in e.slot_types_default_out||(e.slot_types_default_out[r]=["Reroute"]),e.slot_types_default_out[r].includes(o))continue;e.slot_types_default_out[r].push(o);const g=r.toLocaleLowerCase();g in d.LiteGraph.registered_slot_in_types||(d.LiteGraph.registered_slot_in_types[g]={nodes:[]}),d.LiteGraph.registered_slot_in_types[g].nodes.push(t.comfyClass)}var s=i.output;for(const c in s){var r=s[c];r in e.slot_types_default_in||(e.slot_types_default_in[r]=["Reroute"]),e.slot_types_default_in[r].push(o),r in d.LiteGraph.registered_slot_out_types||(d.LiteGraph.registered_slot_out_types[r]={nodes:[]}),d.LiteGraph.registered_slot_out_types[r].nodes.push(t.comfyClass),d.LiteGraph.slot_types_out.includes(r)||d.LiteGraph.slot_types_out.push(r)}d.LiteGraph.slot_types_default_out={},d.LiteGraph.slot_types_default_in={};for(const c in e.slot_types_default_out)d.LiteGraph.slot_types_default_out[c]=e.slot_types_default_out[c].slice(0,5);for(const c in e.slot_types_default_in)d.LiteGraph.slot_types_default_in[c]=e.slot_types_default_in[c].slice(0,5)}async function At(t,i,e){await Gt(i,e),await Ct(i),await Rt(t,i,e)}async function Ht(t,i,e){await jt()}async function Wt(t){var i,e,o,n;((n=(o=(e=(i=t==null?void 0:t.input)==null?void 0:i.required)==null?void 0:e.path)==null?void 0:o[1])==null?void 0:n.select_file_path)===!0&&(t.input.required.selectfile=["SELECTFILE"])}async function Ft(t,i,e,o){if(i.name==="ShowText"){let n=function(a){var r,p;if(this.widgets){const s=this.widgets.findIndex(u=>u.name==="text");if(s!==-1){for(let u=s;u<this.widgets.length;u++)(p=(r=this.widgets[u]).onRemove)==null||p.call(r);this.widgets.length=s}}for(const s of a){const u=T.STRING(this,"text",["STRING",{multiline:!0}],e,o).widget;u.inputEl.readOnly=!0,u.inputEl.style.opacity=1,u.value=s}requestAnimationFrame(()=>{var u;const s=this.computeSize();s[0]<this.size[0]&&(s[0]=this.size[0]),s[1]<this.size[1]&&(s[1]=this.size[1]),(u=this.onResize)==null||u.call(this,s),e.setDirtyCanvas(!0,!1)})};t.onExecuted,t.prototype.onExecuted=function(a){n.call(this,a.text)}}}async function Vt(t,i,e){var n;const o={slot_types_default_out:{},slot_types_default_in:{}};for(const a in t){const r=t[a];await Wt(r);const p=(n=class extends d.LGraphNode{constructor(c){var h,b,k,C,v,L;super(c);E(this,"comfyClass",r.name);E(this,"graph",i);E(this,"canvas",e);const g=r.input.required;var f=r.input.required;r.input.optional!=null&&(f=Object.assign({},r.input.required,r.input.optional));const _={minWidth:1,minHeight:1};for(const m in f){const N=f[m],x=N[0],z=N[1]??{},O=[x,z],K=g&&m in g;let V=!0;(h=O[1])!=null&&h.forceInput?this.addInput(m,x):Array.isArray(x)?Object.assign(_,T.COMBO(this,m,O)||{}):`${x}:${m}`in T?Object.assign(_,T[`${x}:${m}`](this,m,O,this.graph,this.canvas)||{}):x in T?Object.assign(_,T[x](this,m,O,this.graph,this.canvas)||{}):(this.addInput(m,x),V=!1),V&&(_!=null&&_.widget)&&((b=_.widget).options??(b.options={}),K||(_.widget.options.inputIsOptional=!0),(k=O[1])!=null&&k.forceInput&&(_.widget.options.forceInput=!0),(C=O[1])!=null&&C.defaultInput&&(_.widget.options.defaultInput=!0),(v=O[1])!=null&&v.advanced&&(_.widget.advanced=!0),(L=O[1])!=null&&L.hidden&&(_.widget.hidden=!0))}for(const m in r.output){let N=r.output[m];N instanceof Array&&(N="COMBO");const x=r.output_name[m]||N,O={shape:r.output_is_list[m]?d.LiteGraph.GRID_SHAPE:d.LiteGraph.CIRCLE_SHAPE};this.addOutput(x,N,O)}const y=this.computeSize();y[0]=Math.max(_.minWidth,y[0]*1.5),y[1]=Math.max(_.minHeight,y[1]),this.size=y,this.serialize_widgets=!0}configure(c){const g=(f,_)=>{const y={..._};if(f.widget===void 0&&_.widget!==void 0)return this.inputs.push(f),_;for(const h of["name","type","shape"])f[h]!==void 0&&(y[h]=f[h]);return y};for(const f of["inputs","outputs"]){const _=c[f]??[];c[f]=_.map((y,h)=>g(this[f][h]??{},y))}super.configure(c)}},E(n,"title",r.display_name||r.name),E(n,"nodeData",r),E(n,"category"),n);await Ft(p,r,i,e),await Dt(p,r,o),d.LiteGraph.registerNodeType(a,p),p.category=r.category}}function Mt(t){if(t==null)return"(unknown error)";const i=t.traceback.join("");return t.node_id,`Error occurred when executing ${t.node_type}:

${t.exception_message}

${i}`}function Bt(t,i){window.addEventListener("status",({detail:e})=>{console.log("status",e)}),window.addEventListener("reconnecting",()=>{console.log("Reconnecting...")}),window.addEventListener("progress",({detail:e})=>{i.setDirtyCanvas(!0,!1)}),window.addEventListener("executing",({detail:e})=>{I.currentExecutingNode=e,i.setDirtyCanvas(!0,!1)}),window.addEventListener("executed",({detail:e})=>{I.currentExecutingNode=null;const o=i.getNodeById(e.node);o&&o.onExecuted&&o.onExecuted(e.output)}),window.addEventListener("execution_start",({detail:e})=>{I.lastErrorNode=null,G.info("Workflow Start")}),window.addEventListener("execution_success",({detail:e})=>{G.info("Workflow Execution Success"),i.stop()}),window.addEventListener("execution_error",({detail:e})=>{const o=Mt(e);I.lastErrorNode=e,G.error("Workflow Error!"),i.stop(),console.error(o)})}async function Pt(t,i,e){const o=new d.LGraph,n=new d.LGraphCanvas(t,o);o.start();function a(){const p=Math.max(window.devicePixelRatio,1),{width:s,height:u}=t.getBoundingClientRect();t.width=Math.round(s*p),t.height=Math.round(u*p),t.getContext("2d").scale(p,p),n.draw(!0,!0)}a(),window.addEventListener("resize",a),d.LiteGraph.release_link_on_empty_shows_menu=!0,d.LiteGraph.alt_drag_do_clone_nodes=!0,d.LiteGraph.clearRegisteredTypes();const r=await ft();await Ht(),await Vt(r,o,n),await At(r,o,n),await gt(),Bt(n,o),dt(),i(o),e(n)}function $t({setGraph:t,setCanvas:i,canvasRef:e}){S.useEffect(()=>{e.current&&Pt(e.current,t,i)},[])}function qt(){const t=S.useRef(null),[i,e]=S.useState(void 0),[o,n]=S.useState(void 0);return $t({setGraph:e,setCanvas:n,canvasRef:t}),w.jsxs(w.Fragment,{children:[w.jsx(Ot,{graph:i,canvas:o}),w.jsx("canvas",{style:{position:"absolute",zIndex:0,touchAction:"none"},ref:t,id:"graph-canvas"})]})}q(document.getElementById("root")).render(w.jsxs(w.Fragment,{children:[w.jsx(qt,{}),w.jsx(tt,{style:{marginTop:"1.25em"},position:"top-right",autoClose:5e3,pauseOnHover:!1,draggable:!1,hideProgressBar:!0,theme:"colored"})]}));
