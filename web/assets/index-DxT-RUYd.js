var J=Object.defineProperty;var Z=(e,o,t)=>o in e?J(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var v=(e,o,t)=>Z(e,typeof o!="symbol"?o+"":o,t);import{r as N,a as K}from"./vendor-wpXbf5jk.js";import{B as j,Q}from"./react-toastify-Df8KVf6C.js";import{F as X}from"./file-saver-B7T6XPHc.js";import{H as Y}from"./react-helmet-CuerYPg1.js";import{z as s}from"./zod-DXqQCM1T.js";import{a as B}from"./axios-DXsv3KKR.js";import{l as _}from"./litegraph.js-CsUhbCts.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const g of r.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();var V={exports:{}},z={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee=N,te=Symbol.for("react.element"),oe=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,se=ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,re={key:!0,ref:!0,__self:!0,__source:!0};function F(e,o,t){var i,n={},r=null,g=null;t!==void 0&&(r=""+t),o.key!==void 0&&(r=""+o.key),o.ref!==void 0&&(g=o.ref);for(i in o)ie.call(o,i)&&!re.hasOwnProperty(i)&&(n[i]=o[i]);if(e&&e.defaultProps)for(i in o=e.defaultProps,o)n[i]===void 0&&(n[i]=o[i]);return{$$typeof:te,type:e,key:r,ref:g,props:n,_owner:se.current}}z.Fragment=oe;z.jsx=F;z.jsxs=F;V.exports=z;var f=V.exports,$,M=K;$=M.createRoot,M.hydrateRoot;const T=s.union([s.number().int(),s.string()]),A=s.union([s.object({0:s.number(),1:s.number()}).passthrough().transform(e=>[e[0],e[1]]),s.tuple([s.number(),s.number()])]),ne=s.object({collapsed:s.boolean().optional(),pinned:s.boolean().optional(),allow_interaction:s.boolean().optional(),horizontal:s.boolean().optional(),skip_repeated_outputs:s.boolean().optional()}).passthrough(),G=s.union([s.string(),s.array(s.string()),s.number()]),C=s.union([s.number().int(),s.string().transform(e=>parseInt(e)).refine(e=>!isNaN(e),{message:"Invalid number"})]),ae=s.object({name:s.string(),type:G,link:s.number().nullable().optional(),slot_index:C.optional()}).passthrough(),le=s.object({name:s.string(),type:G,links:s.array(s.number()).nullable().optional(),slot_index:C.optional()}).passthrough(),ue=s.object({"Node name for S&R":s.string().optional()}).passthrough(),ce=s.union([s.array(s.any()),s.record(s.any())]),pe=s.object({id:T,type:s.string(),pos:A,size:A,flags:ne,order:s.number(),mode:s.number(),inputs:s.array(ae).optional(),outputs:s.array(le).optional(),properties:ue,widgets_values:ce.optional(),color:s.string().optional(),bgcolor:s.string().optional()}).passthrough(),de=s.tuple([s.number(),T,C,T,C,G]),fe=s.object({title:s.string(),bounding:s.tuple([s.number(),s.number(),s.number(),s.number()]),color:s.string().optional(),font_size:s.number().optional(),locked:s.boolean().optional()}).passthrough(),ge=s.object({links_ontop:s.boolean().optional(),align_to_grid:s.boolean().optional()}).passthrough(),me=s.object({last_node_id:s.number(),last_link_id:s.number(),nodes:s.array(pe),links:s.array(de),groups:s.array(fe).optional(),config:ge.optional().nullable(),version:s.number()});function he(e){try{const o=JSON.parse(e),t=me.parse(o);return console.log("Validation successful:",t),t}catch(o){throw o instanceof s.ZodError?console.error("Validation error:",o.errors):console.error("Parsing error:",o),Error(o)}}const ye=(e,o,t)=>{var n;const i=(n=t.target.files)==null?void 0:n[0];if(i&&o){const r=new FileReader;return r.onload=g=>{var l;try{const a=(l=g.target)==null?void 0:l.result,u=he(a);console.log(u),o.clear(),o.configure(u),e&&(e.value=""),j.success("Loading Workflow Success",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}catch{j.error("Error loading workflow file. Please ensure it is a valid workflow.",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}},r.onerror=()=>{j.error("Error reading file",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})},r.readAsText(i),i.name}};async function we(e){const o=e.serialize(),t={};for(const i of e.computeExecutionOrder(!1,0)){const n=o.nodes.find(l=>l.id===i.id);if(i.isVirtualNode){i.applyToGraph&&i.applyToGraph(o);continue}if(i.mode===2||i.mode===4)continue;const r={},g=i.widgets;if(g)for(const l in g){const a=g[l];(!a.options||a.options.serialize!==!1)&&(r[a.name]=a.serializeValue?await a.serializeValue(n,l):a.value)}for(let l in i.inputs){let a=i.getInputNode(l);if(a){let u=i.getInputLink(l);for(;a.mode===4||a.isVirtualNode;){let m=!1;if(a.isVirtualNode)u=a.getInputLink(u.origin_slot),u&&(a=a.getInputNode(u.target_slot),a&&(m=!0));else if(u&&a.mode===4){let p=[u.origin_slot];if(a.inputs){p=p.concat(Object.keys(a.inputs));for(let c in p)if(c=p[c],a.inputs[c].type===i.inputs[l].type){u=a.getInputLink(c),u&&(a=a.getInputNode(c)),m=!0;break}}}if(!m)break}u&&(r[i.inputs[l].name]=[String(u.origin_id),parseInt(u.origin_slot)])}}t[String(i.id)]={inputs:r,class_type:i.comfyClass}}for(const i in t)for(const n in t[i].inputs)Array.isArray(t[i].inputs[n])&&t[i].inputs[n].length===2&&!t[t[i].inputs[n][0]]&&delete t[i].inputs[n];return{workflow:o,output:t}}async function be(){const e=await B.get("/api/object_info");if(e.status===200)return e.data}async function ve(e){const o=await we(e),t=await B.post("/api/workflow",{workflow:o.output});if(t.status===200)return console.log(t.data),await t.data;throw{response:await t.data}}function _e({graph:e,canvas:o}){const t=N.useRef(null),[i,n]=N.useState(!1),[r,g]=N.useState(!0),[l,a]=N.useState(null),[u,m]=N.useState("untitled"),p=()=>{var d;(d=t.current)==null||d.click()},c=()=>{if(e){const d=JSON.stringify(e.serialize()),h=new Blob([d],{type:"text/plain;charset=utf-8"}),E=prompt("Enter Filename : ",`workflow-${Date.now()}`);if(E===null)return;X.saveAs(h,`${E}.json`),a(e.serialize()),m(E)}},w=()=>{e&&confirm("Clear workflow?")&&(e.clear(),j.info("Workflow Cleared",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}}),m("untitled"),o.ds.offset=[0,0],o.setZoom(1,[0,0]),o.setDirty(!0,!0))},y=async()=>{try{const d=await ve(e);await j.success("Send Workflow Success",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}catch(d){console.error(d),await j.error(d.response.data.error.message,{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}};return f.jsxs(f.Fragment,{children:[f.jsx(Y,{children:f.jsxs("title",{children:[r?"":"*",u+" ","- AdvFBP"]})}),f.jsxs("div",{className:"topbar",children:[f.jsxs("div",{className:"leftmenu",children:[f.jsxs("button",{className:"buttonmenu",onClick:c,children:[f.jsx("i",{className:"pi pi-save"})," Save"]}),f.jsxs("button",{className:"buttonmenu",onClick:p,children:[f.jsx("i",{className:"pi pi-upload"})," Load"]}),f.jsx("input",{type:"file",ref:t,onChange:d=>{const h=ye(t.current,e,d);h&&m(h.split(".")[0])},accept:".json",style:{display:"none"}}),f.jsxs("button",{className:"buttonmenu",onClick:w,children:[f.jsx("i",{className:"pi pi-eraser"})," Clear"]})]}),f.jsx("div",{className:"rightmenu",children:f.jsx("button",{className:"buttonmenuright",onClick:async()=>{await y()},children:i?f.jsxs("span",{children:[f.jsx("i",{className:"pi pi-stop"})," Interrupt Workflow"]}):f.jsxs("span",{children:[f.jsx("i",{className:"pi pi-play"})," Run Workflow"]})})})]})]})}const I=Symbol(),R=Symbol();function xe(e,o,t,i,n){console.log(t);const r=50;function g(a){var w,y;if(e.widgets[0].last_y==null)return;let u=e.widgets[0].last_y,m=a[1]-u,p=0;const c=[];for(let d=0;d<e.widgets.length;d++){const h=e.widgets[d];h.type==="customtext"?c.push(h):h.computeSize?p+=h.computeSize(null)[1]+4:p+=_.LiteGraph.NODE_WIDGET_HEIGHT+4}m-=p,m/=c.length+(((w=e.imgs)==null?void 0:w.length)||0),m<r&&(m=r,e.size[1]=u+p+m*(c.length+(((y=e.imgs)==null?void 0:y.length)||0)),e.graph.setDirtyCanvas(!0));for(const d of e.widgets)d.y=u,d.type==="customtext"?(u+=m,d.computedHeight=m-c.length*4):d.computeSize?u+=d.computeSize()[1]+4:u+=_.LiteGraph.NODE_WIDGET_HEIGHT+4;e.inputHeight=m}const l={type:"customtext",name:o,get value(){return this.inputEl.value},set value(a){this.inputEl.value=a},draw:function(a,u,m,p,c){this.parent.inputHeight||g(e.size);const w=n.ds.scale>.5&&this.type==="customtext",y=10,d=a.canvas.getBoundingClientRect(),h=new DOMMatrix().scaleSelf(d.width/a.canvas.width,d.height/a.canvas.height).multiplySelf(a.getTransform()).translateSelf(y,y+p),E=new DOMMatrix().scaleSelf(h.a,h.d);Object.assign(this.inputEl.style,{transformOrigin:"0 0",transform:E,left:`${h.a+h.e}px`,top:`${h.d+h.f}px`,width:`${m-y*2}px`,height:`${this.parent.inputHeight-y*2}px`,position:"absolute",background:e.color?e.color:"",color:e.color?"white":"",zIndex:i._nodes.indexOf(e)}),this.inputEl.hidden=!w}};if(l.inputEl=document.createElement("textarea"),l.inputEl.className="comfy-multiline-input",l.inputEl.value=t.defaultVal,l.inputEl.placeholder=t.placeholder||"",document.addEventListener("mousedown",function(a){l.inputEl.contains(a.target)||l.inputEl.blur()}),l.parent=e,document.body.appendChild(l.inputEl),e.addCustomWidget(l),n.onDrawBackground=function(){for(let a in i._nodes){const u=i._nodes[a];for(let m in u.widgets){let p=u.widgets[m];Object.hasOwn(p,"inputEl")&&(p.inputEl.style.left="-8000px",p.inputEl.style.position="absolute")}}},e.onRemoved=function(){for(let a in this.widgets)this.widgets[a].inputEl&&this.widgets[a].inputEl.remove()},l.onRemove=()=>{var a;(a=l.inputEl)==null||a.remove(),--e[I]||(e.onResize=e[R],delete e[I],delete e[R])},e[I])e[I]++;else{e[I]=1;const a=e[R]=e.onResize;e.onResize=function(u){g(u),a&&a.apply(this,arguments)}}return{minWidth:400,minHeight:200,widget:l}}function D(e,o){let t=e[1].default,{min:i,max:n,step:r}=e[1];return t==null&&(t=0),i==null&&(i=Number.MIN_SAFE_INTEGER),n==null&&(n=Number.MAX_SAFE_INTEGER),r==null&&(r=o),e[1].min=i,e[1].max=n,e[1].step=1*r,{val:t,config:{...e[1]}}}function q(e){return e==="slider"?"slider":"number"}function Ne(e,o,t){let i=q(t[1].display);const{val:n,config:r}=D(t,1);return Object.assign(r,{precision:0}),{widget:e.addWidget(i,o,n,function(g){const l=this.options.step/10;let a=this.options.min%l;isNaN(a)&&(a=0),this.value=Math.round((g-a)/l)*l+a},r)}}const S={FLOAT(e,o,t){let i=q(t[1].display),{val:n,config:r}=D(t,.5);return{widget:e.addWidget(i,o,n,()=>{},r)}},INT(e,o,t){return Ne(e,o,t)},BOOLEAN(e,o,t){let i=t[1].default;return{widget:e.addWidget("toggle",o,i,()=>{},{on:t[1].label_on,off:t[1].label_off})}},STRING(e,o,t,i,n){const r=t[1].defaultVal?t[1].defaultVal:"",g=!!t[1].multiline;let l;return g?l=xe(e,o,t[1],i,n):l={widget:e.addWidget("text",o,r,()=>{},{})},t[1].dynamicPrompts!=null&&(l.widget.dynamicPrompts=t[1].dynamicPrompts),l},COMBO(e,o,t){const i=t[0];let n=i[0];return t[1]&&t[1].default&&(n=t[1].default),{widget:e.addWidget("combo",o,n,()=>{},{values:i})}}};async function Ee(e,o,t){var i;for(const n in e){const r=e[n],g=(i=class extends _.LGraphNode{constructor(u){var y,d,h,E,W,P;super(u);v(this,"comfyClass",r.name);v(this,"graph",o);v(this,"canvas",t);const m=r.input.required;var p=r.input.required;r.input.optional!=null&&(p=Object.assign({},r.input.required,r.input.optional));const c={minWidth:1,minHeight:1};for(const b in p){const k=p[b],x=k[0],L=k[1]??{},O=[x,L],U=m&&b in m;let H=!0;(y=O[1])!=null&&y.forceInput?this.addInput(b,x):Array.isArray(x)?Object.assign(c,S.COMBO(this,b,O)||{}):`${x}:${b}`in S?Object.assign(c,S[`${x}:${b}`](this,b,O,this.graph,this.canvas)||{}):x in S?Object.assign(c,S[x](this,b,O,this.graph,this.canvas)||{}):(this.addInput(b,x),H=!1),H&&(c!=null&&c.widget)&&((d=c.widget).options??(d.options={}),U||(c.widget.options.inputIsOptional=!0),(h=O[1])!=null&&h.forceInput&&(c.widget.options.forceInput=!0),(E=O[1])!=null&&E.defaultInput&&(c.widget.options.defaultInput=!0),(W=O[1])!=null&&W.advanced&&(c.widget.advanced=!0),(P=O[1])!=null&&P.hidden&&(c.widget.hidden=!0))}for(const b in r.output){let k=r.output[b];k instanceof Array&&(k="COMBO");const x=r.output_name[b]||k;r.output_is_list[b];const L={shape:r.output_is_list[b]?_.LiteGraph.GRID_SHAPE:_.LiteGraph.CIRCLE_SHAPE};this.addOutput(x,k,L)}const w=this.computeSize();w[0]=Math.max(c.minWidth,w[0]*1.5),w[1]=Math.max(c.minHeight,w[1]),this.size=w,this.serialize_widgets=!0}configure(u){const m=(p,c)=>{const w={...c};if(p.widget===void 0&&c.widget!==void 0)return this.inputs.push(p),c;for(const y of["name","type","shape"])p[y]!==void 0&&(w[y]=p[y]);return w};for(const p of["inputs","outputs"]){const c=u[p]??[];u[p]=c.map((w,y)=>m(this[p][y]??{},w))}super.configure(u)}},v(i,"title",r.display_name||r.name),v(i,"nodeData",r),v(i,"category"),i);_.LiteGraph.registerNodeType(n,g),g.category=r.category}}async function Oe(e,o){class t{constructor(){v(this,"properties");v(this,"serialize_widgets");v(this,"isVirtualNode");v(this,"color",_.LGraphCanvas.node_colors.yellow.color);v(this,"bgcolor",_.LGraphCanvas.node_colors.yellow.bgcolor);v(this,"groupcolor",_.LGraphCanvas.node_colors.yellow.groupcolor);this.properties||(this.properties={},this.properties.text=""),S.STRING(this,"",["",{defaultVal:this.properties.text,multiline:!0}],e,o),this.serialize_widgets=!0,this.isVirtualNode=!0}}v(t,"category"),_.LiteGraph.registerNodeType("Note",Object.assign(t,{title_mode:_.LiteGraph.NORMAL_TITLE,title:"Note",collapsable:!0})),t.category="utils"}async function ke(e,o){await Oe(e,o)}async function Se(e,o,t){const i=new _.LGraph,n=new _.LGraphCanvas(e,i);function r(){const l=Math.max(window.devicePixelRatio,1),{width:a,height:u}=e.getBoundingClientRect();e.width=Math.round(a*l),e.height=Math.round(u*l),e.getContext("2d").scale(l,l),n.draw(!0,!0)}r(),window.addEventListener("resize",r),o(i),t(n),_.LiteGraph.clearRegisteredTypes();const g=await be();await Ee(g,i,n),await ke(i,n)}function je({setGraph:e,setCanvas:o,canvasRef:t}){N.useEffect(()=>{t.current&&Se(t.current,e,o)},[])}function Ie(){const e=N.useRef(null),[o,t]=N.useState(void 0),[i,n]=N.useState(void 0);return je({setGraph:t,setCanvas:n,canvasRef:e}),f.jsxs(f.Fragment,{children:[f.jsx(_e,{graph:o,canvas:i}),f.jsx("canvas",{style:{position:"absolute",zIndex:0},ref:e,id:"graph-canvas"})]})}$(document.getElementById("root")).render(f.jsxs(f.Fragment,{children:[f.jsx(Ie,{}),f.jsx(Q,{})]}));
