var X=Object.defineProperty;var Y=(t,i,e)=>i in t?X(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var b=(t,i,e)=>Y(t,typeof i!="symbol"?i+"":i,e);import{r as S,a as Q}from"./vendor-wpXbf5jk.js";import{B as G,Q as tt}from"./react-toastify-Df8KVf6C.js";import{F as et}from"./file-saver-B7T6XPHc.js";import{H as ot}from"./react-helmet-CuerYPg1.js";import{a as W}from"./axios-DXsv3KKR.js";import{v as it}from"./uuid-Ch9TGLTe.js";import{l as d}from"./litegraph.js-D6XMNgl8.js";import{z as a}from"./zod-DXqQCM1T.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=e(n);fetch(n.href,l)}})();var P={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var st=S,nt=Symbol.for("react.element"),rt=Symbol.for("react.fragment"),at=Object.prototype.hasOwnProperty,lt=st.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ut={key:!0,ref:!0,__self:!0,__source:!0};function $(t,i,e){var o,n={},l=null,r=null;e!==void 0&&(l=""+e),i.key!==void 0&&(l=""+i.key),i.ref!==void 0&&(r=i.ref);for(o in i)at.call(i,o)&&!ut.hasOwnProperty(o)&&(n[o]=i[o]);if(t&&t.defaultProps)for(o in i=t.defaultProps,i)n[o]===void 0&&(n[o]=i[o]);return{$$typeof:nt,type:t,key:l,ref:r,props:n,_owner:lt.current}}D.Fragment=rt;D.jsx=$;D.jsxs=$;P.exports=D;var w=P.exports,q,M=Q;q=M.createRoot,M.hydrateRoot;async function ct(t){const i=t.serialize(),e={};for(const o of t.computeExecutionOrder(!1,0)){const n=i.nodes.find(p=>p.id===o.id);if(o.isVirtualNode){o.applyToGraph&&o.applyToGraph(i);continue}if(o.mode===2||o.mode===4)continue;const l={},r=o.widgets;if(r)for(const p in r){const s=r[p];(!s.options||s.options.serialize!==!1)&&(l[s.name]=s.serializeValue?await s.serializeValue(n,p):s.value)}for(let p in o.inputs){let s=o.getInputNode(p);if(s){let c=o.getInputLink(p);for(;s.mode===4||s.isVirtualNode;){let u=!1;if(s.isVirtualNode)c=s.getInputLink(c.origin_slot),c&&(s=s.getInputNode(c.target_slot),s&&(u=!0));else if(c&&s.mode===4){let g=[c.origin_slot];if(s.inputs){g=g.concat(Object.keys(s.inputs));for(let f in g)if(f=g[f],s.inputs[f].type===o.inputs[p].type){c=s.getInputLink(f),c&&(s=s.getInputNode(f)),u=!0;break}}}if(!u)break}c&&(l[o.inputs[p].name]=[String(c.origin_id),parseInt(c.origin_slot)])}}e[String(o.id)]={inputs:l,class_type:o.comfyClass}}for(const o in e)for(const n in e[o].inputs)Array.isArray(e[o].inputs[n])&&e[o].inputs[n].length===2&&!e[e[o].inputs[n][0]]&&delete e[o].inputs[n];return{workflow:i,output:e}}const U=it().toString().replace(/-/gi,"");class pt{constructor(){b(this,"currentExecutingNode",null);b(this,"lastErrorNode",null);b(this,"errorNode",null)}}const L=new pt;function dt(){const t=d.LGraphCanvas.prototype.drawNode,i=d.LGraphCanvas.prototype.drawNodeShape;d.LGraphCanvas.prototype.drawNodeShape=function(e,o,n,l,r,p,s){var _;const c=i.apply(this,arguments),u=(_=L.errorNode)==null?void 0:_[e.id.toString()];let g=null,f=1;if(e.id===+L.currentExecutingNode?g="#0f0":u!=null&&u.errors?(g="red",f=2):L.lastErrorNode&&+L.lastErrorNode.node_id===e.id&&(g="#f0f",f=2),g){const y=e._shape||e.shape||d.LiteGraph.ROUND_SHAPE;o.lineWidth=f,o.globalAlpha=.8,o.beginPath(),y==d.LiteGraph.BOX_SHAPE?o.rect(-6,-6-d.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+d.LiteGraph.NODE_TITLE_HEIGHT):y==d.LiteGraph.ROUND_SHAPE||y==d.LiteGraph.CARD_SHAPE&&e.flags.collapsed?o.roundRect(-6,-6-d.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+d.LiteGraph.NODE_TITLE_HEIGHT,this.round_radius*2):y==d.LiteGraph.CARD_SHAPE?o.roundRect(-6,-6-d.LiteGraph.NODE_TITLE_HEIGHT,12+n[0]+1,12+n[1]+d.LiteGraph.NODE_TITLE_HEIGHT,[this.round_radius*2,this.round_radius*2,2,2]):y==d.LiteGraph.CIRCLE_SHAPE&&o.arc(n[0]*.5,n[1]*.5,n[0]*.5+6,0,Math.PI*2),o.strokeStyle=g,o.stroke(),o.strokeStyle=l,o.globalAlpha=1}if(u){o.lineWidth=2,o.strokeStyle="red";for(const y of u.errors)if(y.extra_info&&y.extra_info.input_name){const h=e.findInputSlot(y.extra_info.input_name);if(h!==-1){let E=e.getConnectionPos(!0,h);o.beginPath(),o.arc(E[0]-e.pos[0],E[1]-e.pos[1],12,0,2*Math.PI,!1),o.stroke()}}}return c},d.LGraphCanvas.prototype.drawNode=function(e,o){var n=this.editor_alpha,l=e.bgcolor;e.mode===2&&(this.editor_alpha=.4),e.mode===4&&(e.bgcolor="#FF00FF",this.editor_alpha=.2);const r=t.apply(this,arguments);return this.editor_alpha=n,e.bgcolor=l,r}}async function ft(){const t=await W.get("/api/object_info");if(t.status===200)return t.data}async function ht(t){L.errorNode=null;const i=await ct(t),e=await W.post("/api/workflow",{workflow:i.output,client_id:U});if(e.status===200)return await e.data;throw{response:await e.data}}async function gt(t){const i=new WebSocket(`/ws?clientId=${U}`);return i.binaryType="arraybuffer",i.addEventListener("open",()=>{console.log("WebSocket Open")}),i.addEventListener("error",()=>{console.log("WebSocket Error")}),i.addEventListener("close",()=>{console.log("Reconnect!")}),i.addEventListener("message",e=>{try{const o=JSON.parse(e.data);switch(o.type){case"status":dispatchEvent(new CustomEvent("status",{detail:o.data.status}));break;case"progress":dispatchEvent(new CustomEvent("progress",{detail:o.data}));break;case"executing":dispatchEvent(new CustomEvent("executing",{detail:o.data.node}));break;case"progress":case"executed":case"execution_start":case"execution_success":case"execution_error":case"execution_cached":case"logs":dispatchEvent(new CustomEvent(o.type,{detail:o.data}));break}}catch(o){console.warn("Unhandled message:",e.data,o)}}),i}const H=a.union([a.number().int(),a.string()]),B=a.union([a.object({0:a.number(),1:a.number()}).passthrough().transform(t=>[t[0],t[1]]),a.tuple([a.number(),a.number()])]),_t=a.object({collapsed:a.boolean().optional(),pinned:a.boolean().optional(),allow_interaction:a.boolean().optional(),horizontal:a.boolean().optional(),skip_repeated_outputs:a.boolean().optional()}).passthrough(),F=a.union([a.string(),a.array(a.string()),a.number()]),j=a.union([a.number().int(),a.string().transform(t=>parseInt(t)).refine(t=>!isNaN(t),{message:"Invalid number"})]),yt=a.object({name:a.string(),type:F,link:a.number().nullable().optional(),slot_index:j.optional()}).passthrough(),mt=a.object({name:a.string(),type:F,links:a.array(a.number()).nullable().optional(),slot_index:j.optional()}).passthrough(),wt=a.object({"Node name for S&R":a.string().optional()}).passthrough(),Et=a.union([a.array(a.any()),a.record(a.any())]),bt=a.object({id:H,type:a.string(),pos:B,size:B,flags:_t,order:a.number(),mode:a.number(),inputs:a.array(yt).optional(),outputs:a.array(mt).optional(),properties:wt,widgets_values:Et.optional(),color:a.string().optional(),bgcolor:a.string().optional()}).passthrough(),Nt=a.tuple([a.number(),H,j,H,j,F]),vt=a.object({title:a.string(),bounding:a.tuple([a.number(),a.number(),a.number(),a.number()]),color:a.string().optional(),font_size:a.number().optional(),locked:a.boolean().optional()}).passthrough(),Lt=a.object({links_ontop:a.boolean().optional(),align_to_grid:a.boolean().optional()}).passthrough(),xt=a.object({last_node_id:a.number(),last_link_id:a.number(),nodes:a.array(bt),links:a.array(Nt),groups:a.array(vt).optional(),config:Lt.optional().nullable(),version:a.number()});function kt(t){try{const i=JSON.parse(t);return xt.parse(i)}catch(i){throw i instanceof a.ZodError?console.error("Validation error:",i.errors):console.error("Parsing error:",i),Error(i)}}const It=(t,i,e,o)=>{var l;const n=(l=o.target.files)==null?void 0:l[0];if(n&&i){L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null;const r=new FileReader;return r.onload=p=>{var s;try{const c=(s=p.target)==null?void 0:s.result,u=kt(c);i.clear(),i.configure(u),t&&(t.value=""),e.ds.offset=[0,0],e.setZoom(1,[0,0]),e.setDirty(!0,!0),G.success("Loading Workflow Success")}catch{G.error("Error loading workflow file. Please ensure it is a valid workflow.")}},r.onerror=()=>{G.error("Error reading file")},r.readAsText(n),n.name}};function Ot({graph:t,canvas:i}){const e=S.useRef(null),[o,n]=S.useState(!1),[l,r]=S.useState(!0),[p,s]=S.useState(null),[c,u]=S.useState("untitled"),g=()=>{var h;(h=e.current)==null||h.click()},f=()=>{if(t){const h=JSON.stringify(t.serialize()),E=new Blob([h],{type:"text/plain;charset=utf-8"}),I=prompt("Enter Filename : ",`workflow-${Date.now()}`);if(I===null)return;et.saveAs(E,`${I}.json`),s(t.serialize()),u(I)}},_=()=>{t&&confirm("Clear workflow?")&&(L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null,t.clear(),G.info("Workflow Cleared"),u("untitled"),i.ds.offset=[0,0],i.setZoom(1,[0,0]),i.setDirty(!0,!0))},y=async()=>{try{L.currentExecutingNode=null,L.errorNode=null,L.lastErrorNode=null;const h=await ht(t);t.start()}catch(h){console.error(h),L.errorNode=h.response.data.node_errors,console.log(L.errorNode),await G.error(h.response.data.error.message)}};return w.jsxs(w.Fragment,{children:[w.jsx(ot,{children:w.jsxs("title",{children:[l?"":"*",c+" ","- AdvFBP"]})}),w.jsxs("div",{className:"topbar",children:[w.jsxs("div",{className:"leftmenu",children:[w.jsxs("button",{className:"buttonmenu",onClick:f,children:[w.jsx("i",{className:"pi pi-save"})," Save"]}),w.jsxs("button",{className:"buttonmenu",onClick:g,children:[w.jsx("i",{className:"pi pi-upload"})," Load"]}),w.jsx("input",{type:"file",ref:e,onChange:h=>{const E=It(e.current,t,i,h);E&&u(E.split(".")[0])},accept:".json",style:{display:"none"}}),w.jsxs("button",{className:"buttonmenu",onClick:_,children:[w.jsx("i",{className:"pi pi-eraser"})," Clear"]})]}),w.jsx("div",{className:"rightmenu",children:w.jsx("button",{className:"buttonmenuright",onClick:async()=>{await y()},children:o?w.jsxs("span",{children:[w.jsx("i",{className:"pi pi-stop"})," Interrupt Workflow"]}):w.jsxs("span",{children:[w.jsx("i",{className:"pi pi-play"})," Run Workflow"]})})})]})]})}const R=Symbol(),A=Symbol();function St(t,i,e,o,n){function r(s){var _,y;if(t.widgets[0].last_y==null)return;let c=t.widgets[0].last_y,u=s[1]-c,g=0;const f=[];for(let h=0;h<t.widgets.length;h++){const E=t.widgets[h];E.type==="customtext"?f.push(E):E.computeSize?g+=E.computeSize(null)[1]+4:g+=d.LiteGraph.NODE_WIDGET_HEIGHT+4}u-=g,u/=f.length+(((_=t.imgs)==null?void 0:_.length)||0),u<50&&(u=50,t.size[1]=c+g+u*(f.length+(((y=t.imgs)==null?void 0:y.length)||0)),t.graph.setDirtyCanvas(!0));for(const h of t.widgets)h.y=c,h.type==="customtext"?(c+=u,h.computedHeight=u-f.length*4):h.computeSize?c+=h.computeSize()[1]+4:c+=d.LiteGraph.NODE_WIDGET_HEIGHT+4;t.inputHeight=u}const p={type:"customtext",name:i,get value(){return this.inputEl.value},set value(s){this.inputEl.value=s},draw:function(s,c,u,g,f){this.parent.inputHeight||r(t.size);const _=n.ds.scale>.5&&this.type==="customtext",y=10,h=s.canvas.getBoundingClientRect(),E=new DOMMatrix().scaleSelf(h.width/s.canvas.width,h.height/s.canvas.height).multiplySelf(s.getTransform()).translateSelf(y,y+g),I=new DOMMatrix().scaleSelf(E.a,E.d);Object.assign(this.inputEl.style,{transformOrigin:"0 0",transform:I,left:`${E.a+E.e}px`,top:`${E.d+E.f}px`,width:`${u-y*2}px`,height:`${this.parent.inputHeight-y*2}px`,position:"absolute",background:t.color?t.color:"",color:t.color?"white":"",zIndex:o._nodes.indexOf(t)}),this.inputEl.hidden=!_}};if(p.inputEl=document.createElement("textarea"),p.inputEl.className="comfy-multiline-input",p.inputEl.value=e.defaultVal,p.inputEl.placeholder=e.placeholder||"",document.addEventListener("mousedown",function(s){p.inputEl.contains(s.target)||p.inputEl.blur()}),p.parent=t,document.body.appendChild(p.inputEl),t.addCustomWidget(p),n.onDrawBackground=function(){for(let s in o._nodes){const c=o._nodes[s];for(let u in c.widgets){let g=c.widgets[u];Object.hasOwn(g,"inputEl")&&(g.inputEl.style.left="-8000px",g.inputEl.style.position="absolute")}}},t.onRemoved=function(){for(let s in this.widgets)this.widgets[s].inputEl&&this.widgets[s].inputEl.remove()},p.onRemove=()=>{var s;(s=p.inputEl)==null||s.remove(),--t[R]||(t.onResize=t[A],delete t[R],delete t[A])},t[R])t[R]++;else{t[R]=1;const s=t[A]=t.onResize;t.onResize=function(c){r(c),s&&s.apply(this,arguments)}}return{minWidth:400,minHeight:200,widget:p}}function Z(t,i){let e=t[1].default,{min:o,max:n,step:l}=t[1];return e==null&&(e=0),o==null&&(o=Number.MIN_SAFE_INTEGER),n==null&&(n=Number.MAX_SAFE_INTEGER),l==null&&(l=i),t[1].min=o,t[1].max=n,t[1].step=1*l,{val:e,config:{...t[1]}}}function J(t){return t==="slider"?"slider":"number"}function Tt(t,i,e){let o=J(e[1].display);const{val:n,config:l}=Z(e,1);return Object.assign(l,{precision:0}),{widget:t.addWidget(o,i,n,function(r){const p=this.options.step/10;let s=this.options.min%p;isNaN(s)&&(s=0),this.value=Math.round((r-s)/p)*p+s},l)}}const T={FLOAT(t,i,e){let o=J(e[1].display),{val:n,config:l}=Z(e,.5);return{widget:t.addWidget(o,i,n,()=>{},l)}},INT(t,i,e){return Tt(t,i,e)},BOOLEAN(t,i,e){let o=e[1].default;return{widget:t.addWidget("toggle",i,o,()=>{},{on:e[1].label_on,off:e[1].label_off})}},STRING(t,i,e,o,n){const l=e[1].defaultVal?e[1].defaultVal:"",r=!!e[1].multiline;let p;return r?p=St(t,i,e[1],o,n):p={widget:t.addWidget("text",i,l,()=>{},{})},e[1].dynamicPrompts!=null&&(p.widget.dynamicPrompts=e[1].dynamicPrompts),p},COMBO(t,i,e){const o=e[0];let n=o[0];return e[1]&&e[1].default&&(n=e[1].default),{widget:t.addWidget("combo",i,n,()=>{},{values:o})}},SELECTFILE(t,i,e,o,n){let l;const r=document.createElement("input");return Object.assign(r,{type:"file",style:"display: none",onchange:async()=>{if(r.files.length){const p=r.files[0],s=new FormData;s.append("file",p);const c=await W.post("/api/upload/file",s);t.widgets[0].value=c.data.path}}}),document.body.append(r),l=t.addWidget("button","Select File","file",()=>{r.click()}),t.onRemoved=function(){r.remove()},l.serialize=!1,{widget:l}}};async function Gt(t,i){class e{constructor(){b(this,"properties");b(this,"serialize_widgets");b(this,"isVirtualNode");b(this,"color",d.LGraphCanvas.node_colors.yellow.color);b(this,"bgcolor",d.LGraphCanvas.node_colors.yellow.bgcolor);b(this,"groupcolor",d.LGraphCanvas.node_colors.yellow.groupcolor);this.properties||(this.properties={},this.properties.text=""),T.STRING(this,"",["",{defaultVal:this.properties.text,multiline:!0}],t,i),this.serialize_widgets=!0,this.isVirtualNode=!0}}b(e,"category"),d.LiteGraph.registerNodeType("Note",Object.assign(e,{title_mode:d.LiteGraph.NORMAL_TITLE,title:"Note",collapsable:!0})),e.category="utils"}async function Ct(t,i){const o=class o{constructor(){b(this,"size");b(this,"__outputType");b(this,"inputs");b(this,"outputs");b(this,"isVirtualNode");b(this,"horizontal");b(this,"properties");this.properties||(this.properties={}),this.properties.showOutputText=o.defaultVisibility,this.properties.horizontal=!1;const l=this;l.addInput("","*"),l.addOutput(this.properties.showOutputText?"*":"","*"),l.onConnectionsChange=function(r,p,s,c){var C;if(this.applyOrientation(),s&&r===d.LiteGraph.OUTPUT&&new Set(this.outputs[0].links.map(x=>t.links[x].type).filter(x=>x!=="*")).size>1){const x=[];for(let m=0;m<this.outputs[0].links.length-1;m++){const v=this.outputs[0].links[m],k=t.links[v];x.push(k)}for(const m of x)t.getNodeById(m.target_id).disconnectInput(m.target_slot)}let u=this,g=[],f=null,_=null;for(;u;){g.unshift(u);const N=u.inputs[0].link;if(N!==null){const x=t.links[N],m=t.getNodeById(x.origin_id);if(m.constructor.type==="Reroute")m===this?(u.disconnectInput(x.target_slot),u=null):u=m;else{_=u,f=((C=m.outputs[x.origin_slot])==null?void 0:C.type)??null;break}}else{u=null;break}}const y=[this];let h=null;for(;y.length;){u=y.pop();const N=(u.outputs?u.outputs[0].links:[])||[];if(N.length)for(const x of N){const m=t.links[x];if(!m)continue;const v=t.getNodeById(m.target_id);if(v.constructor.type==="Reroute")y.push(v),g.push(v);else{const z=v.inputs&&v.inputs[m==null?void 0:m.target_slot]&&v.inputs[m.target_slot].type?v.inputs[m.target_slot].type:null;f&&z!==f?v.disconnectInput(m.target_slot):h=z}}}const E=f||h||"*",I=d.LGraphCanvas.link_type_colors[E];for(const N of g){N.outputs[0].type=f||"*",N.__outputType=E,N.outputs[0].name=N.properties.showOutputText?E:"",N.size=N.computeSize(),N.applyOrientation();for(const x of N.outputs[0].links||[]){const m=t.links[x];m&&(m.color=I)}}if(_){const N=t.links[_.inputs[0].link];N&&(N.color=I)}},this.clone=function(){const r=o.prototype.clone.apply(this);return r.removeOutput(0),r.addOutput(this.properties.showOutputText?"*":"","*"),r.size=r.computeSize(),r},this.isVirtualNode=!0}getExtraMenuOptions(l,r){r.unshift({content:(this.properties.showOutputText?"Hide":"Show")+" Type",callback:()=>{this.properties.showOutputText=!this.properties.showOutputText,this.properties.showOutputText?this.outputs[0].name=this.__outputType||this.outputs[0].type:this.outputs[0].name="",this.size=this.computeSize(),this.applyOrientation(),t.setDirtyCanvas(!0,!0)}},{content:(o.defaultVisibility?"Hide":"Show")+" Type By Default",callback:()=>{o.setDefaultTextVisibility(!o.defaultVisibility)}},{content:"Set "+(this.properties.horizontal?"Horizontal":"Vertical"),callback:()=>{this.properties.horizontal=!this.properties.horizontal,this.applyOrientation()}})}applyOrientation(){this.horizontal=this.properties.horizontal,this.horizontal?this.inputs[0].pos=[this.size[0]/2,0]:delete this.inputs[0].pos,t.setDirtyCanvas(!0,!0)}computeSize(){return[this.properties.showOutputText&&this.outputs&&this.outputs.length?Math.max(75,d.LiteGraph.NODE_TEXT_SIZE*this.outputs[0].name.length*.6+40):75,26]}clone(){}static setDefaultTextVisibility(l){o.defaultVisibility=l,l?localStorage["Comfy.RerouteNode.DefaultVisibility"]="true":delete localStorage["Comfy.RerouteNode.DefaultVisibility"]}};b(o,"category"),b(o,"defaultVisibility");let e=o;e.setDefaultTextVisibility(!!localStorage["Comfy.RerouteNode.DefaultVisibility"]),d.LiteGraph.registerNodeType("Reroute",Object.assign(e,{title_mode:d.LiteGraph.NO_TITLE,title:"Reroute",collapsable:!1})),e.category="utils"}const zt={dark:{id:"dark",name:"Dark (Default)",colors:{node_slot:{INT:"#FFD500",FLOAT:"#A8DADC",STRING:"#ad7452",COMBO:"#FFA931",NDARRAY:"#6EE7B7"}}}};async function Rt(t,i,e){const o=s=>Object.keys(s).sort().reduce((c,u)=>(c[u]=s[u],c),{});function n(){var s=[];const c=t;for(const g in c){const f=c[g];var u=f.input.required;f.input.optional!==void 0&&(u=Object.assign({},f.input.required,f.input.optional));for(const _ in u){const h=u[_][0];Array.isArray(h)||s.push(h)}for(const _ in f.output){const y=f.output[_];s.push(y)}}return s}function l(s){var c=n();for(const u of c)s.colors.node_slot[u]||(s.colors.node_slot[u]="");return s.colors.node_slot=o(s.colors.node_slot),s}const r=async s=>{if(s=await l(s),s.colors){if(s.colors.node_slot&&(Object.assign(e.default_connection_color_byType,s.colors.node_slot),Object.assign(d.LGraphCanvas.link_type_colors,s.colors.node_slot)),s.colors.litegraph_base){e.node_title_color=s.colors.litegraph_base.NODE_TITLE_COLOR,e.default_link_color=s.colors.litegraph_base.LINK_COLOR;for(const c in s.colors.litegraph_base)s.colors.litegraph_base.hasOwnProperty(c)&&d.LiteGraph.hasOwnProperty(c)&&(d.LiteGraph[c]=s.colors.litegraph_base[c])}e.draw(!0,!0)}};let p=zt.dark;await r(p)}function jt(){d.LiteGraph.search_filter_enabled=!0,d.LiteGraph.middle_click_slot_add_default_node=!0}async function Dt(t,i,e){var c;var o=i.name;const n=(c=i.input)==null?void 0:c.required;for(const u in n){var l=n[u];if(typeof l[0]!="string")continue;var r=l[0];if(r in T){var p=l[1];if(!(p!=null&&p.forceInput))continue}if(r in e.slot_types_default_out||(e.slot_types_default_out[r]=["Reroute"]),e.slot_types_default_out[r].includes(o))continue;e.slot_types_default_out[r].push(o);const g=r.toLocaleLowerCase();g in d.LiteGraph.registered_slot_in_types||(d.LiteGraph.registered_slot_in_types[g]={nodes:[]}),d.LiteGraph.registered_slot_in_types[g].nodes.push(t.comfyClass)}var s=i.output;for(const u in s){var r=s[u];r in e.slot_types_default_in||(e.slot_types_default_in[r]=["Reroute"]),e.slot_types_default_in[r].push(o),r in d.LiteGraph.registered_slot_out_types||(d.LiteGraph.registered_slot_out_types[r]={nodes:[]}),d.LiteGraph.registered_slot_out_types[r].nodes.push(t.comfyClass),d.LiteGraph.slot_types_out.includes(r)||d.LiteGraph.slot_types_out.push(r)}d.LiteGraph.slot_types_default_out={},d.LiteGraph.slot_types_default_in={};for(const u in e.slot_types_default_out)d.LiteGraph.slot_types_default_out[u]=e.slot_types_default_out[u].slice(0,5);for(const u in e.slot_types_default_in)d.LiteGraph.slot_types_default_in[u]=e.slot_types_default_in[u].slice(0,5)}async function At(t,i,e){await Gt(i,e),await Ct(i),await Rt(t,i,e)}async function Ht(t,i,e){await jt()}async function Wt(t){var i,e,o,n;((n=(o=(e=(i=t==null?void 0:t.input)==null?void 0:i.required)==null?void 0:e.path)==null?void 0:o[1])==null?void 0:n.select_file_path)===!0&&(t.input.required.selectfile=["SELECTFILE"])}async function Ft(t,i,e,o){if(i.name==="ShowText"){let n=function(l){var r,p;if(this.widgets){const s=this.widgets.findIndex(c=>c.name==="text");if(s!==-1){for(let c=s;c<this.widgets.length;c++)(p=(r=this.widgets[c]).onRemove)==null||p.call(r);this.widgets.length=s}}for(const s of l){const c=T.STRING(this,"text",["STRING",{multiline:!0}],e,o).widget;c.inputEl.readOnly=!0,c.inputEl.style.opacity=1,c.value=s}requestAnimationFrame(()=>{var c;const s=this.computeSize();s[0]<this.size[0]&&(s[0]=this.size[0]),s[1]<this.size[1]&&(s[1]=this.size[1]),(c=this.onResize)==null||c.call(this,s),e.setDirtyCanvas(!0,!1)})};t.onExecuted,t.prototype.onExecuted=function(l){n.call(this,l.text)}}}async function Vt(t,i,e){var n;const o={slot_types_default_out:{},slot_types_default_in:{}};for(const l in t){const r=t[l];await Wt(r);const p=(n=class extends d.LGraphNode{constructor(u){var h,E,I,C,N,x;super(u);b(this,"comfyClass",r.name);b(this,"graph",i);b(this,"canvas",e);const g=r.input.required;var f=r.input.required;r.input.optional!=null&&(f=Object.assign({},r.input.required,r.input.optional));const _={minWidth:1,minHeight:1};for(const m in f){const v=f[m],k=v[0],z=v[1]??{},O=[k,z],K=g&&m in g;let V=!0;(h=O[1])!=null&&h.forceInput?this.addInput(m,k):Array.isArray(k)?Object.assign(_,T.COMBO(this,m,O)||{}):`${k}:${m}`in T?Object.assign(_,T[`${k}:${m}`](this,m,O,this.graph,this.canvas)||{}):k in T?Object.assign(_,T[k](this,m,O,this.graph,this.canvas)||{}):(this.addInput(m,k),V=!1),V&&(_!=null&&_.widget)&&((E=_.widget).options??(E.options={}),K||(_.widget.options.inputIsOptional=!0),(I=O[1])!=null&&I.forceInput&&(_.widget.options.forceInput=!0),(C=O[1])!=null&&C.defaultInput&&(_.widget.options.defaultInput=!0),(N=O[1])!=null&&N.advanced&&(_.widget.advanced=!0),(x=O[1])!=null&&x.hidden&&(_.widget.hidden=!0))}for(const m in r.output){let v=r.output[m];v instanceof Array&&(v="COMBO");const k=r.output_name[m]||v,O={shape:r.output_is_list[m]?d.LiteGraph.GRID_SHAPE:d.LiteGraph.CIRCLE_SHAPE};this.addOutput(k,v,O)}const y=this.computeSize();y[0]=Math.max(_.minWidth,y[0]*1.5),y[1]=Math.max(_.minHeight,y[1]),this.size=y,this.serialize_widgets=!0}configure(u){const g=(f,_)=>{const y={..._};if(f.widget===void 0&&_.widget!==void 0)return this.inputs.push(f),_;for(const h of["name","type","shape"])f[h]!==void 0&&(y[h]=f[h]);return y};for(const f of["inputs","outputs"]){const _=u[f]??[];u[f]=_.map((y,h)=>g(this[f][h]??{},y))}super.configure(u)}},b(n,"title",r.display_name||r.name),b(n,"nodeData",r),b(n,"category"),n);await Ft(p,r,i,e),await Dt(p,r,o),d.LiteGraph.registerNodeType(l,p),p.category=r.category}}function Mt(t){if(t==null)return"(unknown error)";const i=t.traceback.join("");return t.node_id,`Error occurred when executing ${t.node_type}:

${t.exception_message}

${i}`}function Bt(t,i){window.addEventListener("status",({detail:e})=>{console.log("status",e)}),window.addEventListener("reconnecting",()=>{console.log("Reconnecting...")}),window.addEventListener("progress",({detail:e})=>{i.setDirtyCanvas(!0,!1)}),window.addEventListener("executing",({detail:e})=>{L.currentExecutingNode=e,i.setDirtyCanvas(!0,!1)}),window.addEventListener("executed",({detail:e})=>{L.currentExecutingNode=null;const o=i.getNodeById(e.node);o&&o.onExecuted&&o.onExecuted(e.output)}),window.addEventListener("execution_start",({detail:e})=>{L.lastErrorNode=null,G.info("Workflow Start")}),window.addEventListener("execution_success",({detail:e})=>{G.info("Workflow Execution Success"),i.stop()}),window.addEventListener("execution_error",({detail:e})=>{const o=Mt(e);L.lastErrorNode=e,G.error("Workflow Error!"),i.stop(),console.error(o)})}async function Pt(t,i,e){const o=new d.LGraph,n=new d.LGraphCanvas(t,o);o.start();function l(){const p=Math.max(window.devicePixelRatio,1),{width:s,height:c}=t.getBoundingClientRect();t.width=Math.round(s*p),t.height=Math.round(c*p),t.getContext("2d").scale(p,p),n.draw(!0,!0)}l(),window.addEventListener("resize",l),d.LiteGraph.release_link_on_empty_shows_menu=!0,d.LiteGraph.alt_drag_do_clone_nodes=!0,d.LiteGraph.clearRegisteredTypes();const r=await ft();await Ht(),await Vt(r,o,n),await At(r,o,n),await gt(),Bt(n,o),dt(),i(o),e(n)}function $t({setGraph:t,setCanvas:i,canvasRef:e}){S.useEffect(()=>{e.current&&Pt(e.current,t,i)},[])}function qt(){const t=S.useRef(null),[i,e]=S.useState(void 0),[o,n]=S.useState(void 0);return $t({setGraph:e,setCanvas:n,canvasRef:t}),w.jsxs(w.Fragment,{children:[w.jsx(Ot,{graph:i,canvas:o}),w.jsx("canvas",{style:{position:"absolute",zIndex:0,touchAction:"none"},ref:t,id:"graph-canvas"})]})}q(document.getElementById("root")).render(w.jsxs(w.Fragment,{children:[w.jsx(qt,{}),w.jsx(tt,{style:{marginTop:"1.25em"},position:"top-right",autoClose:5e3,pauseOnHover:!1,draggable:!1,hideProgressBar:!0,theme:"colored"})]}));
