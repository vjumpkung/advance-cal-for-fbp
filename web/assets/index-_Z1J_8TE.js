var U=Object.defineProperty;var J=(e,o,i)=>o in e?U(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i;var j=(e,o,i)=>J(e,typeof o!="symbol"?o+"":o,i);import{r as x,a as Z}from"./vendor-wpXbf5jk.js";import{B as C,Q as K}from"./react-toastify-Df8KVf6C.js";import{F as Q}from"./file-saver-B7T6XPHc.js";import{H as X}from"./react-helmet-CuerYPg1.js";import{z as t}from"./zod-DXqQCM1T.js";import{l as N}from"./litegraph.js-CsUhbCts.js";import{a as Y}from"./axios-DXsv3KKR.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();var B={exports:{}},k={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee=x,te=Symbol.for("react.element"),oe=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,se=ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ne={key:!0,ref:!0,__self:!0,__source:!0};function A(e,o,i){var n,r={},s=null,f=null;i!==void 0&&(s=""+i),o.key!==void 0&&(s=""+o.key),o.ref!==void 0&&(f=o.ref);for(n in o)ie.call(o,n)&&!ne.hasOwnProperty(n)&&(r[n]=o[n]);if(e&&e.defaultProps)for(n in o=e.defaultProps,o)r[n]===void 0&&(r[n]=o[n]);return{$$typeof:te,type:e,key:s,ref:f,props:r,_owner:se.current}}k.Fragment=oe;k.jsx=A;k.jsxs=A;B.exports=k;var p=B.exports,$,H=Z;$=H.createRoot,H.hydrateRoot;const T=t.union([t.number().int(),t.string()]),F=t.union([t.object({0:t.number(),1:t.number()}).passthrough().transform(e=>[e[0],e[1]]),t.tuple([t.number(),t.number()])]),re=t.object({collapsed:t.boolean().optional(),pinned:t.boolean().optional(),allow_interaction:t.boolean().optional(),horizontal:t.boolean().optional(),skip_repeated_outputs:t.boolean().optional()}).passthrough(),G=t.union([t.string(),t.array(t.string()),t.number()]),I=t.union([t.number().int(),t.string().transform(e=>parseInt(e)).refine(e=>!isNaN(e),{message:"Invalid number"})]),ae=t.object({name:t.string(),type:G,link:t.number().nullable().optional(),slot_index:I.optional()}).passthrough(),le=t.object({name:t.string(),type:G,links:t.array(t.number()).nullable().optional(),slot_index:I.optional()}).passthrough(),ue=t.object({"Node name for S&R":t.string().optional()}).passthrough(),ce=t.union([t.array(t.any()),t.record(t.any())]),de=t.object({id:T,type:t.string(),pos:F,size:F,flags:re,order:t.number(),mode:t.number(),inputs:t.array(ae).optional(),outputs:t.array(le).optional(),properties:ue,widgets_values:ce.optional(),color:t.string().optional(),bgcolor:t.string().optional()}).passthrough(),pe=t.tuple([t.number(),T,I,T,I,G]),fe=t.object({title:t.string(),bounding:t.tuple([t.number(),t.number(),t.number(),t.number()]),color:t.string().optional(),font_size:t.number().optional(),locked:t.boolean().optional()}).passthrough(),me=t.object({links_ontop:t.boolean().optional(),align_to_grid:t.boolean().optional()}).passthrough(),ge=t.object({last_node_id:t.number(),last_link_id:t.number(),nodes:t.array(de),links:t.array(pe),groups:t.array(fe).optional(),config:me.optional().nullable(),version:t.number()});function he(e){try{const o=JSON.parse(e),i=ge.parse(o);return console.log("Validation successful:",i),i}catch(o){throw o instanceof t.ZodError?console.error("Validation error:",o.errors):console.error("Parsing error:",o),Error(o)}}const ye=(e,o,i)=>{var r;const n=(r=i.target.files)==null?void 0:r[0];if(n&&o){const s=new FileReader;return s.onload=f=>{var l;try{const a=(l=f.target)==null?void 0:l.result,u=he(a);console.log(u),o.clear(),o.configure(u),e&&(e.value=""),C.success("Loading Workflow Success",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}catch{C.error("Error loading workflow file. Please ensure it is a valid workflow.",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})}},s.onerror=()=>{C.error("Error reading file",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}})},s.readAsText(n),n.name}};function be({graph:e,canvas:o}){const i=x.useRef(null),[n,r]=x.useState(!1),[s,f]=x.useState(!0),[l,a]=x.useState(null),[u,m]=x.useState("untitled"),d=()=>{var g;(g=i.current)==null||g.click()},c=()=>{if(e){const g=JSON.stringify(e.serialize()),h=new Blob([g],{type:"text/plain;charset=utf-8"}),_=prompt("Enter Filename : ",`workflow-${Date.now()}`);if(_===null)return;Q.saveAs(h,`${_}.json`),a(e.serialize()),m(_)}},b=()=>{e&&confirm("Clear workflow?")&&(e.clear(),C.info("Workflow Cleared",{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",style:{marginTop:"1.25em"}}),m("untitled"),o.ds.offset=[0,0],o.setZoom(1,[0,0]),o.setDirty(!0,!0))},y=()=>{e&&(n?(e.stop(),r(!1)):(e.start(),r(!0)))};return p.jsxs(p.Fragment,{children:[p.jsx(X,{children:p.jsxs("title",{children:[s?"":"*",u+" ","- AdvFBP"]})}),p.jsxs("div",{className:"topbar",children:[p.jsxs("div",{className:"leftmenu",children:[p.jsxs("button",{className:"buttonmenu",onClick:c,children:[p.jsx("i",{className:"pi pi-save"})," Save"]}),p.jsxs("button",{className:"buttonmenu",onClick:d,children:[p.jsx("i",{className:"pi pi-upload"})," Load"]}),p.jsx("input",{type:"file",ref:i,onChange:g=>{const h=ye(i.current,e,g);h&&m(h.split(".")[0])},accept:".json",style:{display:"none"}}),p.jsxs("button",{className:"buttonmenu",onClick:b,children:[p.jsx("i",{className:"pi pi-eraser"})," Clear"]})]}),p.jsx("div",{className:"rightmenu",children:p.jsx("button",{className:"buttonmenu",onClick:y,children:n?p.jsxs("span",{children:[p.jsx("i",{className:"pi pi-stop"})," Stop"]}):p.jsxs("span",{children:[p.jsx("i",{className:"pi pi-play"})," Start"]})})})]})]})}async function we(){const e=await Y.get("/api/object_info");if(e.status===200)return e.data}const S=Symbol(),L=Symbol();function ve(e,o,i,n,r){console.log(i);const s=50;function f(a){var b,y;if(e.widgets[0].last_y==null)return;let u=e.widgets[0].last_y,m=a[1]-u,d=0;const c=[];for(let g=0;g<e.widgets.length;g++){const h=e.widgets[g];h.type==="customtext"?c.push(h):h.computeSize?d+=h.computeSize(null)[1]+4:d+=N.LiteGraph.NODE_WIDGET_HEIGHT+4}m-=d,m/=c.length+(((b=e.imgs)==null?void 0:b.length)||0),m<s&&(m=s,e.size[1]=u+d+m*(c.length+(((y=e.imgs)==null?void 0:y.length)||0)),e.graph.setDirtyCanvas(!0));for(const g of e.widgets)g.y=u,g.type==="customtext"?(u+=m,g.computedHeight=m-c.length*4):g.computeSize?u+=g.computeSize()[1]+4:u+=N.LiteGraph.NODE_WIDGET_HEIGHT+4;e.inputHeight=m}const l={type:"customtext",name:o,get value(){return this.inputEl.value},set value(a){this.inputEl.value=a},draw:function(a,u,m,d,c){this.parent.inputHeight||f(e.size);const b=r.ds.scale>.5&&this.type==="customtext",y=10,g=a.canvas.getBoundingClientRect(),h=new DOMMatrix().scaleSelf(g.width/a.canvas.width,g.height/a.canvas.height).multiplySelf(a.getTransform()).translateSelf(y,y+d),_=new DOMMatrix().scaleSelf(h.a,h.d);Object.assign(this.inputEl.style,{transformOrigin:"0 0",transform:_,left:`${h.a+h.e}px`,top:`${h.d+h.f}px`,width:`${m-y*2}px`,height:`${this.parent.inputHeight-y*2}px`,position:"absolute",background:e.color?e.color:"",color:e.color?"white":"",zIndex:n._nodes.indexOf(e)}),this.inputEl.hidden=!b}};if(l.inputEl=document.createElement("textarea"),l.inputEl.className="comfy-multiline-input",l.inputEl.value=i.defaultVal,l.inputEl.placeholder=i.placeholder||"",document.addEventListener("mousedown",function(a){l.inputEl.contains(a.target)||l.inputEl.blur()}),l.parent=e,document.body.appendChild(l.inputEl),e.addCustomWidget(l),r.onDrawBackground=function(){for(let a in n._nodes){const u=n._nodes[a];for(let m in u.widgets){let d=u.widgets[m];Object.hasOwn(d,"inputEl")&&(d.inputEl.style.left="-8000px",d.inputEl.style.position="absolute")}}},e.onRemoved=function(){for(let a in this.widgets)this.widgets[a].inputEl&&this.widgets[a].inputEl.remove()},l.onRemove=()=>{var a;(a=l.inputEl)==null||a.remove(),--e[S]||(e.onResize=e[L],delete e[S],delete e[L])},e[S])e[S]++;else{e[S]=1;const a=e[L]=e.onResize;e.onResize=function(u){f(u),a&&a.apply(this,arguments)}}return{minWidth:400,minHeight:200,widget:l}}function V(e,o){let i=e[1].default,{min:n,max:r,step:s}=e[1];return i==null&&(i=0),n==null&&(n=Number.MIN_SAFE_INTEGER),r==null&&(r=Number.MAX_SAFE_INTEGER),s==null&&(s=o),e[1].min=n,e[1].max=r,e[1].step=1*s,{val:i,config:{...e[1]}}}function q(e){return e==="slider"?"slider":"number"}function xe(e,o,i){let n=q(i[1].display);const{val:r,config:s}=V(i,1);return Object.assign(s,{precision:0}),{widget:e.addWidget(n,o,r,function(f){const l=this.options.step/10;let a=this.options.min%l;isNaN(a)&&(a=0),this.value=Math.round((f-a)/l)*l+a},s)}}const z={FLOAT(e,o,i){let n=q(i[1].display),{val:r,config:s}=V(i,.5);return{widget:e.addWidget(n,o,r,()=>{},s)}},INT(e,o,i){return xe(e,o,i)},BOOLEAN(e,o,i){let n=i[1].default;return{widget:e.addWidget("toggle",o,n,()=>{},{on:i[1].label_on,off:i[1].label_off})}},STRING(e,o,i,n,r){const s=i[1].defaultVal?i[1].defaultVal:"",f=!!i[1].multiline;let l;return f?l=ve(e,o,i[1],n,r):l={widget:e.addWidget("text",o,s,()=>{},{})},i[1].dynamicPrompts!=null&&(l.widget.dynamicPrompts=i[1].dynamicPrompts),l},COMBO(e,o,i){const n=i[0];let r=n[0];return i[1]&&i[1].default&&(r=i[1].default),{widget:e.addWidget("combo",o,r,()=>{},{values:n})}}};async function _e(e,o,i){var n;for(const r in e){const s=e[r],f=(n=class extends N.LGraphNode{constructor(u){var y,g,h,_,M,P;super(u);j(this,"graph",o);j(this,"canvas",i);const m=s.input.required;var d=s.input.required;s.input.optional!=null&&(d=Object.assign({},s.input.required,s.input.optional));const c={minWidth:1,minHeight:1};for(const w in d){const O=d[w],v=O[0],R=O[1]??{},E=[v,R],D=m&&w in m;let W=!0;(y=E[1])!=null&&y.forceInput?this.addInput(w,v):Array.isArray(v)?Object.assign(c,z.COMBO(this,w,E)||{}):`${v}:${w}`in z?Object.assign(c,z[`${v}:${w}`](this,w,E,this.graph,this.canvas)||{}):v in z?Object.assign(c,z[v](this,w,E,this.graph,this.canvas)||{}):(this.addInput(w,v),W=!1),W&&(c!=null&&c.widget)&&((g=c.widget).options??(g.options={}),D||(c.widget.options.inputIsOptional=!0),(h=E[1])!=null&&h.forceInput&&(c.widget.options.forceInput=!0),(_=E[1])!=null&&_.defaultInput&&(c.widget.options.defaultInput=!0),(M=E[1])!=null&&M.advanced&&(c.widget.advanced=!0),(P=E[1])!=null&&P.hidden&&(c.widget.hidden=!0))}for(const w in s.output){let O=s.output[w];O instanceof Array&&(O="COMBO");const v=s.output_name[w]||O;s.output_is_list[w];const R={};this.addOutput(v,O,R)}const b=this.computeSize();b[0]=Math.max(c.minWidth,b[0]*1.5),b[1]=Math.max(c.minHeight,b[1]),this.size=b,this.serialize_widgets=!0}configure(u){const m=(d,c)=>{const b={...c};if(d.widget===void 0&&c.widget!==void 0)return this.inputs.push(d),c;for(const y of["name","type","shape"])d[y]!==void 0&&(b[y]=d[y]);return b};for(const d of["inputs","outputs"]){const c=u[d]??[];u[d]=c.map((b,y)=>m(this[d][y]??{},b))}super.configure(u)}},j(n,"comfyClass",s.name),j(n,"title",s.display_name||s.name),j(n,"nodeData",s),j(n,"category"),n);f.comfyClass=s.name,N.LiteGraph.registerNodeType(r,f),f.category=s.category}}async function Ee(e,o,i,n,r){const s=new N.LGraph,f=new N.LGraphCanvas(e,s);function l(){const u=Math.max(window.devicePixelRatio,1),{width:m,height:d}=e.getBoundingClientRect();e.width=Math.round(m*u),e.height=Math.round(d*u),e.getContext("2d").scale(u,u),f.draw(!0,!0)}l(),window.addEventListener("resize",l),o(s),i(f),N.LiteGraph.clearRegisteredTypes();const a=await we();await _e(a,s,f)}function Oe({setGraph:e,setCanvas:o,canvasRef:i,canvas:n,graph:r}){x.useEffect(()=>{i.current&&Ee(i.current,e,o)},[])}function je(){const e=x.useRef(null),[o,i]=x.useState(void 0),[n,r]=x.useState(void 0);return Oe({setGraph:i,setCanvas:r,canvasRef:e,canvas:n,graph:o}),p.jsxs(p.Fragment,{children:[p.jsx(be,{graph:o,canvas:n}),p.jsx("canvas",{style:{position:"absolute",zIndex:0},ref:e,id:"graph-canvas"})]})}$(document.getElementById("root")).render(p.jsxs(p.Fragment,{children:[p.jsx(je,{}),p.jsx(K,{})]}));
