var K=Object.defineProperty;var X=(t,o,e)=>o in t?K(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var v=(t,o,e)=>X(t,typeof o!="symbol"?o+"":o,e);import{r as S,a as Y}from"./vendor-wpXbf5jk.js";import{B as z,Q}from"./react-toastify-Df8KVf6C.js";import{F as tt}from"./file-saver-B7T6XPHc.js";import{H as et}from"./react-helmet-CuerYPg1.js";import{a as A}from"./axios-DXsv3KKR.js";import{v as it}from"./uuid-Ch9TGLTe.js";import{z as a}from"./zod-DXqQCM1T.js";import{l as h}from"./litegraph.js-D6XMNgl8.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=e(r);fetch(r.href,l)}})();var H={exports:{}},R={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ot=S,st=Symbol.for("react.element"),nt=Symbol.for("react.fragment"),rt=Object.prototype.hasOwnProperty,at=ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lt={key:!0,ref:!0,__self:!0,__source:!0};function $(t,o,e){var i,r={},l=null,n=null;e!==void 0&&(l=""+e),o.key!==void 0&&(l=""+o.key),o.ref!==void 0&&(n=o.ref);for(i in o)rt.call(o,i)&&!lt.hasOwnProperty(i)&&(r[i]=o[i]);if(t&&t.defaultProps)for(i in o=t.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:st,type:t,key:l,ref:n,props:r,_owner:at.current}}R.Fragment=nt;R.jsx=$;R.jsxs=$;H.exports=R;var w=H.exports,q,M=Y;q=M.createRoot,M.hydrateRoot;async function ut(t){const o=t.serialize(),e={};for(const i of t.computeExecutionOrder(!1,0)){const r=o.nodes.find(p=>p.id===i.id);if(i.isVirtualNode){i.applyToGraph&&i.applyToGraph(o);continue}if(i.mode===2||i.mode===4)continue;const l={},n=i.widgets;if(n)for(const p in n){const s=n[p];(!s.options||s.options.serialize!==!1)&&(l[s.name]=s.serializeValue?await s.serializeValue(r,p):s.value)}for(let p in i.inputs){let s=i.getInputNode(p);if(s){let u=i.getInputLink(p);for(;s.mode===4||s.isVirtualNode;){let c=!1;if(s.isVirtualNode)u=s.getInputLink(u.origin_slot),u&&(s=s.getInputNode(u.target_slot),s&&(c=!0));else if(u&&s.mode===4){let y=[u.origin_slot];if(s.inputs){y=y.concat(Object.keys(s.inputs));for(let d in y)if(d=y[d],s.inputs[d].type===i.inputs[p].type){u=s.getInputLink(d),u&&(s=s.getInputNode(d)),c=!0;break}}}if(!c)break}u&&(l[i.inputs[p].name]=[String(u.origin_id),parseInt(u.origin_slot)])}}e[String(i.id)]={inputs:l,class_type:i.comfyClass}}for(const i in e)for(const r in e[i].inputs)Array.isArray(e[i].inputs[r])&&e[i].inputs[r].length===2&&!e[e[i].inputs[r][0]]&&delete e[i].inputs[r];return{workflow:o,output:e}}const P=it().toString().replace(/-/gi,"");async function ct(){const t=await A.get("/api/object_info");if(t.status===200)return t.data}async function pt(t){const o=await ut(t),e=await A.post("/api/workflow",{workflow:o.output,client_id:P});if(e.status===200)return await e.data;throw{response:await e.data}}async function dt(t){const o=new WebSocket(`/ws?clientId=${P}`);return o.binaryType="arraybuffer",o.addEventListener("open",()=>{console.log("WebSocket Open")}),o.addEventListener("error",()=>{console.log("WebSocket Error")}),o.addEventListener("close",()=>{console.log("Reconnect!")}),o.addEventListener("message",e=>{try{const i=JSON.parse(e.data);switch(i.type){case"status":dispatchEvent(new CustomEvent("status",{detail:i.data.status}));break;case"progress":dispatchEvent(new CustomEvent("progress",{detail:i.data}));break;case"executing":dispatchEvent(new CustomEvent("executing",{detail:i.data.node}));break;case"progress":case"executed":case"execution_start":case"execution_success":case"execution_error":case"execution_cached":case"logs":dispatchEvent(new CustomEvent(i.type,{detail:i.data}));break}}catch(i){console.warn("Unhandled message:",e.data,i)}}),o}const V=a.union([a.number().int(),a.string()]),B=a.union([a.object({0:a.number(),1:a.number()}).passthrough().transform(t=>[t[0],t[1]]),a.tuple([a.number(),a.number()])]),ft=a.object({collapsed:a.boolean().optional(),pinned:a.boolean().optional(),allow_interaction:a.boolean().optional(),horizontal:a.boolean().optional(),skip_repeated_outputs:a.boolean().optional()}).passthrough(),F=a.union([a.string(),a.array(a.string()),a.number()]),j=a.union([a.number().int(),a.string().transform(t=>parseInt(t)).refine(t=>!isNaN(t),{message:"Invalid number"})]),ht=a.object({name:a.string(),type:F,link:a.number().nullable().optional(),slot_index:j.optional()}).passthrough(),gt=a.object({name:a.string(),type:F,links:a.array(a.number()).nullable().optional(),slot_index:j.optional()}).passthrough(),mt=a.object({"Node name for S&R":a.string().optional()}).passthrough(),yt=a.union([a.array(a.any()),a.record(a.any())]),_t=a.object({id:V,type:a.string(),pos:B,size:B,flags:ft,order:a.number(),mode:a.number(),inputs:a.array(ht).optional(),outputs:a.array(gt).optional(),properties:mt,widgets_values:yt.optional(),color:a.string().optional(),bgcolor:a.string().optional()}).passthrough(),wt=a.tuple([a.number(),V,j,V,j,F]),bt=a.object({title:a.string(),bounding:a.tuple([a.number(),a.number(),a.number(),a.number()]),color:a.string().optional(),font_size:a.number().optional(),locked:a.boolean().optional()}).passthrough(),vt=a.object({links_ontop:a.boolean().optional(),align_to_grid:a.boolean().optional()}).passthrough(),Et=a.object({last_node_id:a.number(),last_link_id:a.number(),nodes:a.array(_t),links:a.array(wt),groups:a.array(bt).optional(),config:vt.optional().nullable(),version:a.number()});function xt(t){try{const o=JSON.parse(t);return Et.parse(o)}catch(o){throw o instanceof a.ZodError?console.error("Validation error:",o.errors):console.error("Parsing error:",o),Error(o)}}const kt=(t,o,e)=>{var r;const i=(r=e.target.files)==null?void 0:r[0];if(i&&o){const l=new FileReader;return l.onload=n=>{var p;try{const s=(p=n.target)==null?void 0:p.result,u=xt(s);o.clear(),o.configure(u),t&&(t.value=""),z.success("Loading Workflow Success")}catch{z.error("Error loading workflow file. Please ensure it is a valid workflow.")}},l.onerror=()=>{z.error("Error reading file")},l.readAsText(i),i.name}};function Ot({graph:t,canvas:o}){const e=S.useRef(null),[i,r]=S.useState(!1),[l,n]=S.useState(!0),[p,s]=S.useState(null),[u,c]=S.useState("untitled"),y=()=>{var f;(f=e.current)==null||f.click()},d=()=>{if(t){const f=JSON.stringify(t.serialize()),b=new Blob([f],{type:"text/plain;charset=utf-8"}),L=prompt("Enter Filename : ",`workflow-${Date.now()}`);if(L===null)return;tt.saveAs(b,`${L}.json`),s(t.serialize()),c(L)}},m=()=>{t&&confirm("Clear workflow?")&&(t.clear(),z.info("Workflow Cleared"),c("untitled"),o.ds.offset=[0,0],o.setZoom(1,[0,0]),o.setDirty(!0,!0))},_=async()=>{try{const f=await pt(t);t.start()}catch(f){console.error(f),await z.error(f.response.data.error.message)}};return w.jsxs(w.Fragment,{children:[w.jsx(et,{children:w.jsxs("title",{children:[l?"":"*",u+" ","- AdvFBP"]})}),w.jsxs("div",{className:"topbar",children:[w.jsxs("div",{className:"leftmenu",children:[w.jsxs("button",{className:"buttonmenu",onClick:d,children:[w.jsx("i",{className:"pi pi-save"})," Save"]}),w.jsxs("button",{className:"buttonmenu",onClick:y,children:[w.jsx("i",{className:"pi pi-upload"})," Load"]}),w.jsx("input",{type:"file",ref:e,onChange:f=>{const b=kt(e.current,t,f);b&&c(b.split(".")[0])},accept:".json",style:{display:"none"}}),w.jsxs("button",{className:"buttonmenu",onClick:m,children:[w.jsx("i",{className:"pi pi-eraser"})," Clear"]})]}),w.jsx("div",{className:"rightmenu",children:w.jsx("button",{className:"buttonmenuright",onClick:async()=>{await _()},children:i?w.jsxs("span",{children:[w.jsx("i",{className:"pi pi-stop"})," Interrupt Workflow"]}):w.jsxs("span",{children:[w.jsx("i",{className:"pi pi-play"})," Run Workflow"]})})})]})]})}const G=Symbol(),W=Symbol();function Lt(t,o,e,i,r){function n(s){var m,_;if(t.widgets[0].last_y==null)return;let u=t.widgets[0].last_y,c=s[1]-u,y=0;const d=[];for(let f=0;f<t.widgets.length;f++){const b=t.widgets[f];b.type==="customtext"?d.push(b):b.computeSize?y+=b.computeSize(null)[1]+4:y+=h.LiteGraph.NODE_WIDGET_HEIGHT+4}c-=y,c/=d.length+(((m=t.imgs)==null?void 0:m.length)||0),c<50&&(c=50,t.size[1]=u+y+c*(d.length+(((_=t.imgs)==null?void 0:_.length)||0)),t.graph.setDirtyCanvas(!0));for(const f of t.widgets)f.y=u,f.type==="customtext"?(u+=c,f.computedHeight=c-d.length*4):f.computeSize?u+=f.computeSize()[1]+4:u+=h.LiteGraph.NODE_WIDGET_HEIGHT+4;t.inputHeight=c}const p={type:"customtext",name:o,get value(){return this.inputEl.value},set value(s){this.inputEl.value=s},draw:function(s,u,c,y,d){this.parent.inputHeight||n(t.size);const m=r.ds.scale>.5&&this.type==="customtext",_=10,f=s.canvas.getBoundingClientRect(),b=new DOMMatrix().scaleSelf(f.width/s.canvas.width,f.height/s.canvas.height).multiplySelf(s.getTransform()).translateSelf(_,_+y),L=new DOMMatrix().scaleSelf(b.a,b.d);Object.assign(this.inputEl.style,{transformOrigin:"0 0",transform:L,left:`${b.a+b.e}px`,top:`${b.d+b.f}px`,width:`${c-_*2}px`,height:`${this.parent.inputHeight-_*2}px`,position:"absolute",background:t.color?t.color:"",color:t.color?"white":"",zIndex:i._nodes.indexOf(t)}),this.inputEl.hidden=!m}};if(p.inputEl=document.createElement("textarea"),p.inputEl.className="comfy-multiline-input",p.inputEl.value=e.defaultVal,p.inputEl.placeholder=e.placeholder||"",document.addEventListener("mousedown",function(s){p.inputEl.contains(s.target)||p.inputEl.blur()}),p.parent=t,document.body.appendChild(p.inputEl),t.addCustomWidget(p),r.onDrawBackground=function(){for(let s in i._nodes){const u=i._nodes[s];for(let c in u.widgets){let y=u.widgets[c];Object.hasOwn(y,"inputEl")&&(y.inputEl.style.left="-8000px",y.inputEl.style.position="absolute")}}},t.onRemoved=function(){for(let s in this.widgets)this.widgets[s].inputEl&&this.widgets[s].inputEl.remove()},p.onRemove=()=>{var s;(s=p.inputEl)==null||s.remove(),--t[G]||(t.onResize=t[W],delete t[G],delete t[W])},t[G])t[G]++;else{t[G]=1;const s=t[W]=t.onResize;t.onResize=function(u){n(u),s&&s.apply(this,arguments)}}return{minWidth:400,minHeight:200,widget:p}}function U(t,o){let e=t[1].default,{min:i,max:r,step:l}=t[1];return e==null&&(e=0),i==null&&(i=Number.MIN_SAFE_INTEGER),r==null&&(r=Number.MAX_SAFE_INTEGER),l==null&&(l=o),t[1].min=i,t[1].max=r,t[1].step=1*l,{val:e,config:{...t[1]}}}function Z(t){return t==="slider"?"slider":"number"}function Nt(t,o,e){let i=Z(e[1].display);const{val:r,config:l}=U(e,1);return Object.assign(l,{precision:0}),{widget:t.addWidget(i,o,r,function(n){const p=this.options.step/10;let s=this.options.min%p;isNaN(s)&&(s=0),this.value=Math.round((n-s)/p)*p+s},l)}}const I={FLOAT(t,o,e){let i=Z(e[1].display),{val:r,config:l}=U(e,.5);return{widget:t.addWidget(i,o,r,()=>{},l)}},INT(t,o,e){return Nt(t,o,e)},BOOLEAN(t,o,e){let i=e[1].default;return{widget:t.addWidget("toggle",o,i,()=>{},{on:e[1].label_on,off:e[1].label_off})}},STRING(t,o,e,i,r){const l=e[1].defaultVal?e[1].defaultVal:"",n=!!e[1].multiline;let p;return n?p=Lt(t,o,e[1],i,r):p={widget:t.addWidget("text",o,l,()=>{},{})},e[1].dynamicPrompts!=null&&(p.widget.dynamicPrompts=e[1].dynamicPrompts),p},COMBO(t,o,e){const i=e[0];let r=i[0];return e[1]&&e[1].default&&(r=e[1].default),{widget:t.addWidget("combo",o,r,()=>{},{values:i})}},SELECTFILE(t,o,e,i,r){let l;const n=document.createElement("input");return Object.assign(n,{type:"file",style:"display: none",onchange:async()=>{if(n.files.length){const p=n.files[0],s=new FormData;s.append("file",p);const u=await A.post("/api/upload/file",s);t.widgets[0].value=u.data.path}}}),document.body.append(n),l=t.addWidget("button","Select File","file",()=>{n.click()}),t.onRemoved=function(){n.remove()},l.serialize=!1,{widget:l}}};async function St(t,o){class e{constructor(){v(this,"properties");v(this,"serialize_widgets");v(this,"isVirtualNode");v(this,"color",h.LGraphCanvas.node_colors.yellow.color);v(this,"bgcolor",h.LGraphCanvas.node_colors.yellow.bgcolor);v(this,"groupcolor",h.LGraphCanvas.node_colors.yellow.groupcolor);this.properties||(this.properties={},this.properties.text=""),I.STRING(this,"",["",{defaultVal:this.properties.text,multiline:!0}],t,o),this.serialize_widgets=!0,this.isVirtualNode=!0}}v(e,"category"),h.LiteGraph.registerNodeType("Note",Object.assign(e,{title_mode:h.LiteGraph.NORMAL_TITLE,title:"Note",collapsable:!0})),e.category="utils"}async function It(t,o){const i=class i{constructor(){v(this,"size");v(this,"__outputType");v(this,"inputs");v(this,"outputs");v(this,"isVirtualNode");v(this,"horizontal");v(this,"properties");this.properties||(this.properties={}),this.properties.showOutputText=i.defaultVisibility,this.properties.horizontal=!1;const l=this;l.addInput("","*"),l.addOutput(this.properties.showOutputText?"*":"","*"),l.onConnectionsChange=function(n,p,s,u){var T;if(this.applyOrientation(),s&&n===h.LiteGraph.OUTPUT&&new Set(this.outputs[0].links.map(k=>t.links[k].type).filter(k=>k!=="*")).size>1){const k=[];for(let g=0;g<this.outputs[0].links.length-1;g++){const x=this.outputs[0].links[g],O=t.links[x];k.push(O)}for(const g of k)t.getNodeById(g.target_id).disconnectInput(g.target_slot)}let c=this,y=[],d=null,m=null;for(;c;){y.unshift(c);const E=c.inputs[0].link;if(E!==null){const k=t.links[E],g=t.getNodeById(k.origin_id);if(g.constructor.type==="Reroute")g===this?(c.disconnectInput(k.target_slot),c=null):c=g;else{m=c,d=((T=g.outputs[k.origin_slot])==null?void 0:T.type)??null;break}}else{c=null;break}}const _=[this];let f=null;for(;_.length;){c=_.pop();const E=(c.outputs?c.outputs[0].links:[])||[];if(E.length)for(const k of E){const g=t.links[k];if(!g)continue;const x=t.getNodeById(g.target_id);if(x.constructor.type==="Reroute")_.push(x),y.push(x);else{const C=x.inputs&&x.inputs[g==null?void 0:g.target_slot]&&x.inputs[g.target_slot].type?x.inputs[g.target_slot].type:null;d&&C!==d?x.disconnectInput(g.target_slot):f=C}}}const b=d||f||"*",L=h.LGraphCanvas.link_type_colors[b];for(const E of y){E.outputs[0].type=d||"*",E.__outputType=b,E.outputs[0].name=E.properties.showOutputText?b:"",E.size=E.computeSize(),E.applyOrientation();for(const k of E.outputs[0].links||[]){const g=t.links[k];g&&(g.color=L)}}if(m){const E=t.links[m.inputs[0].link];E&&(E.color=L)}},this.clone=function(){const n=i.prototype.clone.apply(this);return n.removeOutput(0),n.addOutput(this.properties.showOutputText?"*":"","*"),n.size=n.computeSize(),n},this.isVirtualNode=!0}getExtraMenuOptions(l,n){n.unshift({content:(this.properties.showOutputText?"Hide":"Show")+" Type",callback:()=>{this.properties.showOutputText=!this.properties.showOutputText,this.properties.showOutputText?this.outputs[0].name=this.__outputType||this.outputs[0].type:this.outputs[0].name="",this.size=this.computeSize(),this.applyOrientation(),t.setDirtyCanvas(!0,!0)}},{content:(i.defaultVisibility?"Hide":"Show")+" Type By Default",callback:()=>{i.setDefaultTextVisibility(!i.defaultVisibility)}},{content:"Set "+(this.properties.horizontal?"Horizontal":"Vertical"),callback:()=>{this.properties.horizontal=!this.properties.horizontal,this.applyOrientation()}})}applyOrientation(){this.horizontal=this.properties.horizontal,this.horizontal?this.inputs[0].pos=[this.size[0]/2,0]:delete this.inputs[0].pos,t.setDirtyCanvas(!0,!0)}computeSize(){return[this.properties.showOutputText&&this.outputs&&this.outputs.length?Math.max(75,h.LiteGraph.NODE_TEXT_SIZE*this.outputs[0].name.length*.6+40):75,26]}clone(){}static setDefaultTextVisibility(l){i.defaultVisibility=l,l?localStorage["Comfy.RerouteNode.DefaultVisibility"]="true":delete localStorage["Comfy.RerouteNode.DefaultVisibility"]}};v(i,"category"),v(i,"defaultVisibility");let e=i;e.setDefaultTextVisibility(!!localStorage["Comfy.RerouteNode.DefaultVisibility"]),h.LiteGraph.registerNodeType("Reroute",Object.assign(e,{title_mode:h.LiteGraph.NO_TITLE,title:"Reroute",collapsable:!1})),e.category="utils"}const zt={dark:{id:"dark",name:"Dark (Default)",colors:{node_slot:{INT:"#FFD500",FLOAT:"#A8DADC",STRING:"#ad7452",COMBO:"#FFA931",NDARRAY:"#6EE7B7"}}}};async function Tt(t,o,e){const i=s=>Object.keys(s).sort().reduce((u,c)=>(u[c]=s[c],u),{});function r(){var s=[];const u=t;for(const y in u){const d=u[y];var c=d.input.required;d.input.optional!==void 0&&(c=Object.assign({},d.input.required,d.input.optional));for(const m in c){const f=c[m][0];Array.isArray(f)||s.push(f)}for(const m in d.output){const _=d.output[m];s.push(_)}}return s}function l(s){var u=r();for(const c of u)s.colors.node_slot[c]||(s.colors.node_slot[c]="");return s.colors.node_slot=i(s.colors.node_slot),s}const n=async s=>{if(s=await l(s),s.colors){if(s.colors.node_slot&&(Object.assign(e.default_connection_color_byType,s.colors.node_slot),Object.assign(h.LGraphCanvas.link_type_colors,s.colors.node_slot)),s.colors.litegraph_base){e.node_title_color=s.colors.litegraph_base.NODE_TITLE_COLOR,e.default_link_color=s.colors.litegraph_base.LINK_COLOR;for(const u in s.colors.litegraph_base)s.colors.litegraph_base.hasOwnProperty(u)&&h.LiteGraph.hasOwnProperty(u)&&(h.LiteGraph[u]=s.colors.litegraph_base[u])}e.draw(!0,!0)}};let p=zt.dark;await n(p)}function Ct(){h.LiteGraph.search_filter_enabled=!0,h.LiteGraph.middle_click_slot_add_default_node=!0}async function Gt(t,o,e){var u;var i=o.name;const r=(u=o.input)==null?void 0:u.required;for(const c in r){var l=r[c];if(typeof l[0]!="string")continue;var n=l[0];if(n in I){var p=l[1];if(!(p!=null&&p.forceInput))continue}if(n in e.slot_types_default_out||(e.slot_types_default_out[n]=["Reroute"]),e.slot_types_default_out[n].includes(i))continue;e.slot_types_default_out[n].push(i);const y=n.toLocaleLowerCase();y in h.LiteGraph.registered_slot_in_types||(h.LiteGraph.registered_slot_in_types[y]={nodes:[]}),h.LiteGraph.registered_slot_in_types[y].nodes.push(t.comfyClass)}var s=o.output;for(const c in s){var n=s[c];n in e.slot_types_default_in||(e.slot_types_default_in[n]=["Reroute"]),e.slot_types_default_in[n].push(i),n in h.LiteGraph.registered_slot_out_types||(h.LiteGraph.registered_slot_out_types[n]={nodes:[]}),h.LiteGraph.registered_slot_out_types[n].nodes.push(t.comfyClass),h.LiteGraph.slot_types_out.includes(n)||h.LiteGraph.slot_types_out.push(n)}h.LiteGraph.slot_types_default_out={},h.LiteGraph.slot_types_default_in={};for(const c in e.slot_types_default_out)h.LiteGraph.slot_types_default_out[c]=e.slot_types_default_out[c].slice(0,5);for(const c in e.slot_types_default_in)h.LiteGraph.slot_types_default_in[c]=e.slot_types_default_in[c].slice(0,5)}async function jt(t,o,e){await St(o,e),await It(o),await Tt(t,o,e)}async function Rt(t,o,e){await Ct()}async function Wt(t){var o,e,i,r;((r=(i=(e=(o=t==null?void 0:t.input)==null?void 0:o.required)==null?void 0:e.path)==null?void 0:i[1])==null?void 0:r.select_file_path)===!0&&(t.input.required.selectfile=["SELECTFILE"])}async function Vt(t,o,e,i){if(o.name==="ShowText"){let r=function(l){var n,p;if(this.widgets){const s=this.widgets.findIndex(u=>u.name==="text");if(s!==-1){for(let u=s;u<this.widgets.length;u++)(p=(n=this.widgets[u]).onRemove)==null||p.call(n);this.widgets.length=s}}for(const s of l){const u=I.STRING(this,"text",["STRING",{multiline:!0}],e,i).widget;u.inputEl.readOnly=!0,u.inputEl.style.opacity=1,u.value=s}requestAnimationFrame(()=>{var u;const s=this.computeSize();s[0]<this.size[0]&&(s[0]=this.size[0]),s[1]<this.size[1]&&(s[1]=this.size[1]),(u=this.onResize)==null||u.call(this,s),e.setDirtyCanvas(!0,!1)})};t.onExecuted,t.prototype.onExecuted=function(l){r.call(this,l.text)}}}async function At(t,o,e){var r;const i={slot_types_default_out:{},slot_types_default_in:{}};for(const l in t){const n=t[l];await Wt(n);const p=(r=class extends h.LGraphNode{constructor(c){var f,b,L,T,E,k;super(c);v(this,"comfyClass",n.name);v(this,"graph",o);v(this,"canvas",e);const y=n.input.required;var d=n.input.required;n.input.optional!=null&&(d=Object.assign({},n.input.required,n.input.optional));const m={minWidth:1,minHeight:1};for(const g in d){const x=d[g],O=x[0],C=x[1]??{},N=[O,C],J=y&&g in y;let D=!0;(f=N[1])!=null&&f.forceInput?this.addInput(g,O):Array.isArray(O)?Object.assign(m,I.COMBO(this,g,N)||{}):`${O}:${g}`in I?Object.assign(m,I[`${O}:${g}`](this,g,N,this.graph,this.canvas)||{}):O in I?Object.assign(m,I[O](this,g,N,this.graph,this.canvas)||{}):(this.addInput(g,O),D=!1),D&&(m!=null&&m.widget)&&((b=m.widget).options??(b.options={}),J||(m.widget.options.inputIsOptional=!0),(L=N[1])!=null&&L.forceInput&&(m.widget.options.forceInput=!0),(T=N[1])!=null&&T.defaultInput&&(m.widget.options.defaultInput=!0),(E=N[1])!=null&&E.advanced&&(m.widget.advanced=!0),(k=N[1])!=null&&k.hidden&&(m.widget.hidden=!0))}for(const g in n.output){let x=n.output[g];x instanceof Array&&(x="COMBO");const O=n.output_name[g]||x,N={shape:n.output_is_list[g]?h.LiteGraph.GRID_SHAPE:h.LiteGraph.CIRCLE_SHAPE};this.addOutput(O,x,N)}const _=this.computeSize();_[0]=Math.max(m.minWidth,_[0]*1.5),_[1]=Math.max(m.minHeight,_[1]),this.size=_,this.serialize_widgets=!0}configure(c){const y=(d,m)=>{const _={...m};if(d.widget===void 0&&m.widget!==void 0)return this.inputs.push(d),m;for(const f of["name","type","shape"])d[f]!==void 0&&(_[f]=d[f]);return _};for(const d of["inputs","outputs"]){const m=c[d]??[];c[d]=m.map((_,f)=>y(this[d][f]??{},_))}super.configure(c)}},v(r,"title",n.display_name||n.name),v(r,"nodeData",n),v(r,"category"),r);await Vt(p,n,o,e),await Gt(p,n,i),h.LiteGraph.registerNodeType(l,p),p.category=n.category}}function Ft(t){if(t==null)return"(unknown error)";const o=t.traceback.join("");return t.node_id,`Error occurred when executing ${t.node_type}:

${t.exception_message}

${o}`}function Dt(t,o){window.addEventListener("status",({detail:e})=>{console.log("status",e)}),window.addEventListener("reconnecting",()=>{console.log("Reconnecting...")}),window.addEventListener("progress",({detail:e})=>{o.setDirtyCanvas(!0,!1)}),window.addEventListener("executing",({detail:e})=>{o.setDirtyCanvas(!0,!1)}),window.addEventListener("executed",({detail:e})=>{const i=o.getNodeById(e.node);i&&i.onExecuted&&i.onExecuted(e.output)}),window.addEventListener("execution_start",({detail:e})=>{z.info("Workflow Start")}),window.addEventListener("execution_success",({detail:e})=>{z.info("Workflow Execution Success"),o.stop()}),window.addEventListener("execution_error",({detail:e})=>{const i=Ft(e);z.error("Workflow Error!"),o.stop(),console.error(i)})}async function Mt(t,o,e){const i=new h.LGraph,r=new h.LGraphCanvas(t,i);i.start();function l(){const p=Math.max(window.devicePixelRatio,1),{width:s,height:u}=t.getBoundingClientRect();t.width=Math.round(s*p),t.height=Math.round(u*p),t.getContext("2d").scale(p,p),r.draw(!0,!0)}l(),window.addEventListener("resize",l),h.LiteGraph.release_link_on_empty_shows_menu=!0,h.LiteGraph.alt_drag_do_clone_nodes=!0,h.LiteGraph.clearRegisteredTypes();const n=await ct();await Rt(),await At(n,i,r),await jt(n,i,r),await dt(),Dt(r,i),o(i),e(r)}function Bt({setGraph:t,setCanvas:o,canvasRef:e}){S.useEffect(()=>{e.current&&Mt(e.current,t,o)},[])}function Ht(){const t=S.useRef(null),[o,e]=S.useState(void 0),[i,r]=S.useState(void 0);return Bt({setGraph:e,setCanvas:r,canvasRef:t}),w.jsxs(w.Fragment,{children:[w.jsx(Ot,{graph:o,canvas:i}),w.jsx("canvas",{style:{position:"absolute",zIndex:0,touchAction:"none"},ref:t,id:"graph-canvas"})]})}q(document.getElementById("root")).render(w.jsxs(w.Fragment,{children:[w.jsx(Ht,{}),w.jsx(Q,{style:{marginTop:"1.25em"},position:"top-right",autoClose:5e3,pauseOnHover:!1,draggable:!1,hideProgressBar:!0,theme:"colored"})]}));
